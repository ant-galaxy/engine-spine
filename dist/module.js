import{RenderTechnique as t,RenderState as e,BlendFunc as a,DataType as n,UniformSemantic as i,Material as r,BufferGeometry as s,VertexElement as o,VertexElementFormat as h,Buffer as l,BufferBindFlag as u,BufferUsage as c,IndexFormat as d,GeometryRenderer as f,Script as v,TextureFilter as m,TextureFilterMode as g,Texture2D as p,parseSingleKTX as y}from"oasis-engine";function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function E(t,e,a){return e&&w(t.prototype,e),a&&w(t,a),t}function x(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?S(t):e}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=b(t);if(e){var i=b(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return R(this,a)}}function A(t,e,a){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,a){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(a):i.value}})(t,e,a||t)}var I=function(s){x(h,r);var o=T(h);function h(t,e,a){var n;k(this,h),(n=o.call(this,t,e))._blendStates=void 0,n._stencilStates=void 0,n._depthMask=void 0,n._gl=void 0;var i=t._hardwareRenderer.gl;return n._gl=i,n._blendStates=a.blend,n._stencilStates=a.stencil,n._depthMask=a.depthMask,n}return E(h,[{key:"_generateTechnique",value:function(){var n=this.generateUniform(),i=this.generateAttributes(),r=new t(this.name);r.isValid=!0,r.uniforms=n,r.attributes=i,r.vertexShader="\n  uniform mat4 matModelViewProjection;\n\n  attribute vec3 a_position;\n  attribute vec4 a_color;\n  attribute vec2 a_uv;\n  varying vec2 vUv;\n  varying vec4 vColor;\n  void main() {\n    vUv = a_uv;\n    vColor = a_color;\n    gl_Position = matModelViewProjection * vec4(a_position, 1.0);\n  }\n",r.fragmentShader="\n  uniform sampler2D map;\n  varying vec2 vUv;\n  varying vec4 vColor;\n  void main(void) {\n    gl_FragColor = texture2D(map, vUv) * vColor;\n  }\n",r.states={disable:[e.CULL_FACE],enable:[e.BLEND],functions:{blendFuncSeparate:[a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA]}},this.setDepthMask(r),this.setBlendStates(r),this.setStencilState(r),this._technique=r,this.transparent=!0}},{key:"generateAttributes",value:function(){return{a_position:{name:"a_position",semantic:"POSITION",type:n.FLOAT_VEC3},a_color:{name:"a_color",semantic:"COLOR",type:n.FLOAT_VEC4},a_uv:{name:"a_uv",semantic:"TEXCOORD_0",type:n.FLOAT_VEC2}}}},{key:"generateUniform",value:function(){return{map:{name:"map",type:n.SAMPLER_2D},matModelViewProjection:{name:"matModelViewProjection",semantic:i.MODELVIEWPROJECTION,type:n.FLOAT_MAT4}}}},{key:"setStencilState",value:function(t){var e=this._stencilStates;e&&(e.stencilTest?(t.states.enable.push(this._gl.STENCIL_TEST),t.states.functions.stencilFunc=[e.stencilFunc,e.stencilFuncRef,e.stencilFuncMask],t.states.functions.stencilOp=[e.stencilOpFail,e.stencilOpZFail,e.stencilOpZPass],t.states.functions.stencilMask=[e.stencilMask]):t.states.disable.push(this._gl.STENCIL_TEST))}},{key:"setBlendStates",value:function(t){var e=this._blendStates;e&&(e.blendEquation&&(t.states.functions.blendEquationSeparate=[e.blendEquation,e.blendEquationAlpha]),"blendDstAlpha"in e||(e.blendDstAlpha=this._gl.ONE_MINUS_SRC_ALPHA,e.blendSrcAlpha=this._gl.ONE),t.states.functions.blendFuncSeparate=[e.blendSrc,e.blendDst,e.blendSrcAlpha,e.blendDstAlpha])}},{key:"setDepthMask",value:function(t){void 0!==this._depthMask&&(t.states.functions.depthMask=[this._depthMask])}},{key:"map",get:function(){return this.getValue("map")},set:function(t){this.setValue("map",t)}},{key:"prepareDrawing",value:function(t,e,a){this._technique||this._generateTechnique(),A(b(h.prototype),"prepareDrawing",this).call(this,t,e,a)}}]),h}(),C=function(t){x(a,f);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).vertices=void 0,n.indices=void 0,n.indexBuffer=void 0,n.vertexBuffer=void 0,n.verticesLength=0,n.indicesLength=0,n}return E(a,[{key:"initGeometry",value:function(t){var e=new s(this.engine,"spine_batch_geometry"),n=new Float32Array(t*a.VERTEX_SIZE),i=new Uint16Array(3*t);this.vertices=n,this.indices=i;var r=[new o("POSITION",0,h.Vector3,0),new o("COLOR",12,h.Vector4,0),new o("TEXCOORD_0",28,h.Vector2,0)],f=36*t,v=new l(this.engine,u.VertexBuffer,f,c.Dynamic),m=new l(this.engine,u.IndexBuffer,i,c.Dynamic);this.indexBuffer=m,this.vertexBuffer=v,e.setVertexBufferBinding(v,36),e.setIndexBufferBinding(m,d.UInt16),e.setVertexElements(r),e.addSubGeometry(0,i.length),this.geometry=e}},{key:"initMaterial",value:function(t){var e=t.stencil,a=t.blend,n=t.depthMask;this.material=new I(this.engine,"skeleton_material",{stencil:e,blend:a,depthMask:n})}},{key:"clear",value:function(){}},{key:"begin",value:function(){this.verticesLength=0,this.indicesLength=0}},{key:"canBatch",value:function(t,e){return!(this.indicesLength+e>=this.indices.byteLength/2)&&!(this.verticesLength+t>=this.vertices.byteLength/2)}},{key:"batch",value:function(t,e,n,i){for(var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=this.verticesLength/a.VERTEX_SIZE,o=this.vertices,h=this.verticesLength,l=0;l<e;)o[h++]=t[l++],o[h++]=t[l++],o[h++]=r,o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++];this.vertexBuffer.setData(this.vertices),this.verticesLength=h;var u=this.indices;for(h=this.indicesLength,l=0;l<i;h++,l++)u[h]=n[l]+s;this.indicesLength+=i,this.indexBuffer.setData(this.indices)}},{key:"end",value:function(){}}]),a}();C.VERTEX_SIZE=9;var V=function(){function t(){k(this,t),this.array=new Array}return E(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return null!=this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}(),P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;k(this,t),this.r=e,this.g=a,this.b=n,this.a=i}return E(t,[{key:"set",value:function(t,e,a,n){return this.r=t,this.g=e,this.b=a,this.a=n,this.clamp(),this}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this}},{key:"add",value:function(t,e,a,n){return this.r+=t,this.g+=e,this.b+=a,this.a+=n,this.clamp(),this}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}]),t}();P.WHITE=new P(1,1,1,1),P.RED=new P(1,0,0,1),P.GREEN=new P(0,1,0,1),P.BLUE=new P(0,0,1,1),P.MAGENTA=new P(1,0,1,1);var _=function(){function t(){k(this,t)}return E(t,null,[{key:"clamp",value:function(t,e,a){return t<e?e:t>a?a:t}},{key:"cosDeg",value:function(e){return Math.cos(e*t.degRad)}},{key:"sinDeg",value:function(e){return Math.sin(e*t.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}},{key:"randomTriangular",value:function(e,a){return t.randomTriangularWith(e,a,.5*(e+a))}},{key:"randomTriangularWith",value:function(t,e,a){var n=Math.random(),i=e-t;return n<=(a-t)/i?t+Math.sqrt(n*i*(a-t)):e-Math.sqrt((1-n)*i*(e-a))}}]),t}();_.PI=3.1415927,_.PI2=2*_.PI,_.radiansToDegrees=180/_.PI,_.radDeg=_.radiansToDegrees,_.degreesToRadians=_.PI/180,_.degRad=_.degreesToRadians;var N=function(){function t(){k(this,t)}return E(t,null,[{key:"arrayCopy",value:function(t,e,a,n,i){for(var r=e,s=n;r<e+i;r++,s++)a[s]=t[r]}},{key:"setArraySize",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n==e)return t;if(t.length=e,n<e)for(var i=n;i<e;i++)t[i]=a;return t}},{key:"ensureArrayCapacity",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.length>=a?e:t.setArraySize(e,a,n)}},{key:"newArray",value:function(t,e){for(var a=new Array(t),n=0;n<t;n++)a[n]=e;return a}},{key:"newFloatArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"newShortArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"toFloatArray",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}},{key:"toSinglePrecision",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}},{key:"webkit602BugfixHelper",value:function(t,e){}},{key:"contains",value:function(t,e){for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return!1}}]),t}();N.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;var L,O=function(){function t(e){k(this,t),this.items=new Array,this.instantiator=void 0,this.instantiator=e}return E(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){t.reset&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),t}(),F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;k(this,t),this.x=e,this.y=a}return E(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}]),t}(),X=function t(e,a,n){if(k(this,t),this.index=void 0,this.name=void 0,this.parent=void 0,this.length=void 0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=L.Normal,this.skinRequired=!1,this.color=new P,e<0)throw new Error("index must be >= 0.");if(null==a)throw new Error("name cannot be null.");this.index=e,this.name=a,this.parent=n};!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(L||(L={}));var Y,D,B,U=function(){function t(e,a,n){if(k(this,t),this.data=void 0,this.skeleton=void 0,this.parent=void 0,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.skeleton=a,this.parent=n,this.setToSetupPose()}return E(t,[{key:"isActive",value:function(){return this.active}},{key:"update",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransform",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransformWith",value:function(t,e,a,n,i,r,s){this.ax=t,this.ay=e,this.arotation=a,this.ascaleX=n,this.ascaleY=i,this.ashearX=r,this.ashearY=s,this.appliedValid=!0;var o=this.parent;if(null==o){var h=this.skeleton,l=a+90+s,u=h.scaleX,c=h.scaleY;return this.a=_.cosDeg(a+r)*n*u,this.b=_.cosDeg(l)*i*u,this.c=_.sinDeg(a+r)*n*c,this.d=_.sinDeg(l)*i*c,this.worldX=t*u+h.x,void(this.worldY=e*c+h.y)}var d=o.a,f=o.b,v=o.c,m=o.d;switch(this.worldX=d*t+f*e+o.worldX,this.worldY=v*t+m*e+o.worldY,this.data.transformMode){case L.Normal:var g=a+90+s,p=_.cosDeg(a+r)*n,y=_.cosDeg(g)*i,k=_.sinDeg(a+r)*n,w=_.sinDeg(g)*i;return this.a=d*p+f*k,this.b=d*y+f*w,this.c=v*p+m*k,void(this.d=v*y+m*w);case L.OnlyTranslation:var E=a+90+s;this.a=_.cosDeg(a+r)*n,this.b=_.cosDeg(E)*i,this.c=_.sinDeg(a+r)*n,this.d=_.sinDeg(E)*i;break;case L.NoRotationOrReflection:var x=d*d+v*v,b=0;x>1e-4?(x=Math.abs(d*m-f*v)/x,d/=this.skeleton.scaleX,f=(v/=this.skeleton.scaleY)*x,m=d*x,b=Math.atan2(v,d)*_.radDeg):(d=0,v=0,b=90-Math.atan2(m,f)*_.radDeg);var M=a+r-b,S=a+s-b+90,R=_.cosDeg(M)*n,T=_.cosDeg(S)*i,A=_.sinDeg(M)*n,I=_.sinDeg(S)*i;this.a=d*R-f*A,this.b=d*T-f*I,this.c=v*R+m*A,this.d=v*T+m*I;break;case L.NoScale:case L.NoScaleOrReflection:var C=_.cosDeg(a),V=_.sinDeg(a),P=(d*C+f*V)/this.skeleton.scaleX,N=(v*C+m*V)/this.skeleton.scaleY,O=Math.sqrt(P*P+N*N);O>1e-5&&(O=1/O),P*=O,N*=O,O=Math.sqrt(P*P+N*N),this.data.transformMode==L.NoScale&&d*m-f*v<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(O=-O);var F=Math.PI/2+Math.atan2(N,P),X=Math.cos(F)*O,Y=Math.sin(F)*O,D=_.cosDeg(r)*n,B=_.cosDeg(90+s)*i,U=_.sinDeg(r)*n,W=_.sinDeg(90+s)*i;this.a=P*D+X*U,this.b=P*B+X*W,this.c=N*D+Y*U,this.d=N*B+Y*W}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}},{key:"setToSetupPose",value:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}},{key:"getWorldRotationX",value:function(){return Math.atan2(this.c,this.a)*_.radDeg}},{key:"getWorldRotationY",value:function(){return Math.atan2(this.d,this.b)*_.radDeg}},{key:"getWorldScaleX",value:function(){return Math.sqrt(this.a*this.a+this.c*this.c)}},{key:"getWorldScaleY",value:function(){return Math.sqrt(this.b*this.b+this.d*this.d)}},{key:"updateAppliedTransform",value:function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*_.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*_.radDeg);var e=t.a,a=t.b,n=t.c,i=t.d,r=1/(e*i-a*n),s=this.worldX-t.worldX,o=this.worldY-t.worldY;this.ax=s*i*r-o*a*r,this.ay=o*e*r-s*n*r;var h=r*i,l=r*e,u=r*a,c=r*n,d=h*this.a-u*this.c,f=h*this.b-u*this.d,v=l*this.c-c*this.a,m=l*this.d-c*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+v*v),this.ascaleX>1e-4){var g=d*m-f*v;this.ascaleY=g/this.ascaleX,this.ashearY=Math.atan2(d*f+v*m,g)*_.radDeg,this.arotation=Math.atan2(v,d)*_.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,f)*_.radDeg}},{key:"worldToLocal",value:function(t){var e=this.a,a=this.b,n=this.c,i=this.d,r=1/(e*i-a*n),s=t.x-this.worldX,o=t.y-this.worldY;return t.x=s*i*r-o*a*r,t.y=o*e*r-s*n*r,t}},{key:"localToWorld",value:function(t){var e=t.x,a=t.y;return t.x=e*this.a+a*this.b+this.worldX,t.y=e*this.c+a*this.d+this.worldY,t}},{key:"worldToLocalRotation",value:function(t){var e=_.sinDeg(t),a=_.cosDeg(t);return Math.atan2(this.a*e-this.c*a,this.d*a-this.b*e)*_.radDeg+this.rotation-this.shearX}},{key:"localToWorldRotation",value:function(t){t-=this.rotation-this.shearX;var e=_.sinDeg(t),a=_.cosDeg(t);return Math.atan2(a*this.c+e*this.d,a*this.a+e*this.b)*_.radDeg}},{key:"rotateWorld",value:function(t){var e=this.a,a=this.b,n=this.c,i=this.d,r=_.cosDeg(t),s=_.sinDeg(t);this.a=r*e-s*n,this.b=r*a-s*i,this.c=s*e+r*n,this.d=s*a+r*i,this.appliedValid=!1}}]),t}(),W=function(){function t(e,a){if(k(this,t),this.data=void 0,this.bone=void 0,this.color=void 0,this.darkColor=void 0,this.attachment=void 0,this.slot=void 0,this.attachment=void 0,this.attachmentTime=void 0,this.attachmentState=void 0,this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("bone cannot be null.");this.data=e,this.bone=a,this.color=new P,this.darkColor=null==e.darkColor?null:new P,this.setToSetupPose()}return E(t,[{key:"getSkeleton",value:function(){return this.bone.skeleton}},{key:"getAttachment",value:function(){return this.attachment}},{key:"setAttachment",value:function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}},{key:"setAttachmentTime",value:function(t){this.attachmentTime=this.bone.skeleton.time-t}},{key:"getAttachmentTime",value:function(){return this.bone.skeleton.time-this.attachmentTime}},{key:"setToSetupPose",value:function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}]),t}(),q=function(){function t(e,a){if(k(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.mix=e.mix,this.softness=e.softness,this.bendDirection=e.bendDirection,this.compress=e.compress,this.stretch=e.stretch,this.bones=new Array;for(var n=0;n<e.bones.length;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findBone(e.target.name)}return E(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}},{key:"apply1",value:function(t,e,a,n,i,r,s){t.appliedValid||t.updateAppliedTransform();var o=t.parent,h=o.a,l=o.b,u=o.c,c=o.d,d=-t.ashearX-t.arotation,f=0,v=0;switch(t.data.transformMode){case L.OnlyTranslation:f=e-t.worldX,v=a-t.worldY;break;case L.NoRotationOrReflection:var m=Math.abs(h*c-l*u)/(h*h+u*u),g=h/t.skeleton.scaleX,p=u/t.skeleton.scaleY;l=-p*m*t.skeleton.scaleX,c=g*m*t.skeleton.scaleY,d+=Math.atan2(p,g)*_.radDeg;default:var y=e-o.worldX,k=a-o.worldY,w=h*c-l*u;f=(y*c-k*l)/w-t.ax,v=(k*h-y*u)/w-t.ay}d+=Math.atan2(v,f)*_.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var E=t.ascaleX,x=t.ascaleY;if(n||i){switch(t.data.transformMode){case L.NoScale:case L.NoScaleOrReflection:f=e-t.worldX,v=a-t.worldY}var b=t.data.length*E,M=Math.sqrt(f*f+v*v);if(n&&M<b||i&&M>b&&b>1e-4){var S=(M/b-1)*s+1;E*=S,r&&(x*=S)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*s,E,x,t.ashearX,t.ashearY)}},{key:"apply2",value:function(t,e,a,n,i,r,s,o){if(0!=o){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var h=t.ax,l=t.ay,u=t.ascaleX,c=u,d=t.ascaleY,f=e.ascaleX,v=0,m=0,g=0;u<0?(u=-u,v=180,g=-1):(v=0,g=1),d<0&&(d=-d,g=-g),f<0?(f=-f,m=180):m=0;var p=e.ax,y=0,k=0,w=0,E=t.a,x=t.b,b=t.c,M=t.d,S=Math.abs(u-d)<=1e-4;S?(k=E*p+x*(y=e.ay)+t.worldX,w=b*p+M*y+t.worldY):(y=0,k=E*p+t.worldX,w=b*p+t.worldY);var R=t.parent;E=R.a,x=R.b,b=R.c;var T,A,I=1/(E*(M=R.d)-x*b),C=k-R.worldX,V=w-R.worldY,P=(C*M-V*x)*I-h,N=(V*E-C*b)*I-l,L=Math.sqrt(P*P+N*N),O=e.data.length*f;if(L<1e-4)return this.apply1(t,a,n,!1,r,!1,o),void e.updateWorldTransformWith(p,y,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var F=((C=a-R.worldX)*M-(V=n-R.worldY)*x)*I-h,X=(V*E-C*b)*I-l,Y=F*F+X*X;if(0!=s){s*=u*(f+1)/2;var D=Math.sqrt(Y),B=D-L-O*u+s;if(B>0){var U=Math.min(1,B/(2*s))-1;Y=(F-=(U=(B-s*(1-U*U))/D)*F)*F+(X-=U*X)*X}}t:if(S){var W=(Y-L*L-(O*=u)*O)/(2*L*O);W<-1?W=-1:W>1&&(W=1,r&&(c*=(Math.sqrt(Y)/(L+O)-1)*o+1)),A=Math.acos(W)*i,E=L+O*W,x=O*Math.sin(A),T=Math.atan2(X*E-F*x,F*E+X*x)}else{var q=(E=u*O)*E,H=(x=d*O)*x,j=Math.atan2(X,F),G=-2*H*L,Z=H-q;if((M=G*G-4*Z*(b=H*L*L+q*Y-q*H))>=0){var z=Math.sqrt(M);G<0&&(z=-z);var Q=(z=-(G+z)/2)/Z,K=b/z,J=Math.abs(Q)<Math.abs(K)?Q:K;if(J*J<=Y){V=Math.sqrt(Y-J*J)*i,T=j-Math.atan2(V,J),A=Math.atan2(V/d,(J-L)/u);break t}}var $=_.PI,tt=L-E,et=tt*tt,at=0,nt=0,it=L+E,rt=it*it,st=0;(b=-E*L/(q-H))>=-1&&b<=1&&(b=Math.acos(b),(M=(C=E*Math.cos(b)+L)*C+(V=x*Math.sin(b))*V)<et&&($=b,et=M,tt=C,at=V),M>rt&&(nt=b,rt=M,it=C,st=V)),Y<=(et+rt)/2?(T=j-Math.atan2(at*i,tt),A=$*i):(T=j-Math.atan2(st*i,it),A=nt*i)}var ot=Math.atan2(y,p)*g,ht=t.arotation;(T=(T-ot)*_.radDeg+v-ht)>180?T-=360:T<-180&&(T+=360),t.updateWorldTransformWith(h,l,ht+T*o,c,t.ascaleY,0,0),ht=e.arotation,(A=((A+ot)*_.radDeg-e.ashearX)*g+m-ht)>180?A-=360:A<-180&&(A+=360),e.updateWorldTransformWith(p,y,ht+A*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()}}]),t}(),H=function(){function t(e,a){if(k(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new F,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var n=0;n<e.bones.length;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findBone(e.target.name)}return E(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}},{key:"applyAbsoluteWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target,r=i.a,s=i.b,o=i.c,h=i.d,l=r*h-s*o>0?_.degRad:-_.degRad,u=this.data.offsetRotation*l,c=this.data.offsetShearY*l,d=this.bones,f=0,v=d.length;f<v;f++){var m=d[f],g=!1;if(0!=t){var p=m.a,y=m.b,k=m.c,w=m.d,E=Math.atan2(o,r)-Math.atan2(k,p)+u;E>_.PI?E-=_.PI2:E<-_.PI&&(E+=_.PI2),E*=t;var x=Math.cos(E),b=Math.sin(E);m.a=x*p-b*k,m.b=x*y-b*w,m.c=b*p+x*k,m.d=b*y+x*w,g=!0}if(0!=e){var M=this.temp;i.localToWorld(M.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(M.x-m.worldX)*e,m.worldY+=(M.y-m.worldY)*e,g=!0}if(a>0){var S=Math.sqrt(m.a*m.a+m.c*m.c),R=Math.sqrt(r*r+o*o);S>1e-5&&(S=(S+(R-S+this.data.offsetScaleX)*a)/S),m.a*=S,m.c*=S,S=Math.sqrt(m.b*m.b+m.d*m.d),R=Math.sqrt(s*s+h*h),S>1e-5&&(S=(S+(R-S+this.data.offsetScaleY)*a)/S),m.b*=S,m.d*=S,g=!0}if(n>0){var T=m.b,A=m.d,I=Math.atan2(A,T),C=Math.atan2(h,s)-Math.atan2(o,r)-(I-Math.atan2(m.c,m.a));C>_.PI?C-=_.PI2:C<-_.PI&&(C+=_.PI2),C=I+(C+c)*n;var V=Math.sqrt(T*T+A*A);m.b=Math.cos(C)*V,m.d=Math.sin(C)*V,g=!0}g&&(m.appliedValid=!1)}}},{key:"applyRelativeWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target,r=i.a,s=i.b,o=i.c,h=i.d,l=r*h-s*o>0?_.degRad:-_.degRad,u=this.data.offsetRotation*l,c=this.data.offsetShearY*l,d=this.bones,f=0,v=d.length;f<v;f++){var m=d[f],g=!1;if(0!=t){var p=m.a,y=m.b,k=m.c,w=m.d,E=Math.atan2(o,r)+u;E>_.PI?E-=_.PI2:E<-_.PI&&(E+=_.PI2),E*=t;var x=Math.cos(E),b=Math.sin(E);m.a=x*p-b*k,m.b=x*y-b*w,m.c=b*p+x*k,m.d=b*y+x*w,g=!0}if(0!=e){var M=this.temp;i.localToWorld(M.set(this.data.offsetX,this.data.offsetY)),m.worldX+=M.x*e,m.worldY+=M.y*e,g=!0}if(a>0){var S=(Math.sqrt(r*r+o*o)-1+this.data.offsetScaleX)*a+1;m.a*=S,m.c*=S,S=(Math.sqrt(s*s+h*h)-1+this.data.offsetScaleY)*a+1,m.b*=S,m.d*=S,g=!0}if(n>0){var R=Math.atan2(h,s)-Math.atan2(o,r);R>_.PI?R-=_.PI2:R<-_.PI&&(R+=_.PI2);var T=m.b,A=m.d;R=Math.atan2(A,T)+(R-_.PI/2+c)*n;var I=Math.sqrt(T*T+A*A);m.b=Math.cos(R)*I,m.d=Math.sin(R)*I,g=!0}g&&(m.appliedValid=!1)}}},{key:"applyAbsoluteLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var r=this.bones,s=0,o=r.length;s<o;s++){var h=r[s];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;if(0!=t){var u=i.arotation-l+this.data.offsetRotation;l+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=h.ax,d=h.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,d+=(i.ay-d+this.data.offsetY)*e);var f=h.ascaleX,v=h.ascaleY;0!=a&&(f>1e-5&&(f=(f+(i.ascaleX-f+this.data.offsetScaleX)*a)/f),v>1e-5&&(v=(v+(i.ascaleY-v+this.data.offsetScaleY)*a)/v));var m=h.ashearY;if(0!=n){var g=i.ashearY-m+this.data.offsetShearY;g-=360*(16384-(16384.499999999996-g/360|0)),h.shearY+=g*n}h.updateWorldTransformWith(c,d,l,f,v,h.ashearX,m)}}},{key:"applyRelativeLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var r=this.bones,s=0,o=r.length;s<o;s++){var h=r[s];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;0!=t&&(l+=(i.arotation+this.data.offsetRotation)*t);var u=h.ax,c=h.ay;0!=e&&(u+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);var d=h.ascaleX,f=h.ascaleY;0!=a&&(d>1e-5&&(d*=(i.ascaleX-1+this.data.offsetScaleX)*a+1),f>1e-5&&(f*=(i.ascaleY-1+this.data.offsetScaleY)*a+1));var v=h.ashearY;0!=n&&(v+=(i.ashearY+this.data.offsetShearY)*n),h.updateWorldTransformWith(u,c,l,d,f,h.ashearX,v)}}}]),t}(),j=function t(e,a,n){k(this,t),this.name=e,this.order=a,this.skinRequired=n},G=function(t){x(a,j);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.positionMode=void 0,n.spacingMode=void 0,n.rotateMode=void 0,n.offsetRotation=void 0,n.position=void 0,n.spacing=void 0,n.rotateMix=void 0,n.translateMix=void 0,n}return a}();!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(Y||(Y={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(D||(D={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(B||(B={}));var Z=function t(e){if(k(this,t),this.name=void 0,null==e)throw new Error("name cannot be null.");this.name=e},z=function(t){x(a,Z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).id=(65535&a.nextID++)<<11,n.bones=void 0,n.vertices=void 0,n.worldVerticesLength=0,n.deformAttachment=S(n),n}return E(a,[{key:"computeWorldVertices",value:function(t,e,a,n,i,r){a=i+(a>>1)*r;var s=t.bone.skeleton,o=t.deform,h=this.vertices,l=this.bones;if(null!=l){for(var u=0,c=0,d=0;d<e;d+=2){var f=l[u];u+=f+1,c+=f}var v=s.bones;if(0==o.length)for(var m=i,g=3*c;m<a;m+=r){var p=0,y=0,k=l[u++];for(k+=u;u<k;u++,g+=3){var w=v[l[u]],E=h[g],x=h[g+1],b=h[g+2];p+=(E*w.a+x*w.b+w.worldX)*b,y+=(E*w.c+x*w.d+w.worldY)*b}n[m]=p,n[m+1]=y}else for(var M=o,S=i,R=3*c,T=c<<1;S<a;S+=r){var A=0,I=0,C=l[u++];for(C+=u;u<C;u++,R+=3,T+=2){var V=v[l[u]],P=h[R]+M[T],_=h[R+1]+M[T+1],N=h[R+2];A+=(P*V.a+_*V.b+V.worldX)*N,I+=(P*V.c+_*V.d+V.worldY)*N}n[S]=A,n[S+1]=I}}else{o.length>0&&(h=o);for(var L=t.bone,O=L.worldX,F=L.worldY,X=L.a,Y=L.b,D=L.c,B=L.d,U=e,W=i;W<a;U+=2,W+=r){var q=h[U],H=h[U+1];n[W]=q*X+H*Y+O,n[W+1]=q*D+H*B+F}}}},{key:"copyTo",value:function(t){null!=this.bones?(t.bones=new Array(this.bones.length),N.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=N.newFloatArray(this.vertices.length),N.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}]),a}();z.nextID=0;var Q=function(t){x(a,z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).lengths=void 0,n.closed=!1,n.constantSpeed=!1,n.color=new P(1,1,1,1),n}return E(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),N.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}]),a}(),K=function(){function t(e,a){if(k(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==a)throw new Error("skeleton cannot be null.");this.data=e,this.bones=new Array;for(var n=0,i=e.bones.length;n<i;n++)this.bones.push(a.findBone(e.bones[n].name));this.target=a.findSlot(e.target.name),this.position=e.position,this.spacing=e.spacing,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix}return E(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var e=this.target.getAttachment();if(e instanceof Q){var a=this.rotateMix,n=this.translateMix,i=a>0;if(n>0||i){var r=this.data,s=r.spacingMode==D.Percent,o=r.rotateMode,h=o==B.Tangent,l=o==B.ChainScale,u=this.bones.length,c=h?u:u+1,d=this.bones,f=N.setArraySize(this.spaces,c),v=null,m=this.spacing;if(l||!s){l&&(v=N.setArraySize(this.lengths,u));for(var g=r.spacingMode==D.Length,p=0,y=c-1;p<y;){var k=d[p],w=k.data.length;if(w<t.epsilon)l&&(v[p]=0),f[++p]=0;else if(s){if(l){var E=w*k.a,x=w*k.c,b=Math.sqrt(E*E+x*x);v[p]=b}f[++p]=m}else{var M=w*k.a,S=w*k.c,R=Math.sqrt(M*M+S*S);l&&(v[p]=R),f[++p]=(g?w+m:m)*R/w}}}else for(var T=1;T<c;T++)f[T]=m;var A=this.computeWorldPositions(e,c,h,r.positionMode==Y.Percent,s),I=A[0],C=A[1],V=r.offsetRotation,P=!1;if(0==V)P=o==B.Chain;else{P=!1;var L=this.target.bone;V*=L.a*L.d-L.b*L.c>0?_.degRad:-_.degRad}for(var O=0,F=3;O<u;O++,F+=3){var X=d[O];X.worldX+=(I-X.worldX)*n,X.worldY+=(C-X.worldY)*n;var U=A[F],W=A[F+1],q=U-I,H=W-C;if(l){var j=v[O];if(0!=j){var G=(Math.sqrt(q*q+H*H)/j-1)*a+1;X.a*=G,X.c*=G}}if(I=U,C=W,i){var Z=X.a,z=X.b,K=X.c,J=X.d,$=0,tt=0,et=0;if($=h?A[F-1]:0==f[O+1]?A[F+2]:Math.atan2(H,q),$-=Math.atan2(K,Z),P){tt=Math.cos($),et=Math.sin($);var at=X.data.length;I+=(at*(tt*Z-et*K)-q)*a,C+=(at*(et*Z+tt*K)-H)*a}else $+=V;$>_.PI?$-=_.PI2:$<-_.PI&&($+=_.PI2),$*=a,tt=Math.cos($),et=Math.sin($),X.a=tt*Z-et*K,X.b=tt*z-et*J,X.c=et*Z+tt*K,X.d=et*z+tt*J}X.appliedValid=!1}}}}},{key:"computeWorldPositions",value:function(e,a,n,i,r){var s=this.target,o=this.position,h=this.spaces,l=N.setArraySize(this.positions,3*a+2),u=null,c=e.closed,d=e.worldVerticesLength,f=d/6,v=t.NONE;if(!e.constantSpeed){var m=e.lengths,g=m[f-=c?1:2];if(i&&(o*=g),r)for(var p=1;p<a;p++)h[p]*=g;u=N.setArraySize(this.world,8);for(var y=0,k=0,w=0;y<a;y++,k+=3){var E=h[y],x=o+=E;if(c)(x%=g)<0&&(x+=g),w=0;else{if(x<0){v!=t.BEFORE&&(v=t.BEFORE,e.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(x,u,0,l,k);continue}if(x>g){v!=t.AFTER&&(v=t.AFTER,e.computeWorldVertices(s,d-6,4,u,0,2)),this.addAfterPosition(x-g,u,0,l,k);continue}}for(;;w++){var b=m[w];if(!(x>b)){if(0==w)x/=b;else{var M=m[w-1];x=(x-M)/(b-M)}break}}w!=v&&(v=w,c&&w==f?(e.computeWorldVertices(s,d-4,4,u,0,2),e.computeWorldVertices(s,0,4,u,4,2)):e.computeWorldVertices(s,6*w+2,8,u,0,2)),this.addCurvePosition(x,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],l,k,n||y>0&&0==E)}return l}c?(d+=2,u=N.setArraySize(this.world,d),e.computeWorldVertices(s,2,d-4,u,0,2),e.computeWorldVertices(s,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(f--,d-=4,u=N.setArraySize(this.world,d),e.computeWorldVertices(s,2,d,u,0,2));for(var S=N.setArraySize(this.curves,f),R=0,T=u[0],A=u[1],I=0,C=0,V=0,P=0,_=0,L=0,O=0,F=0,X=0,Y=0,D=0,B=0,U=0,W=0,q=0,H=2;q<f;q++,H+=6)I=u[H],C=u[H+1],V=u[H+2],P=u[H+3],D=2*(O=.1875*(T-2*I+V))+(X=.09375*(3*(I-V)-T+(_=u[H+4]))),B=2*(F=.1875*(A-2*C+P))+(Y=.09375*(3*(C-P)-A+(L=u[H+5]))),U=.75*(I-T)+O+.16666667*X,W=.75*(C-A)+F+.16666667*Y,R+=Math.sqrt(U*U+W*W),U+=D,W+=B,D+=X,B+=Y,R+=Math.sqrt(U*U+W*W),U+=D,W+=B,R+=Math.sqrt(U*U+W*W),U+=D+X,W+=B+Y,R+=Math.sqrt(U*U+W*W),S[q]=R,T=_,A=L;if(o*=i?R:R/e.lengths[f-1],r)for(var j=1;j<a;j++)h[j]*=R;for(var G=this.segments,Z=0,z=0,Q=0,K=0,J=0;z<a;z++,Q+=3){var $=h[z],tt=o+=$;if(c)(tt%=R)<0&&(tt+=R),K=0;else{if(tt<0){this.addBeforePosition(tt,u,0,l,Q);continue}if(tt>R){this.addAfterPosition(tt-R,u,d-4,l,Q);continue}}for(;;K++){var et=S[K];if(!(tt>et)){if(0==K)tt/=et;else{var at=S[K-1];tt=(tt-at)/(et-at)}break}}if(K!=v){v=K;var nt=6*K;for(T=u[nt],A=u[nt+1],I=u[nt+2],C=u[nt+3],V=u[nt+4],P=u[nt+5],D=2*(O=.03*(T-2*I+V))+(X=.006*(3*(I-V)-T+(_=u[nt+6]))),B=2*(F=.03*(A-2*C+P))+(Y=.006*(3*(C-P)-A+(L=u[nt+7]))),U=.3*(I-T)+O+.16666667*X,W=.3*(C-A)+F+.16666667*Y,Z=Math.sqrt(U*U+W*W),G[0]=Z,nt=1;nt<8;nt++)U+=D,W+=B,D+=X,B+=Y,Z+=Math.sqrt(U*U+W*W),G[nt]=Z;U+=D,W+=B,Z+=Math.sqrt(U*U+W*W),G[8]=Z,U+=D+X,W+=B+Y,Z+=Math.sqrt(U*U+W*W),G[9]=Z,J=0}for(tt*=Z;;J++){var it=G[J];if(!(tt>it)){if(0==J)tt/=it;else{var rt=G[J-1];tt=J+(tt-rt)/(it-rt)}break}}this.addCurvePosition(.1*tt,T,A,I,C,V,P,_,L,l,Q,n||z>0&&0==$)}return l}},{key:"addBeforePosition",value:function(t,e,a,n,i){var r=e[a],s=e[a+1],o=e[a+2]-r,h=e[a+3]-s,l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=s+t*Math.sin(l),n[i+2]=l}},{key:"addAfterPosition",value:function(t,e,a,n,i){var r=e[a+2],s=e[a+3],o=r-e[a],h=s-e[a+1],l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=s+t*Math.sin(l),n[i+2]=l}},{key:"addCurvePosition",value:function(t,e,a,n,i,r,s,o,h,l,u,c){if(0==t||isNaN(t))return l[u]=e,l[u+1]=a,void(l[u+2]=Math.atan2(i-a,n-e));var d=t*t,f=d*t,v=1-t,m=v*v,g=m*v,p=v*t,y=3*p,k=v*y,w=y*t,E=e*g+n*k+r*w+o*f,x=a*g+i*k+s*w+h*f;l[u]=E,l[u+1]=x,c&&(l[u+2]=t<.001?Math.atan2(i-a,n-e):Math.atan2(x-(a*m+i*p*2+s*d),E-(e*m+n*p*2+r*d)))}}]),t}();K.NONE=-1,K.BEFORE=-2,K.AFTER=-3,K.epsilon=1e-5;var J=function(t){x(a,Z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new P(1,1,1,1),n.path=void 0,n.rendererObject=void 0,n.region=void 0,n.offset=N.newFloatArray(8),n.uvs=N.newFloatArray(8),n.tempColor=new P(1,1,1,1),n}return E(a,[{key:"updateOffset",value:function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,i=-this.height/2*this.scaleY+this.region.offsetY*e,r=n+this.region.width*t,s=i+this.region.height*e,o=this.rotation*Math.PI/180,h=Math.cos(o),l=Math.sin(o),u=n*h+this.x,c=n*l,d=i*h+this.y,f=i*l,v=r*h+this.x,m=r*l,g=s*h+this.y,p=s*l,y=this.offset;y[a.OX1]=u-f,y[a.OY1]=d+c,y[a.OX2]=u-p,y[a.OY2]=g+c,y[a.OX3]=v-p,y[a.OY3]=g+m,y[a.OX4]=v-f,y[a.OY4]=d+m}},{key:"setRegion",value:function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}},{key:"computeWorldVertices",value:function(t,e,n,i){var r=this.offset,s=t.worldX,o=t.worldY,h=t.a,l=t.b,u=t.c,c=t.d,d=0,f=0;d=r[a.OX1],f=r[a.OY1],e[n]=d*h+f*l+s,e[n+1]=d*u+f*c+o,n+=i,d=r[a.OX2],f=r[a.OY2],e[n]=d*h+f*l+s,e[n+1]=d*u+f*c+o,n+=i,d=r[a.OX3],f=r[a.OY3],e[n]=d*h+f*l+s,e[n+1]=d*u+f*c+o,n+=i,d=r[a.OX4],f=r[a.OY4],e[n]=d*h+f*l+s,e[n+1]=d*u+f*c+o}},{key:"copy",value:function(){var t=new a(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,N.arrayCopy(this.uvs,0,t.uvs,0,8),N.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}]),a}();J.OX1=0,J.OY1=1,J.OX2=2,J.OY2=3,J.OX3=4,J.OY3=5,J.OX4=6,J.OY4=7,J.X1=0,J.Y1=1,J.C1R=2,J.C1G=3,J.C1B=4,J.C1A=5,J.U1=6,J.V1=7,J.X2=8,J.Y2=9,J.C2R=10,J.C2G=11,J.C2B=12,J.C2A=13,J.U2=14,J.V2=15,J.X3=16,J.Y3=17,J.C3R=18,J.C3G=19,J.C3B=20,J.C3A=21,J.U3=22,J.V3=23,J.X4=24,J.Y4=25,J.C4R=26,J.C4G=27,J.C4B=28,J.C4A=29,J.U4=30,J.V4=31;var $,tt,et=function(){function t(e){k(this,t),this._image=void 0,this._image=e}return E(t,[{key:"getImage",value:function(){return this._image}}],[{key:"filterFromString",value:function(t){switch(t.toLowerCase()){case"nearest":return $.Nearest;case"linear":return $.Linear;case"mipmap":return $.MipMap;case"mipmapnearestnearest":return $.MipMapNearestNearest;case"mipmaplinearnearest":return $.MipMapLinearNearest;case"mipmapnearestlinear":return $.MipMapNearestLinear;case"mipmaplinearlinear":return $.MipMapLinearLinear;default:throw new Error("Unknown texture filter ".concat(t))}}},{key:"wrapFromString",value:function(t){switch(t.toLowerCase()){case"mirroredtepeat":return tt.MirroredRepeat;case"clamptoedge":return tt.ClampToEdge;case"repeat":return tt.Repeat;default:throw new Error("Unknown texture wrap ".concat(t))}}}]),t}();!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}($||($={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(tt||(tt={}));var at,nt,it,rt=function t(){k(this,t),this.renderObject=void 0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0},st=function(t){x(a,et);var e=T(a);function a(){return k(this,a),e.apply(this,arguments)}return E(a,[{key:"setFilters",value:function(t,e){}},{key:"setWraps",value:function(t,e){}},{key:"dispose",value:function(){}}]),a}(),ot=function(){function t(e,a){k(this,t),this.pages=new Array,this.regions=new Array,this.load(e,a)}return E(t,[{key:"load",value:function(t,e){if(null==e)throw new Error("textureLoader cannot be null.");for(var a=new ht(t),n=new Array(4),i=null;;){var r=a.readLine();if(null==r)break;if(0==(r=r.trim()).length)i=null;else if(i){var s=new ut;s.name=r,s.page=i;var o=a.readValue();"true"==o.toLocaleLowerCase()?s.degrees=90:"false"==o.toLocaleLowerCase()?s.degrees=0:s.degrees=parseFloat(o),s.rotate=90==s.degrees,a.readTuple(n);var h=parseInt(n[0]),l=parseInt(n[1]);a.readTuple(n);var u=parseInt(n[0]),c=parseInt(n[1]);s.u=h/i.width,s.v=l/i.height,s.rotate?(s.u2=(h+c)/i.width,s.v2=(l+u)/i.height):(s.u2=(h+u)/i.width,s.v2=(l+c)/i.height),s.x=h,s.y=l,s.width=Math.abs(u),s.height=Math.abs(c),4==a.readTuple(n)&&4==a.readTuple(n)&&a.readTuple(n),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),a.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(a.readValue()),s.texture=i.texture,this.regions.push(s)}else{(i=new lt).name=r,2==a.readTuple(n)&&(i.width=parseInt(n[0]),i.height=parseInt(n[1]),a.readTuple(n)),a.readTuple(n),i.minFilter=et.filterFromString(n[0]),i.magFilter=et.filterFromString(n[1]);var d=a.readValue();i.uWrap=tt.ClampToEdge,i.vWrap=tt.ClampToEdge,"x"==d?i.uWrap=tt.Repeat:"y"==d?i.vWrap=tt.Repeat:"xy"==d&&(i.uWrap=i.vWrap=tt.Repeat),i.texture=e(r,i.width,i.height),i.texture.setFilters(i.minFilter,i.magFilter),i.texture.setWraps(i.uWrap,i.vWrap),i.width=i.texture.getImage().width,i.height=i.texture.getImage().height,this.pages.push(i)}}}},{key:"findRegion",value:function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}},{key:"dispose",value:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}]),t}(),ht=function(){function t(e){k(this,t),this.lines=void 0,this.index=0,this.lines=e.split(/\r\n|\r|\n/)}return E(t,[{key:"readLine",value:function(){return this.index>=this.lines.length?null:this.lines[this.index++]}},{key:"readValue",value:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}},{key:"readTuple",value:function(t){var e=this.readLine(),a=e.indexOf(":");if(-1==a)throw new Error("Invalid line: "+e);for(var n=0,i=a+1;n<3;n++){var r=e.indexOf(",",i);if(-1==r)break;t[n]=e.substr(i,r-i).trim(),i=r+1}return t[n]=e.substring(i).trim(),n+1}}]),t}(),lt=function t(){k(this,t),this.name=void 0,this.minFilter=void 0,this.magFilter=void 0,this.uWrap=void 0,this.vWrap=void 0,this.texture=void 0,this.width=void 0,this.height=void 0},ut=function(t){x(a,rt);var e=T(a);function a(){var t;k(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).page=void 0,t.name=void 0,t.x=void 0,t.y=void 0,t.index=void 0,t.rotate=void 0,t.degrees=void 0,t.texture=void 0,t}return a}(),ct=function(t){x(a,z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).region=void 0,n.path=void 0,n.regionUVs=void 0,n.uvs=void 0,n.triangles=void 0,n.color=new P(1,1,1,1),n.width=void 0,n.height=void 0,n.hullLength=void 0,n.edges=void 0,n.parentMesh=void 0,n.tempColor=new P(0,0,0,0),n}return E(a,[{key:"updateUVs",value:function(){var t=this.regionUVs;null!=this.uvs&&this.uvs.length==t.length||(this.uvs=N.newFloatArray(t.length));var e=this.uvs,a=this.uvs.length,n=this.region.u,i=this.region.v,r=0,s=0;if(this.region instanceof ut){var o=this.region,h=o.texture.getImage().width,l=o.texture.getImage().height;switch(o.degrees){case 90:n-=(o.originalHeight-o.offsetY-o.height)/h,i-=(o.originalWidth-o.offsetX-o.width)/l,r=o.originalHeight/h,s=o.originalWidth/l;for(var u=0;u<a;u+=2)e[u]=n+t[u+1]*r,e[u+1]=i+(1-t[u])*s;return;case 180:n-=(o.originalWidth-o.offsetX-o.width)/h,i-=o.offsetY/l,r=o.originalWidth/h,s=o.originalHeight/l;for(var c=0;c<a;c+=2)e[c]=n+(1-t[c])*r,e[c+1]=i+(1-t[c+1])*s;return;case 270:n-=o.offsetY/h,i-=o.offsetX/l,r=o.originalHeight/h,s=o.originalWidth/l;for(var d=0;d<a;d+=2)e[d]=n+(1-t[d+1])*r,e[d+1]=i+t[d]*s;return}n-=o.offsetX/h,i-=(o.originalHeight-o.offsetY-o.height)/l,r=o.originalWidth/h,s=o.originalHeight/l}else null==this.region?(n=i=0,r=s=1):(r=this.region.u2-n,s=this.region.v2-i);for(var f=0;f<a;f+=2)e[f]=n+t[f]*r,e[f+1]=i+t[f+1]*s}},{key:"getParentMesh",value:function(){return this.parentMesh}},{key:"setParentMesh",value:function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},{key:"copy",value:function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new a(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),N.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),N.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),N.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),N.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}},{key:"newLinkedMesh",value:function(){var t=new a(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t}}]),a}(),dt=function(){function t(e){if(k(this,t),this.data=void 0,this.bones=void 0,this.slots=void 0,this.drawOrder=void 0,this.ikConstraints=void 0,this.transformConstraints=void 0,this.pathConstraints=void 0,this._updateCache=new Array,this.updateCacheReset=new Array,this.skin=void 0,this.color=void 0,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var a=0;a<e.bones.length;a++){var n=e.bones[a],i=void 0;if(null==n.parent)i=new U(n,this,null);else{var r=this.bones[n.parent.index];i=new U(n,this,r),r.children.push(i)}this.bones.push(i)}this.slots=new Array,this.drawOrder=new Array;for(var s=0;s<e.slots.length;s++){var o=e.slots[s],h=this.bones[o.boneData.index],l=new W(o,h);this.slots.push(l),this.drawOrder.push(l)}this.ikConstraints=new Array;for(var u=0;u<e.ikConstraints.length;u++){var c=e.ikConstraints[u];this.ikConstraints.push(new q(c,this))}this.transformConstraints=new Array;for(var d=0;d<e.transformConstraints.length;d++){var f=e.transformConstraints[d];this.transformConstraints.push(new H(f,this))}this.pathConstraints=new Array;for(var v=0;v<e.pathConstraints.length;v++){var m=e.pathConstraints[v];this.pathConstraints.push(new K(m,this))}this.color=new P(1,1,1,1),this.updateCache()}return E(t,[{key:"updateCache",value:function(){var t=this._updateCache;t.length=0,this.updateCacheReset.length=0;for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];i.sorted=i.data.skinRequired,i.active=!i.sorted}if(null!=this.skin)for(var r=this.skin.bones,s=0,o=this.skin.bones.length;s<o;s++){var h=this.bones[r[s].index];do{h.sorted=!1,h.active=!0,h=h.parent}while(null!=h)}var l=this.ikConstraints,u=this.transformConstraints,c=this.pathConstraints,d=l.length,f=u.length,v=c.length,m=d+f+v;t:for(var g=0;g<m;g++){for(var p=0;p<d;p++){var y=l[p];if(y.data.order==g){this.sortIkConstraint(y);continue t}}for(var k=0;k<f;k++){var w=u[k];if(w.data.order==g){this.sortTransformConstraint(w);continue t}}for(var E=0;E<v;E++){var x=c[E];if(x.data.order==g){this.sortPathConstraint(x);continue t}}}for(var b=0,M=e.length;b<M;b++)this.sortBone(e[b])}},{key:"sortIkConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&N.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var a=t.bones,n=a[0];if(this.sortBone(n),a.length>1){var i=a[a.length-1];this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}this._updateCache.push(t),this.sortReset(n.children),a[a.length-1].sorted=!0}}},{key:"sortPathConstraint",value:function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&N.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,a=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,a,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,a,n);for(var i=0,r=this.data.skins.length;i<r;i++)this.sortPathConstraintAttachment(this.data.skins[i],a,n);var s=e.getAttachment();s instanceof Q&&this.sortPathConstraintAttachmentWith(s,n);for(var o=t.bones,h=o.length,l=0;l<h;l++)this.sortBone(o[l]);this._updateCache.push(t);for(var u=0;u<h;u++)this.sortReset(o[u].children);for(var c=0;c<h;c++)o[c].sorted=!0}}},{key:"sortTransformConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&N.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,a=e.length;if(t.data.local)for(var n=0;n<a;n++){var i=e[n];this.sortBone(i.parent),this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}else for(var r=0;r<a;r++)this.sortBone(e[r]);this._updateCache.push(t);for(var s=0;s<a;s++)this.sortReset(e[s].children);for(var o=0;o<a;o++)e[o].sorted=!0}}},{key:"sortPathConstraintAttachment",value:function(t,e,a){var n=t.attachments[e];if(n)for(var i in n)this.sortPathConstraintAttachmentWith(n[i],a)}},{key:"sortPathConstraintAttachmentWith",value:function(t,e){if(t instanceof Q){var a=t.bones;if(null==a)this.sortBone(e);else for(var n=this.bones,i=0;i<a.length;)for(var r=a[i++],s=i+r;i<s;i++){var o=a[i];this.sortBone(n[o])}}}},{key:"sortBone",value:function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}}},{key:"sortReset",value:function(t){for(var e=0,a=t.length;e<a;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}},{key:"updateWorldTransform",value:function(){for(var t=this.updateCacheReset,e=0,a=t.length;e<a;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var i=this._updateCache,r=0,s=i.length;r<s;r++)i[r].update()}},{key:"setToSetupPose",value:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}},{key:"setBonesToSetupPose",value:function(){for(var t=this.bones,e=0,a=t.length;e<a;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,i=0,r=n.length;i<r;i++){var s=n[i];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}for(var o=this.transformConstraints,h=0,l=o.length;h<l;h++){var u=o[h],c=u.data;u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,u.shearMix=c.shearMix}for(var d=this.pathConstraints,f=0,v=d.length;f<v;f++){var m=d[f],g=m.data;m.position=g.position,m.spacing=g.spacing,m.rotateMix=g.rotateMix,m.translateMix=g.translateMix}}},{key:"setSlotsToSetupPose",value:function(){var t=this.slots;N.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,a=t.length;e<a;e++)t[e].setToSetupPose()}},{key:"getRootBone",value:function(){return 0==this.bones.length?null:this.bones[0]}},{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"setSkinByName",value:function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)}},{key:"setSkin",value:function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a],r=i.data.attachmentName;if(null!=r){var s=t.getAttachment(a,r);null!=s&&i.setAttachment(s)}}this.skin=t,this.updateCache()}}},{key:"getAttachmentByName",value:function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}},{key:"getAttachment",value:function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var a=this.skin.getAttachment(t,e);if(null!=a)return a}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}},{key:"setAttachment",value:function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var a=this.slots,n=0,i=a.length;n<i;n++){var r=a[n];if(r.data.name==t){var s=null;if(null!=e&&null==(s=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(s)}}throw new Error("Slot not found: "+t)}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"getBounds",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array(2);if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=0,l=n.length;h<l;h++){var u=n[h];if(u.bone.active){var c=0,d=null,f=u.getAttachment();if(f instanceof J)c=8,d=N.setArraySize(a,c,0),f.computeWorldVertices(u.bone,d,0,2);else if(f instanceof ct){var v=f;c=v.worldVerticesLength,d=N.setArraySize(a,c,0),v.computeWorldVertices(u,0,c,d,0,2)}if(null!=d)for(var m=0,g=d.length;m<g;m+=2){var p=d[m],y=d[m+1];i=Math.min(i,p),r=Math.min(r,y),s=Math.max(s,p),o=Math.max(o,y)}}}t.set(i,r),e.set(s-i,o-r)}},{key:"update",value:function(t){this.time+=t}}]),t}(),ft=function(){function t(e,a,n){if(k(this,t),this.name=void 0,this.timelines=void 0,this.timelineIds=void 0,this.duration=void 0,null==e)throw new Error("name cannot be null.");if(null==a)throw new Error("timelines cannot be null.");this.name=e,this.timelines=a,this.timelineIds=[];for(var i=0;i<a.length;i++)this.timelineIds[a[i].getPropertyId()]=!0;this.duration=n}return E(t,[{key:"hasTimeline",value:function(t){return 1==this.timelineIds[t]}},{key:"apply",value:function(t,e,a,n,i,r,s,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(a%=this.duration,e>0&&(e%=this.duration));for(var h=this.timelines,l=0,u=h.length;l<u;l++)h[l].apply(t,e,a,i,r,s,o)}}],[{key:"binarySearch",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,i=t.length/a-2;if(0==i)return a;for(var r=i>>>1;;){if(t[(r+1)*a]<=e?n=r+1:i=r,n==i)return(n+1)*a;r=n+i>>>1}}},{key:"linearSearch",value:function(t,e,a){for(var n=0,i=t.length-a;n<=i;n+=a)if(t[n]>e)return n;return-1}}]),t}();!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(at||(at={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(nt||(nt={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(it||(it={}));var vt=function(){function t(e){if(k(this,t),this.curves=void 0,e<=0)throw new Error("frameCount must be > 0: "+e);this.curves=N.newFloatArray((e-1)*t.BEZIER_SIZE)}return E(t,[{key:"getFrameCount",value:function(){return this.curves.length/t.BEZIER_SIZE+1}},{key:"setLinear",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR}},{key:"setStepped",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED}},{key:"getCurveType",value:function(e){var a=e*t.BEZIER_SIZE;if(a==this.curves.length)return t.LINEAR;var n=this.curves[a];return n==t.LINEAR?t.LINEAR:n==t.STEPPED?t.STEPPED:t.BEZIER}},{key:"setCurve",value:function(e,a,n,i,r){var s=.03*(2*-a+i),o=.03*(2*-n+r),h=.006*(3*(a-i)+1),l=.006*(3*(n-r)+1),u=2*s+h,c=2*o+l,d=.3*a+s+.16666667*h,f=.3*n+o+.16666667*l,v=e*t.BEZIER_SIZE,m=this.curves;m[v++]=t.BEZIER;for(var g=d,p=f,y=v+t.BEZIER_SIZE-1;v<y;v+=2)m[v]=g,m[v+1]=p,d+=u,f+=c,u+=h,c+=l,g+=d,p+=f}},{key:"getCurvePercent",value:function(e,a){a=_.clamp(a,0,1);var n=this.curves,i=e*t.BEZIER_SIZE,r=n[i];if(r==t.LINEAR)return a;if(r==t.STEPPED)return 0;for(var s=0,o=++i,h=i+t.BEZIER_SIZE-1;i<h;i+=2)if((s=n[i])>=a){var l=void 0,u=void 0;return i==o?(l=0,u=0):(l=n[i-2],u=n[i-1]),u+(n[i+1]-u)*(a-l)/(s-l)}var c=n[i-1];return c+(1-c)*(a-s)/(1-s)}}]),t}();vt.LINEAR=0,vt.STEPPED=1,vt.BEZIER=2,vt.BEZIER_SIZE=19;var mt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t<<1),n}return E(a,[{key:"getPropertyId",value:function(){return(it.rotate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=n}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return void(l.rotation=l.data.rotation);case at.first:var u=l.data.rotation-l.rotation;l.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*r}else if(n>=h[h.length-a.ENTRIES]){var c=h[h.length+a.PREV_ROTATION];switch(s){case at.setup:l.rotation=l.data.rotation+c*r;break;case at.first:case at.replace:c+=l.data.rotation-l.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case at.add:l.rotation+=c*r}}else{var d=ft.binarySearch(h,n,a.ENTRIES),f=h[d+a.PREV_ROTATION],v=h[d],m=this.getCurvePercent((d>>1)-1,1-(n-v)/(h[d+a.PREV_TIME]-v)),g=h[d+a.ROTATION]-f;switch(g=f+(g-360*(16384-(16384.499999999996-g/360|0)))*m,s){case at.setup:l.rotation=l.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*r;break;case at.first:case at.replace:g+=l.data.rotation-l.rotation;case at.add:l.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*r}}}}]),a}();mt.ENTRIES=2,mt.PREV_TIME=-2,mt.PREV_ROTATION=-1,mt.ROTATION=1;var gt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.translate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=n,this.frames[t+a.Y]=i}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return l.x=l.data.x,void(l.y=l.data.y);case at.first:l.x+=(l.data.x-l.x)*r,l.y+=(l.data.y-l.y)*r}else{var u=0,c=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_X],c=h[h.length+a.PREV_Y];else{var d=ft.binarySearch(h,n,a.ENTRIES);u=h[d+a.PREV_X],c=h[d+a.PREV_Y];var f=h[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(h[d+a.PREV_TIME]-f));u+=(h[d+a.X]-u)*v,c+=(h[d+a.Y]-c)*v}switch(s){case at.setup:l.x=l.data.x+u*r,l.y=l.data.y+c*r;break;case at.first:case at.replace:l.x+=(l.data.x+u-l.x)*r,l.y+=(l.data.y+c-l.y)*r;break;case at.add:l.x+=u*r,l.y+=c*r}}}}]),a}();gt.ENTRIES=3,gt.PREV_TIME=-3,gt.PREV_X=-2,gt.PREV_Y=-1,gt.X=1,gt.Y=2;var pt=function(t){x(a,gt);var e=T(a);function a(t){return k(this,a),e.call(this,t)}return E(a,[{key:"getPropertyId",value:function(){return(it.scale<<24)+this.boneIndex}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case at.first:l.scaleX+=(l.data.scaleX-l.scaleX)*r,l.scaleY+=(l.data.scaleY-l.scaleY)*r}else{var u=0,c=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_X]*l.data.scaleX,c=h[h.length+a.PREV_Y]*l.data.scaleY;else{var d=ft.binarySearch(h,n,a.ENTRIES);u=h[d+a.PREV_X],c=h[d+a.PREV_Y];var f=h[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(h[d+a.PREV_TIME]-f));u=(u+(h[d+a.X]-u)*v)*l.data.scaleX,c=(c+(h[d+a.Y]-c)*v)*l.data.scaleY}if(1==r)s==at.add?(l.scaleX+=u-l.data.scaleX,l.scaleY+=c-l.data.scaleY):(l.scaleX=u,l.scaleY=c);else{var m=0,g=0;if(o==nt.mixOut)switch(s){case at.setup:m=l.data.scaleX,g=l.data.scaleY,l.scaleX=m+(Math.abs(u)*_.signum(m)-m)*r,l.scaleY=g+(Math.abs(c)*_.signum(g)-g)*r;break;case at.first:case at.replace:m=l.scaleX,g=l.scaleY,l.scaleX=m+(Math.abs(u)*_.signum(m)-m)*r,l.scaleY=g+(Math.abs(c)*_.signum(g)-g)*r;break;case at.add:m=l.scaleX,g=l.scaleY,l.scaleX=m+(Math.abs(u)*_.signum(m)-l.data.scaleX)*r,l.scaleY=g+(Math.abs(c)*_.signum(g)-l.data.scaleY)*r}else switch(s){case at.setup:m=Math.abs(l.data.scaleX)*_.signum(u),g=Math.abs(l.data.scaleY)*_.signum(c),l.scaleX=m+(u-m)*r,l.scaleY=g+(c-g)*r;break;case at.first:case at.replace:m=Math.abs(l.scaleX)*_.signum(u),g=Math.abs(l.scaleY)*_.signum(c),l.scaleX=m+(u-m)*r,l.scaleY=g+(c-g)*r;break;case at.add:m=_.signum(u),g=_.signum(c),l.scaleX=Math.abs(l.scaleX)*m+(u-Math.abs(l.data.scaleX)*m)*r,l.scaleY=Math.abs(l.scaleY)*g+(c-Math.abs(l.data.scaleY)*g)*r}}}}}]),a}(),yt=function(t){x(a,gt);var e=T(a);function a(t){return k(this,a),e.call(this,t)}return E(a,[{key:"getPropertyId",value:function(){return(it.shear<<24)+this.boneIndex}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case at.first:l.shearX+=(l.data.shearX-l.shearX)*r,l.shearY+=(l.data.shearY-l.shearY)*r}else{var u=0,c=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_X],c=h[h.length+a.PREV_Y];else{var d=ft.binarySearch(h,n,a.ENTRIES);u=h[d+a.PREV_X],c=h[d+a.PREV_Y];var f=h[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(h[d+a.PREV_TIME]-f));u+=(h[d+a.X]-u)*v,c+=(h[d+a.Y]-c)*v}switch(s){case at.setup:l.shearX=l.data.shearX+u*r,l.shearY=l.data.shearY+c*r;break;case at.first:case at.replace:l.shearX+=(l.data.shearX+u-l.shearX)*r,l.shearY+=(l.data.shearY+c-l.shearY)*r;break;case at.add:l.shearX+=u*r,l.shearY+=c*r}}}}]),a}(),kt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.color<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,n,i,r,s){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=s}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=t.slots[this.slotIndex];if(h.bone.active){var l=this.frames;if(n<l[0])switch(s){case at.setup:return void h.color.setFromColor(h.data.color);case at.first:var u=h.color,c=h.data.color;u.add((c.r-u.r)*r,(c.g-u.g)*r,(c.b-u.b)*r,(c.a-u.a)*r)}else{var d=0,f=0,v=0,m=0;if(n>=l[l.length-a.ENTRIES]){var g=l.length;d=l[g+a.PREV_R],f=l[g+a.PREV_G],v=l[g+a.PREV_B],m=l[g+a.PREV_A]}else{var p=ft.binarySearch(l,n,a.ENTRIES);d=l[p+a.PREV_R],f=l[p+a.PREV_G],v=l[p+a.PREV_B],m=l[p+a.PREV_A];var y=l[p],k=this.getCurvePercent(p/a.ENTRIES-1,1-(n-y)/(l[p+a.PREV_TIME]-y));d+=(l[p+a.R]-d)*k,f+=(l[p+a.G]-f)*k,v+=(l[p+a.B]-v)*k,m+=(l[p+a.A]-m)*k}if(1==r)h.color.set(d,f,v,m);else{var w=h.color;s==at.setup&&w.setFromColor(h.data.color),w.add((d-w.r)*r,(f-w.g)*r,(v-w.b)*r,(m-w.a)*r)}}}}}]),a}();kt.ENTRIES=5,kt.PREV_TIME=-5,kt.PREV_R=-4,kt.PREV_G=-3,kt.PREV_B=-2,kt.PREV_A=-1,kt.R=1,kt.G=2,kt.B=3,kt.A=4;var wt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.twoColor<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,n,i,r,s,o,h,l){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=s,this.frames[t+a.R2]=o,this.frames[t+a.G2]=h,this.frames[t+a.B2]=l}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=t.slots[this.slotIndex];if(h.bone.active){var l=this.frames;if(n<l[0])switch(s){case at.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case at.first:var u=h.color,c=h.darkColor,d=h.data.color,f=h.data.darkColor;u.add((d.r-u.r)*r,(d.g-u.g)*r,(d.b-u.b)*r,(d.a-u.a)*r),c.add((f.r-c.r)*r,(f.g-c.g)*r,(f.b-c.b)*r,0)}else{var v=0,m=0,g=0,p=0,y=0,k=0,w=0;if(n>=l[l.length-a.ENTRIES]){var E=l.length;v=l[E+a.PREV_R],m=l[E+a.PREV_G],g=l[E+a.PREV_B],p=l[E+a.PREV_A],y=l[E+a.PREV_R2],k=l[E+a.PREV_G2],w=l[E+a.PREV_B2]}else{var x=ft.binarySearch(l,n,a.ENTRIES);v=l[x+a.PREV_R],m=l[x+a.PREV_G],g=l[x+a.PREV_B],p=l[x+a.PREV_A],y=l[x+a.PREV_R2],k=l[x+a.PREV_G2],w=l[x+a.PREV_B2];var b=l[x],M=this.getCurvePercent(x/a.ENTRIES-1,1-(n-b)/(l[x+a.PREV_TIME]-b));v+=(l[x+a.R]-v)*M,m+=(l[x+a.G]-m)*M,g+=(l[x+a.B]-g)*M,p+=(l[x+a.A]-p)*M,y+=(l[x+a.R2]-y)*M,k+=(l[x+a.G2]-k)*M,w+=(l[x+a.B2]-w)*M}if(1==r)h.color.set(v,m,g,p),h.darkColor.set(y,k,w,1);else{var S=h.color,R=h.darkColor;s==at.setup&&(S.setFromColor(h.data.color),R.setFromColor(h.data.darkColor)),S.add((v-S.r)*r,(m-S.g)*r,(g-S.b)*r,(p-S.a)*r),R.add((y-R.r)*r,(k-R.g)*r,(w-R.b)*r,0)}}}}}]),a}();wt.ENTRIES=8,wt.PREV_TIME=-8,wt.PREV_R=-7,wt.PREV_G=-6,wt.PREV_B=-5,wt.PREV_A=-4,wt.PREV_R2=-3,wt.PREV_G2=-2,wt.PREV_B2=-1,wt.R=1,wt.G=2,wt.B=3,wt.A=4,wt.R2=5,wt.G2=6,wt.B2=7;var Et=function(){function t(e){k(this,t),this.slotIndex=void 0,this.frames=void 0,this.attachmentNames=void 0,this.frames=N.newFloatArray(e),this.attachmentNames=new Array(e)}return E(t,[{key:"getPropertyId",value:function(){return(it.attachment<<24)+this.slotIndex}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.attachmentNames[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.slots[this.slotIndex];if(o.bone.active)if(s!=nt.mixOut){var h=this.frames;if(a<h[0])r!=at.setup&&r!=at.first||this.setAttachment(t,o,o.data.attachmentName);else{var l=0;l=a>=h[h.length-1]?h.length-1:ft.binarySearch(h,a,1)-1;var u=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}}else r==at.setup&&this.setAttachment(t,o,o.data.attachmentName)}},{key:"setAttachment",value:function(t,e,a){e.attachment=null==a?null:t.getAttachment(this.slotIndex,a)}}]),t}(),xt=null,bt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).slotIndex=void 0,n.attachment=void 0,n.frames=void 0,n.frameVertices=void 0,n.frames=N.newFloatArray(t),n.frameVertices=new Array(t),null==xt&&(xt=N.newFloatArray(64)),n}return E(a,[{key:"getPropertyId",value:function(){return(it.deform<<27)+ +this.attachment.id+this.slotIndex}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.frameVertices[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.slots[this.slotIndex];if(o.bone.active){var h=o.getAttachment();if(h instanceof z&&h.deformAttachment==this.attachment){var l=o.deform;0==l.length&&(r=at.setup);var u=this.frameVertices,c=u[0].length,d=this.frames;if(a<d[0]){var f=h;switch(r){case at.setup:return void(l.length=0);case at.first:if(1==i){l.length=0;break}var v=N.setArraySize(l,c);if(null==f.bones)for(var m=f.vertices,g=0;g<c;g++)v[g]+=(m[g]-v[g])*i;else{i=1-i;for(g=0;g<c;g++)v[g]*=i}}}else{var p=N.setArraySize(l,c);if(a>=d[d.length-1]){var y=u[d.length-1];if(1==i)if(r==at.add){var k=h;if(null==k.bones)for(var w=k.vertices,E=0;E<c;E++)p[E]+=y[E]-w[E];else for(var x=0;x<c;x++)p[x]+=y[x]}else N.arrayCopy(y,0,p,0,c);else switch(r){case at.setup:var b=h;if(null==b.bones)for(var M=b.vertices,S=0;S<c;S++){var R=M[S];p[S]=R+(y[S]-R)*i}else for(var T=0;T<c;T++)p[T]=y[T]*i;break;case at.first:case at.replace:for(var A=0;A<c;A++)p[A]+=(y[A]-p[A])*i;break;case at.add:var I=h;if(null==I.bones)for(var C=I.vertices,V=0;V<c;V++)p[V]+=(y[V]-C[V])*i;else for(var P=0;P<c;P++)p[P]+=y[P]*i}}else{var _=ft.binarySearch(d,a),L=u[_-1],O=u[_],F=d[_],X=this.getCurvePercent(_-1,1-(a-F)/(d[_-1]-F));if(1==i)if(r==at.add){var Y=h;if(null==Y.bones)for(var D=Y.vertices,B=0;B<c;B++){var U=L[B];p[B]+=U+(O[B]-U)*X-D[B]}else for(var W=0;W<c;W++){var q=L[W];p[W]+=q+(O[W]-q)*X}}else for(var H=0;H<c;H++){var j=L[H];p[H]=j+(O[H]-j)*X}else switch(r){case at.setup:var G=h;if(null==G.bones)for(var Z=G.vertices,Q=0;Q<c;Q++){var K=L[Q],J=Z[Q];p[Q]=J+(K+(O[Q]-K)*X-J)*i}else for(var $=0;$<c;$++){var tt=L[$];p[$]=(tt+(O[$]-tt)*X)*i}break;case at.first:case at.replace:for(var et=0;et<c;et++){var nt=L[et];p[et]+=(nt+(O[et]-nt)*X-p[et])*i}break;case at.add:var it=h;if(null==it.bones)for(var rt=it.vertices,st=0;st<c;st++){var ot=L[st];p[st]+=(ot+(O[st]-ot)*X-rt[st])*i}else for(var ht=0;ht<c;ht++){var lt=L[ht];p[ht]+=(lt+(O[ht]-lt)*X)*i}}}}}}}}]),a}(),Mt=function(){function t(e){k(this,t),this.frames=void 0,this.events=void 0,this.frames=N.newFloatArray(e),this.events=new Array(e)}return E(t,[{key:"getPropertyId",value:function(){return it.event<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e){this.frames[t]=e.time,this.events[t]=e}},{key:"apply",value:function(t,e,a,n,i,r,s){if(null!=n){var o=this.frames,h=this.frames.length;if(e>a)this.apply(t,e,Number.MAX_VALUE,n,i,r,s),e=-1;else if(e>=o[h-1])return;if(!(a<o[0])){var l=0;if(e<o[0])l=0;else for(var u=o[l=ft.binarySearch(o,e)];l>0&&o[l-1]==u;)l--;for(;l<h&&a>=o[l];l++)n.push(this.events[l])}}}}]),t}(),St=function(){function t(e){k(this,t),this.frames=void 0,this.drawOrders=void 0,this.frames=N.newFloatArray(e),this.drawOrders=new Array(e)}return E(t,[{key:"getPropertyId",value:function(){return it.drawOrder<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.drawOrders[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.drawOrder,h=t.slots;if(s!=nt.mixOut){var l=this.frames;if(a<l[0])r!=at.setup&&r!=at.first||N.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=a>=l[l.length-1]?l.length-1:ft.binarySearch(l,a)-1;var c=this.drawOrders[u];if(null==c)N.arrayCopy(h,0,o,0,h.length);else for(var d=0,f=c.length;d<f;d++)o[d]=h[c[d]]}}else r==at.setup&&N.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}]),t}(),Rt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).ikConstraintIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.ikConstraint<<24)+this.ikConstraintIndex}},{key:"setFrame",value:function(t,e,n,i,r,s,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.MIX]=n,this.frames[t+a.SOFTNESS]=i,this.frames[t+a.BEND_DIRECTION]=r,this.frames[t+a.COMPRESS]=s?1:0,this.frames[t+a.STRETCH]=o?1:0}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case at.first:l.mix+=(l.data.mix-l.mix)*r,l.softness+=(l.data.softness-l.softness)*r,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}else if(n>=h[h.length-a.ENTRIES])s==at.setup?(l.mix=l.data.mix+(h[h.length+a.PREV_MIX]-l.data.mix)*r,l.softness=l.data.softness+(h[h.length+a.PREV_SOFTNESS]-l.data.softness)*r,o==nt.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=h[h.length+a.PREV_BEND_DIRECTION],l.compress=0!=h[h.length+a.PREV_COMPRESS],l.stretch=0!=h[h.length+a.PREV_STRETCH])):(l.mix+=(h[h.length+a.PREV_MIX]-l.mix)*r,l.softness+=(h[h.length+a.PREV_SOFTNESS]-l.softness)*r,o==nt.mixIn&&(l.bendDirection=h[h.length+a.PREV_BEND_DIRECTION],l.compress=0!=h[h.length+a.PREV_COMPRESS],l.stretch=0!=h[h.length+a.PREV_STRETCH]));else{var u=ft.binarySearch(h,n,a.ENTRIES),c=h[u+a.PREV_MIX],d=h[u+a.PREV_SOFTNESS],f=h[u],v=this.getCurvePercent(u/a.ENTRIES-1,1-(n-f)/(h[u+a.PREV_TIME]-f));s==at.setup?(l.mix=l.data.mix+(c+(h[u+a.MIX]-c)*v-l.data.mix)*r,l.softness=l.data.softness+(d+(h[u+a.SOFTNESS]-d)*v-l.data.softness)*r,o==nt.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=h[u+a.PREV_BEND_DIRECTION],l.compress=0!=h[u+a.PREV_COMPRESS],l.stretch=0!=h[u+a.PREV_STRETCH])):(l.mix+=(c+(h[u+a.MIX]-c)*v-l.mix)*r,l.softness+=(d+(h[u+a.SOFTNESS]-d)*v-l.softness)*r,o==nt.mixIn&&(l.bendDirection=h[u+a.PREV_BEND_DIRECTION],l.compress=0!=h[u+a.PREV_COMPRESS],l.stretch=0!=h[u+a.PREV_STRETCH]))}}}]),a}();Rt.ENTRIES=6,Rt.PREV_TIME=-6,Rt.PREV_MIX=-5,Rt.PREV_SOFTNESS=-4,Rt.PREV_BEND_DIRECTION=-3,Rt.PREV_COMPRESS=-2,Rt.PREV_STRETCH=-1,Rt.MIX=1,Rt.SOFTNESS=2,Rt.BEND_DIRECTION=3,Rt.COMPRESS=4,Rt.STRETCH=5;var Tt=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).transformConstraintIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.transformConstraint<<24)+this.transformConstraintIndex}},{key:"setFrame",value:function(t,e,n,i,r,s){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i,this.frames[t+a.SCALE]=r,this.frames[t+a.SHEAR]=s}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(l.active)if(n<h[0]){var u=l.data;switch(s){case at.setup:return l.rotateMix=u.rotateMix,l.translateMix=u.translateMix,l.scaleMix=u.scaleMix,void(l.shearMix=u.shearMix);case at.first:l.rotateMix+=(u.rotateMix-l.rotateMix)*r,l.translateMix+=(u.translateMix-l.translateMix)*r,l.scaleMix+=(u.scaleMix-l.scaleMix)*r,l.shearMix+=(u.shearMix-l.shearMix)*r}}else{var c=0,d=0,f=0,v=0;if(n>=h[h.length-a.ENTRIES]){var m=h.length;c=h[m+a.PREV_ROTATE],d=h[m+a.PREV_TRANSLATE],f=h[m+a.PREV_SCALE],v=h[m+a.PREV_SHEAR]}else{var g=ft.binarySearch(h,n,a.ENTRIES);c=h[g+a.PREV_ROTATE],d=h[g+a.PREV_TRANSLATE],f=h[g+a.PREV_SCALE],v=h[g+a.PREV_SHEAR];var p=h[g],y=this.getCurvePercent(g/a.ENTRIES-1,1-(n-p)/(h[g+a.PREV_TIME]-p));c+=(h[g+a.ROTATE]-c)*y,d+=(h[g+a.TRANSLATE]-d)*y,f+=(h[g+a.SCALE]-f)*y,v+=(h[g+a.SHEAR]-v)*y}if(s==at.setup){var k=l.data;l.rotateMix=k.rotateMix+(c-k.rotateMix)*r,l.translateMix=k.translateMix+(d-k.translateMix)*r,l.scaleMix=k.scaleMix+(f-k.scaleMix)*r,l.shearMix=k.shearMix+(v-k.shearMix)*r}else l.rotateMix+=(c-l.rotateMix)*r,l.translateMix+=(d-l.translateMix)*r,l.scaleMix+=(f-l.scaleMix)*r,l.shearMix+=(v-l.shearMix)*r}}}]),a}();Tt.ENTRIES=5,Tt.PREV_TIME=-5,Tt.PREV_ROTATE=-4,Tt.PREV_TRANSLATE=-3,Tt.PREV_SCALE=-2,Tt.PREV_SHEAR=-1,Tt.ROTATE=1,Tt.TRANSLATE=2,Tt.SCALE=3,Tt.SHEAR=4;var At=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.pathConstraintPosition<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=n}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return void(l.position=l.data.position);case at.first:l.position+=(l.data.position-l.position)*r}else{var u=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_VALUE];else{var c=ft.binarySearch(h,n,a.ENTRIES);u=h[c+a.PREV_VALUE];var d=h[c],f=this.getCurvePercent(c/a.ENTRIES-1,1-(n-d)/(h[c+a.PREV_TIME]-d));u+=(h[c+a.VALUE]-u)*f}s==at.setup?l.position=l.data.position+(u-l.data.position)*r:l.position+=(u-l.position)*r}}}]),a}();At.ENTRIES=2,At.PREV_TIME=-2,At.PREV_VALUE=-1,At.VALUE=1;var It=function(t){x(a,At);var e=T(a);function a(t){return k(this,a),e.call(this,t)}return E(a,[{key:"getPropertyId",value:function(){return(it.pathConstraintSpacing<<24)+this.pathConstraintIndex}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return void(l.spacing=l.data.spacing);case at.first:l.spacing+=(l.data.spacing-l.spacing)*r}else{var u=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_VALUE];else{var c=ft.binarySearch(h,n,a.ENTRIES);u=h[c+a.PREV_VALUE];var d=h[c],f=this.getCurvePercent(c/a.ENTRIES-1,1-(n-d)/(h[c+a.PREV_TIME]-d));u+=(h[c+a.VALUE]-u)*f}s==at.setup?l.spacing=l.data.spacing+(u-l.data.spacing)*r:l.spacing+=(u-l.spacing)*r}}}]),a}(),Ct=function(t){x(a,vt);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=N.newFloatArray(t*a.ENTRIES),n}return E(a,[{key:"getPropertyId",value:function(){return(it.pathConstraintMix<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i}},{key:"apply",value:function(t,e,n,i,r,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(n<h[0])switch(s){case at.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case at.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*r,l.translateMix+=(l.data.translateMix-l.translateMix)*r}else{var u=0,c=0;if(n>=h[h.length-a.ENTRIES])u=h[h.length+a.PREV_ROTATE],c=h[h.length+a.PREV_TRANSLATE];else{var d=ft.binarySearch(h,n,a.ENTRIES);u=h[d+a.PREV_ROTATE],c=h[d+a.PREV_TRANSLATE];var f=h[d],v=this.getCurvePercent(d/a.ENTRIES-1,1-(n-f)/(h[d+a.PREV_TIME]-f));u+=(h[d+a.ROTATE]-u)*v,c+=(h[d+a.TRANSLATE]-c)*v}s==at.setup?(l.rotateMix=l.data.rotateMix+(u-l.data.rotateMix)*r,l.translateMix=l.data.translateMix+(c-l.data.translateMix)*r):(l.rotateMix+=(u-l.rotateMix)*r,l.translateMix+=(c-l.translateMix)*r)}}}]),a}();Ct.ENTRIES=3,Ct.PREV_TIME=-3,Ct.PREV_ROTATE=-2,Ct.PREV_TRANSLATE=-1,Ct.ROTATE=1,Ct.TRANSLATE=2;var Vt=function(){function t(e){k(this,t),this.data=void 0,this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new Nt(this),this.propertyIDs=new V,this.animationsChanged=!1,this.trackEntryPool=new O((function(){return new _t})),this.data=e}return E(t,[{key:"update",value:function(t){t*=this.timeScale;for(var e=this.tracks,a=0,n=e.length;a<n;a++){var i=e[a];if(null!=i){i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;var r=t*i.timeScale;if(i.delay>0){if(i.delay-=r,i.delay>0)continue;r=-i.delay,i.delay=0}var s=i.next;if(null!=s){var o=i.trackLast-s.delay;if(o>=0){for(s.delay=0,s.trackTime+=0==i.timeScale?0:(o/i.timeScale+t)*s.timeScale,i.trackTime+=r,this.setCurrent(a,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[a]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){var h=i.mixingFrom;for(i.mixingFrom=null,null!=h&&(h.mixingTo=null);null!=h;)this.queue.end(h),h=h.mixingFrom}i.trackTime+=r}}this.queue.drain()}},{key:"updateMixingFrom",value:function(t,e){var a=t.mixingFrom;if(null==a)return!0;var n=this.updateMixingFrom(a,e);return a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=a.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=a.mixingFrom,null!=a.mixingFrom&&(a.mixingFrom.mixingTo=t),t.interruptAlpha=a.interruptAlpha,this.queue.end(a)),n):(a.trackTime+=e*a.timeScale,t.mixTime+=e,!1)}},{key:"apply",value:function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var a=this.events,n=this.tracks,i=!1,r=0,s=n.length;r<s;r++){var o=n[r];if(!(null==o||o.delay>0)){i=!0;var h=0==r?at.first:o.mixBlend,l=o.alpha;null!=o.mixingFrom?l*=this.applyMixingFrom(o,e,h):o.trackTime>=o.trackEnd&&null==o.next&&(l=0);var u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,f=o.animation.timelines;if(0==r&&1==l||h==at.add)for(var v=0;v<d;v++){N.webkit602BugfixHelper(l,h);var m=f[v];m instanceof Et?this.applyAttachmentTimeline(m,e,c,h,!0):m.apply(e,u,c,a,l,h,nt.mixIn)}else{var g=o.timelineMode,p=0==o.timelinesRotation.length;p&&N.setArraySize(o.timelinesRotation,d<<1,null);for(var y=o.timelinesRotation,k=0;k<d;k++){var w=f[k],E=g[k]==t.SUBSEQUENT?h:at.setup;w instanceof mt?this.applyRotateTimeline(w,e,c,l,E,y,k<<1,p):w instanceof Et?this.applyAttachmentTimeline(w,e,c,h,!0):(N.webkit602BugfixHelper(l,h),w.apply(e,u,c,a,l,E,nt.mixIn))}}this.queueEvents(o,c),a.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}for(var x=this.unkeyedState+t.SETUP,b=e.slots,M=0,S=e.slots.length;M<S;M++){var R=b[M];if(R.attachmentState==x){var T=R.data.attachmentName;R.attachment=null==T?null:e.getAttachment(R.data.index,T)}}return this.unkeyedState+=2,this.queue.drain(),i}},{key:"applyMixingFrom",value:function(e,a,n){var i=e.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,a,n);var r=0;0==e.mixDuration?(r=1,n==at.first&&(n=at.setup)):((r=e.mixTime/e.mixDuration)>1&&(r=1),n!=at.first&&(n=i.mixBlend));var s=r<i.eventThreshold?this.events:null,o=r<i.attachmentThreshold,h=r<i.drawOrderThreshold,l=i.animationLast,u=i.getAnimationTime(),c=i.animation.timelines.length,d=i.animation.timelines,f=i.alpha*e.interruptAlpha,v=f*(1-r);if(n==at.add)for(var m=0;m<c;m++)d[m].apply(a,l,u,s,v,n,nt.mixOut);else{var g=i.timelineMode,p=i.timelineHoldMix,y=0==i.timelinesRotation.length;y&&N.setArraySize(i.timelinesRotation,c<<1,null);var k=i.timelinesRotation;i.totalAlpha=0;for(var w=0;w<c;w++){var E=d[w],x=nt.mixOut,b=void 0,M=0;switch(g[w]){case t.SUBSEQUENT:if(!h&&E instanceof St)continue;b=n,M=v;break;case t.FIRST:b=at.setup,M=v;break;case t.HOLD_SUBSEQUENT:b=n,M=f;break;case t.HOLD_FIRST:b=at.setup,M=f;break;default:b=at.setup;var S=p[w];M=f*Math.max(0,1-S.mixTime/S.mixDuration)}i.totalAlpha+=M,E instanceof mt?this.applyRotateTimeline(E,a,u,M,b,k,w<<1,y):E instanceof Et?this.applyAttachmentTimeline(E,a,u,b,o):(N.webkit602BugfixHelper(M,n),h&&E instanceof St&&b==at.setup&&(x=nt.mixIn),E.apply(a,l,u,s,M,b,x))}}return e.mixDuration>0&&this.queueEvents(i,u),this.events.length=0,i.nextAnimationLast=u,i.nextTrackLast=i.trackTime,r}},{key:"applyAttachmentTimeline",value:function(e,a,n,i,r){var s=a.slots[e.slotIndex];if(s.bone.active){var o,h=e.frames;if(n<h[0])i!=at.setup&&i!=at.first||this.setAttachment(a,s,s.data.attachmentName,r);else o=n>=h[h.length-1]?h.length-1:ft.binarySearch(h,n)-1,this.setAttachment(a,s,e.attachmentNames[o],r);s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+t.SETUP)}}},{key:"setAttachment",value:function(e,a,n,i){a.attachment=null==n?null:e.getAttachment(a.data.index,n),i&&(a.attachmentState=this.unkeyedState+t.CURRENT)}},{key:"applyRotateTimeline",value:function(t,e,a,n,i,r,s,o){if(o&&(r[s]=0),1!=n){var h=t,l=h.frames,u=e.bones[h.boneIndex];if(u.active){var c=0,d=0;if(a<l[0])switch(i){case at.setup:u.rotation=u.data.rotation;default:return;case at.first:c=u.rotation,d=u.data.rotation}else if(c=i==at.setup?u.data.rotation:u.rotation,a>=l[l.length-mt.ENTRIES])d=u.data.rotation+l[l.length+mt.PREV_ROTATION];else{var f=ft.binarySearch(l,a,mt.ENTRIES),v=l[f+mt.PREV_ROTATION],m=l[f],g=h.getCurvePercent((f>>1)-1,1-(a-m)/(l[f+mt.PREV_TIME]-m));d=l[f+mt.ROTATION]-v,d=v+(d-=360*(16384-(16384.499999999996-d/360|0)))*g+u.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var p=0,y=d-c;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))p=r[s];else{var k=0,w=0;o?(k=0,w=y):(k=r[s],w=r[s+1]);var E=y>0,x=k>=0;_.signum(w)!=_.signum(y)&&Math.abs(w)<=90&&(Math.abs(k)>180&&(k+=360*_.signum(k)),x=E),p=y+k-k%360,x!=E&&(p+=360*_.signum(k)),r[s]=p}r[s+1]=y,c+=p*n,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}}else t.apply(e,0,a,null,1,i,nt.mixIn)}},{key:"queueEvents",value:function(t,e){for(var a=t.animationStart,n=t.animationEnd,i=n-a,r=t.trackLast%i,s=this.events,o=0,h=s.length;o<h;o++){var l=s[o];if(l.time<r)break;l.time>n||this.queue.event(t,l)}for((t.loop?0==i||r>t.trackTime%i:e>=n&&t.animationLast<n)&&this.queue.complete(t);o<h;o++){s[o].time<a||this.queue.event(t,s[o])}}},{key:"clearTracks",value:function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,a=this.tracks.length;e<a;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}},{key:"clearTrack",value:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var a=e;;){var n=a.mixingFrom;if(null==n)break;this.queue.end(n),a.mixingFrom=null,a.mixingTo=null,a=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}}},{key:"setCurrent",value:function(t,e,a){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(a&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}},{key:"setAnimation",value:function(t,e,a){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,a)}},{key:"setAnimationWith",value:function(t,e,a){if(null==e)throw new Error("animation cannot be null.");var n=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,n=!1):this.disposeNext(i));var r=this.trackEntry(t,e,a,i);return this.setCurrent(t,r,n),this.queue.drain(),r}},{key:"addAnimation",value:function(t,e,a,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,a,n)}},{key:"addAnimationWith",value:function(t,e,a,n){if(null==e)throw new Error("animation cannot be null.");var i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;var r=this.trackEntry(t,e,a,i);if(null==i)this.setCurrent(t,r,!0),this.queue.drain();else if(i.next=r,n<=0){var s=i.animationEnd-i.animationStart;0!=s?(i.loop?n+=s*(1+(i.trackTime/s|0)):n+=Math.max(s,i.trackTime),n-=this.data.getMix(i.animation,e)):n=i.trackTime}return r.delay=n,r}},{key:"setEmptyAnimation",value:function(e,a){var n=this.setAnimationWith(e,t.emptyAnimation,!1);return n.mixDuration=a,n.trackEnd=a,n}},{key:"addEmptyAnimation",value:function(e,a,n){n<=0&&(n-=a);var i=this.addAnimationWith(e,t.emptyAnimation,!1,n);return i.mixDuration=a,i.trackEnd=a,i}},{key:"setEmptyAnimations",value:function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var a=0,n=this.tracks.length;a<n;a++){var i=this.tracks[a];null!=i&&this.setEmptyAnimation(i.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}},{key:"expandToIndex",value:function(t){return t<this.tracks.length?this.tracks[t]:(N.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}},{key:"trackEntry",value:function(t,e,a,n){var i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=a,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==n?0:this.data.getMix(n.animation,e),i.mixBlend=at.replace,i}},{key:"disposeNext",value:function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}},{key:"_animationsChanged",value:function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var a=this.tracks[t];if(null!=a){for(;null!=a.mixingFrom;)a=a.mixingFrom;do{null!=a.mixingFrom&&a.mixBlend==at.add||this.computeHold(a),a=a.mixingTo}while(null!=a)}}}},{key:"computeHold",value:function(e){var a=e.mixingTo,n=e.animation.timelines,i=e.animation.timelines.length,r=N.setArraySize(e.timelineMode,i);e.timelineHoldMix.length=0;var s=N.setArraySize(e.timelineHoldMix,i),o=this.propertyIDs;if(null!=a&&a.holdPrevious)for(var h=0;h<i;h++)r[h]=o.add(n[h].getPropertyId())?t.HOLD_FIRST:t.HOLD_SUBSEQUENT;else t:for(var l=0;l<i;l++){var u=n[l],c=u.getPropertyId();if(o.add(c))if(null==a||u instanceof Et||u instanceof St||u instanceof Mt||!a.animation.hasTimeline(c))r[l]=t.FIRST;else{for(var d=a.mixingTo;null!=d;d=d.mixingTo)if(!d.animation.hasTimeline(c)){if(e.mixDuration>0){r[l]=t.HOLD_MIX,s[l]=d;continue t}break}r[l]=t.HOLD_FIRST}else r[l]=t.SUBSEQUENT}}},{key:"getCurrent",value:function(t){return t>=this.tracks.length?null:this.tracks[t]}},{key:"addListener",value:function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"clearListeners",value:function(){this.listeners.length=0}},{key:"clearListenerNotifications",value:function(){this.queue.clear()}}]),t}();Vt.emptyAnimation=new ft("<empty>",[],0),Vt.SUBSEQUENT=0,Vt.FIRST=1,Vt.HOLD_SUBSEQUENT=2,Vt.HOLD_FIRST=3,Vt.HOLD_MIX=4,Vt.SETUP=1,Vt.CURRENT=2;var Pt,_t=function(){function t(){k(this,t),this.animation=void 0,this.next=void 0,this.mixingFrom=void 0,this.mixingTo=void 0,this.listener=void 0,this.trackIndex=void 0,this.loop=void 0,this.holdPrevious=void 0,this.eventThreshold=void 0,this.attachmentThreshold=void 0,this.drawOrderThreshold=void 0,this.animationStart=void 0,this.animationEnd=void 0,this.animationLast=void 0,this.nextAnimationLast=void 0,this.delay=void 0,this.trackTime=void 0,this.trackLast=void 0,this.nextTrackLast=void 0,this.trackEnd=void 0,this.timeScale=void 0,this.alpha=void 0,this.mixTime=void 0,this.mixDuration=void 0,this.interruptAlpha=void 0,this.totalAlpha=void 0,this.mixBlend=at.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return E(t,[{key:"reset",value:function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}},{key:"getAnimationTime",value:function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}},{key:"setAnimationLast",value:function(t){this.animationLast=t,this.nextAnimationLast=t}},{key:"isComplete",value:function(){return this.trackTime>=this.animationEnd-this.animationStart}},{key:"resetRotationDirections",value:function(){this.timelinesRotation.length=0}}]),t}(),Nt=function(){function t(e){k(this,t),this.objects=[],this.drainDisabled=!1,this.animState=void 0,this.animState=e}return E(t,[{key:"start",value:function(t){this.objects.push(Pt.start),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"interrupt",value:function(t){this.objects.push(Pt.interrupt),this.objects.push(t)}},{key:"end",value:function(t){this.objects.push(Pt.end),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"dispose",value:function(t){this.objects.push(Pt.dispose),this.objects.push(t)}},{key:"complete",value:function(t){this.objects.push(Pt.complete),this.objects.push(t)}},{key:"event",value:function(t){function e(e,a){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){this.objects.push(Pt.event),this.objects.push(t),this.objects.push(e)}))},{key:"drain",value:function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,a=0;a<t.length;a+=2){var n=t[a],i=t[a+1];switch(n){case Pt.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(var r=0;r<e.length;r++)e[r].start&&e[r].start(i);break;case Pt.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(var s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(i);break;case Pt.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(var o=0;o<e.length;o++)e[o].end&&e[o].end(i);case Pt.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(var h=0;h<e.length;h++)e[h].dispose&&e[h].dispose(i);this.animState.trackEntryPool.free(i);break;case Pt.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(var l=0;l<e.length;l++)e[l].complete&&e[l].complete(i);break;case Pt.event:var u=t[2+a++];null!=i.listener&&i.listener.event&&i.listener.event(i,u);for(var c=0;c<e.length;c++)e[c].event&&e[c].event(i,u)}}this.clear(),this.drainDisabled=!1}}},{key:"clear",value:function(){this.objects.length=0}}]),t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(Pt||(Pt={}));var Lt=function(){function t(e){if(k(this,t),this.skeletonData=void 0,this.animationToMixTime={},this.defaultMix=0,null==e)throw new Error("skeletonData cannot be null.");this.skeletonData=e}return E(t,[{key:"setMix",value:function(t,e,a){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var i=this.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);this.setMixWith(n,i,a)}},{key:"setMixWith",value:function(t,e,a){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=a}},{key:"getMix",value:function(t,e){var a=t.name+"."+e.name,n=this.animationToMixTime[a];return void 0===n?this.defaultMix:n}}]),t}(),Ot=function(t){x(a,v);var e=T(a);function a(){var t;k(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).vertices=new Float32Array(1024),t.tempColor=[0,0,0,0],t._skeleton=void 0,t._asset=void 0,t._state=void 0,t._batches=new Array,t._nextBatchIndex=0,t._vertexCount=0,t._stencilStates=void 0,t._blendStates=void 0,t._depthMask=void 0,t._priority=0,t.zOffset=.01,t.autoUpdate=!0,t}return E(a,[{key:"asset",get:function(){return this._asset}},{key:"state",get:function(){return this._state}},{key:"skeleton",get:function(){return this._skeleton}},{key:"batches",get:function(){return this._batches}},{key:"setSkeletonData",value:function(t){this._asset=t,this._skeleton=new dt(t);var e=new Lt(t);this._state=new Vt(e),this.getVertexCount()}},{key:"setCustomStencil",value:function(t){this._stencilStates=t}},{key:"setCustomBlend",value:function(t){this._blendStates=t}},{key:"setDepthMask",value:function(t){this._depthMask=t}},{key:"setInitialRenderPriority",value:function(t){this._priority=t}},{key:"disposeCurrentSkeleton",value:function(){this._asset=null,this.clearBatches(),this._batches=[];for(var t=this.entity.children,e=0;e<t.length;e+=1)"batch"===t[e].name&&t[e].destroy()}},{key:"getVertexCount",value:function(){for(var t=this._skeleton.drawOrder,e=0,n=0,i=t.length;n<i;n++){var r=t[n];if(r.bone.active){var s=r.getAttachment();if(s)if(s instanceof J)e+=a.QUAD_TRIANGLES.length;else{if(!(s instanceof ct))continue;e+=s.triangles.length}}}this._vertexCount=e}},{key:"onUpdate",value:function(t){this._asset&&this.autoUpdate&&this.updateState(.001*t)}},{key:"updateState",value:function(t){var e=this._state,a=this._skeleton;e.update(t),e.apply(a),a.updateWorldTransform(),this.updateGeometry()}},{key:"clearBatches",value:function(){for(var t=0;t<this._batches.length;t++)this._batches[t].clear(),this._batches[t].enabled=!1;this._nextBatchIndex=0}},{key:"nextBatch",value:function(){if(this._batches.length==this._nextBatchIndex){var t=this.entity.createChild("batch").addComponent(C);t.renderPriority=this._priority,t.initGeometry(this._vertexCount),t.initMaterial({stencil:this._stencilStates,blend:this._blendStates,depthMask:this._depthMask}),this._batches.push(t)}var e=this._batches[this._nextBatchIndex++];return e.enabled=!0,e}},{key:"updateGeometry",value:function(){this.clearBatches();var t,e,n=this.vertices,i=this._skeleton.drawOrder,r=this.nextBatch();r.begin();for(var s=0,o=this.zOffset,h=a.VERTEX_SIZE,l=0,u=i.length;l<u;l++){var c=i[l];if(c.bone.active){var d=c.getAttachment(),f=null,v=null,m=0;if(d){if(d instanceof J){var g=d;f=g.color,n=this.vertices,m=4*h,g.computeWorldVertices(c.bone,n,0,h),t=a.QUAD_TRIANGLES,e=g.uvs,v=g.region.renderObject.texture}else{if(!(d instanceof ct))continue;var p=d;f=p.color,n=this.vertices,(m=(p.worldVerticesLength>>1)*h)>n.length&&(n=this.vertices=N.newFloatArray(m)),p.computeWorldVertices(c,0,p.worldVerticesLength,n,0,h),t=p.triangles,e=p.uvs,v=p.region.renderObject.texture}if(null!=v){var y=c.bone.skeleton.color,k=c.color,w=y.a*k.a*f.a,E=this.tempColor;E=[y.r*k.r*f.r,y.g*k.g*f.g,y.b*k.b*f.b,w];for(var x,b,M,S,R=n,T=2,A=0,I=m;T<I;T+=h,A+=2)R[T]=E[0],R[T+1]=E[1],R[T+2]=E[2],R[T+3]=E[3],R[T+4]=e[A],R[T+5]=e[A+1];if(x=n,b=m,M=t,S=t.length,0==b||0==S)continue;r.canBatch(b,S)||(r.end(),(r=this.nextBatch()).begin());var C=r.material;null==C.map&&(C.map=v.texture),C.map!=v.texture&&(r.end(),(r=this.nextBatch()).begin(),(C=r.material).map=v.texture),r.batch(x,b,M,S,s),s+=o}}}}r.end()}}]),a}();Ot.QUAD_TRIANGLES=[0,1,2,2,3,0],Ot.VERTEX_SIZE=8;var Ft,Xt=function(t){x(a,et);var e=T(a);function a(t,n,i,r){var s;return k(this,a),(s=e.call(this,n)).texture=void 0,n.constructor===ArrayBuffer?(s.texture=function(t,e,a,n){var i=y(t),r=i.width,s=i.height,o=i.mipmaps,h=i.engineFormat,l=o.length>1;void 0!==a&&void 0!==n&&(console.log("resize to atlas size: width: ".concat(a,", height: ").concat(n)),r=a,s=n);for(var u=new p(e,r,s,h,l),c=0;c<o.length;c++){var d=o[c],f=d.width,v=d.height,m=d.data;u.setPixelBuffer(m,c,0,0,f,v)}return u}(n,t,i,r),s._image=s.texture):(s.texture=function(t,e){var a=new p(e,t.width,t.height);return a.setImageSource(t),a}(n,t),s._image=s.texture),s}return E(a,[{key:"setFilters",value:function(t,e){t===m.NEAREST?this.texture.filterMode=g.Point:e===m.LINEAR_MIPMAP_LINEAR?this.texture.filterMode=g.Trilinear:this.texture.filterMode=g.Bilinear}},{key:"setWraps",value:function(t,e){this.texture.wrapModeU=t,this.texture.wrapModeV=e}},{key:"dispose",value:function(){}}]),a}(),Yt=function(t){x(a,t);var e=T(a);function a(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return k(this,a),(n=e.call(this,(function(e,a,n){return new Xt(t,e,a,n)}),i))._checkRaf=0,n}return E(a,[{key:"onLoad",value:function(){var t=this;return new Promise((function(e){t.checkLoaded(e)}))}},{key:"checkLoaded",value:function(t){0==this.toLoad?(cancelAnimationFrame(this._checkRaf),t(this)):this._checkRaf=requestAnimationFrame(this.checkLoaded.bind(this,t))}}]),a}(function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";k(this,t),this.pathPrefix=void 0,this.textureLoader=void 0,this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.rawDataUris={},this.textureLoader=e,this.pathPrefix=a}return E(t,[{key:"downloadText",value:function(t,e,a){var n=new XMLHttpRequest;n.overrideMimeType("text/html"),this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"downloadBinary",value:function(t,e,a){var n=new XMLHttpRequest;this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"setRawDataURI",value:function(t,e){this.rawDataUris[this.pathPrefix+t]=e}},{key:"loadBinary",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,i){e.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"loadText",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,i){e.errors[t]="Couldn't load text ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load text ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"loadTexture",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t=this.pathPrefix+t;this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(n){var s=e.textureLoader(r);e.assets[i]=s,e.toLoad--,e.loaded++,a&&a(t,r)},r.onerror=function(a){e.errors[t]="Couldn't load image ".concat(t),e.toLoad--,e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),r.src=t}},{key:"loadImage",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t=this.pathPrefix+t;this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(n){e.assets[i]=r,e.toLoad--,e.loaded++,a&&a(t,r)},r.onerror=function(a){e.errors[t]="Couldn't load image ".concat(t),e.toLoad--,e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),r.src=t}},{key:"loadCompressedTexture",value:function(t,e,a){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=t=this.pathPrefix+t;this.toLoad++,this.downloadBinary(t,(function(r){var o;o=void 0!==e&&void 0!==a?n.textureLoader(r.buffer,e,a):n.textureLoader(r.buffer),n.assets[s]=o,i&&i(t,r),n.toLoad--,n.loaded++}),(function(e,a){n.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(a),r&&r(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(a)),n.toLoad--,n.loaded++}))}},{key:"createCompressedTexture",value:function(t,e,a,n){var i=t=this.pathPrefix+t,r=this.textureLoader(e.buffer,a,n);this.assets[i]=r}},{key:"createTexture",value:function(t,e){var a=t=this.pathPrefix+t,n=this.textureLoader(e);this.assets[a]=n}},{key:"loadTextureAtlas",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.lastIndexOf("/")>=0?t.substring(0,t.lastIndexOf("/")):"";t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(r){var s={count:0},o=new Array;try{new ot(r,(function(t){o.push(""==i?t:i+"/"+t);var e=document.createElement("img");return e.width=16,e.height=16,new st(e)}))}catch(a){var h=a;return e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(h.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(h.message)),e.toLoad--,void e.loaded++}for(var l=function(){var h=c[u],l=!1;e.loadTexture(h,(function(h,u){if(s.count++,s.count==o.length)if(l)e.errors[t]="Couldn't load texture atlas page ".concat(h,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(h," of atlas ").concat(t)),e.toLoad--,e.loaded++;else try{var c=new ot(r,(function(t){return e.get(""==i?t:i+"/"+t)}));e.assets[t]=c,a&&a(t,c),e.toLoad--,e.loaded++}catch(a){var d=a;e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(d.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(d.message)),e.toLoad--,e.loaded++}}),(function(a,i){l=!0,s.count++,s.count==o.length&&(e.errors[t]="Couldn't load texture atlas page ".concat(a,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(a," of atlas ").concat(t)),e.toLoad--,e.loaded++)}))},u=0,c=o;u<c.length;u++)l()}),(function(a,i){e.errors[t]="Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"get",value:function(t){return t=this.pathPrefix+t,this.assets[t]}},{key:"remove",value:function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null}},{key:"removeAll",value:function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}},{key:"isLoadingComplete",value:function(){return 0==this.toLoad}},{key:"getToLoad",value:function(){return this.toLoad}},{key:"getLoaded",value:function(){return this.loaded}},{key:"dispose",value:function(){this.removeAll()}},{key:"hasErrors",value:function(){return Object.keys(this.errors).length>0}},{key:"getErrors",value:function(){return this.errors}}]),t}()),Dt=function(t){x(a,z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).color=new P(1,1,1,1),n}return E(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}]),a}(),Bt=function(t){x(a,z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).x=void 0,n.y=void 0,n.rotation=void 0,n.color=new P(.38,.94,0,1),n.name=t,n}return E(a,[{key:"computeWorldPosition",value:function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}},{key:"computeWorldRotation",value:function(t){var e=_.cosDeg(this.rotation),a=_.sinDeg(this.rotation),n=e*t.a+a*t.b,i=e*t.c+a*t.d;return Math.atan2(i,n)*_.radDeg}},{key:"copy",value:function(){var t=new a(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}]),a}(),Ut=function(t){x(a,z);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t)).endSlot=void 0,n.color=new P(.2275,.2275,.8078,1),n}return E(a,[{key:"copy",value:function(){var t=new a(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}]),a}(),Wt=function(){function t(e){k(this,t),this.atlas=void 0,this.atlas=e}return E(t,[{key:"newRegionAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (region attachment: "+e+")");n.renderObject=n;var i=new J(e);return i.setRegion(n),i}},{key:"newMeshAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (mesh attachment: "+e+")");n.renderObject=n;var i=new ct(e);return i.region=n,i}},{key:"newBoundingBoxAttachment",value:function(t,e){return new Dt(e)}},{key:"newPathAttachment",value:function(t,e){return new Q(e)}},{key:"newPointAttachment",value:function(t,e){return new Bt(e)}},{key:"newClippingAttachment",value:function(t,e){return new Ut(e)}}]),t}(),qt=function(){function t(){k(this,t),this.name=void 0,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=void 0,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.version=void 0,this.hash=void 0,this.fps=0,this.imagesPath=void 0,this.audioPath=void 0}return E(t,[{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSkin",value:function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findEvent",value:function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findAnimation",value:function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findPathConstraintIndex",value:function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}}]),t}(),Ht=function t(e,a,n){if(k(this,t),this.index=void 0,this.name=void 0,this.boneData=void 0,this.color=new P(1,1,1,1),this.darkColor=void 0,this.attachmentName=void 0,this.blendMode=void 0,e<0)throw new Error("index must be >= 0.");if(null==a)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=e,this.name=a,this.boneData=n},jt=function(t){x(a,j);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return a}(),Gt=function(t){x(a,j);var e=T(a);function a(t){var n;return k(this,a),(n=e.call(this,t,0,!1)).bones=new Array,n.target=void 0,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return a}(),Zt=function t(e,a,n){k(this,t),this.slotIndex=e,this.name=a,this.attachment=n},zt=function(){function t(e){if(k(this,t),this.name=void 0,this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==e)throw new Error("name cannot be null.");this.name=e}return E(t,[{key:"setAttachment",value:function(t,e,a){if(null==a)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=a}},{key:"addSkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==a){n=!0;break}n||this.bones.push(a)}for(var r=0;r<t.constraints.length;r++){for(var s=t.constraints[r],o=!1,h=0;h<this.constraints.length;h++)if(this.constraints[h]==s){o=!0;break}o||this.constraints.push(s)}for(var l=t.getAttachments(),u=0;u<l.length;u++){var c=l[u];this.setAttachment(c.slotIndex,c.name,c.attachment)}}},{key:"copySkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==a){n=!0;break}n||this.bones.push(a)}for(var r=0;r<t.constraints.length;r++){for(var s=t.constraints[r],o=!1,h=0;h<this.constraints.length;h++)if(this.constraints[h]==s){o=!0;break}o||this.constraints.push(s)}for(var l=t.getAttachments(),u=0;u<l.length;u++){var c=l[u];null!=c.attachment&&(c.attachment instanceof ct?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}}},{key:"getAttachment",value:function(t,e){var a=this.attachments[t];return a?a[e]:null}},{key:"removeAttachment",value:function(t,e){var a=this.attachments[t];a&&(a[e]=null)}},{key:"getAttachments",value:function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var a=this.attachments[e];if(a)for(var n in a){var i=a[n];i&&t.push(new Zt(e,n,i))}}return t}},{key:"getAttachmentsForSlot",value:function(t,e){var a=this.attachments[t];if(a)for(var n in a){var i=a[n];i&&e.push(new Zt(t,n,i))}}},{key:"clear",value:function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}},{key:"attachAll",value:function(t,e){for(var a=0,n=0;n<t.slots.length;n++){var i=t.slots[n],r=i.getAttachment();if(r&&a<e.attachments.length){var s=e.attachments[a];for(var o in s){if(r==s[o]){var h=this.getAttachment(a,o);null!=h&&i.setAttachment(h);break}}}a++}}}]),t}(),Qt=function t(e){k(this,t),this.name=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.audioPath=void 0,this.volume=void 0,this.balance=void 0,this.name=e};!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(Ft||(Ft={}));var Kt=function t(e,a){if(k(this,t),this.data=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.time=void 0,this.volume=void 0,this.balance=void 0,null==a)throw new Error("data cannot be null.");this.time=e,this.data=a},Jt=function(){function t(e){k(this,t),this.attachmentLoader=void 0,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=e}return E(t,[{key:"readSkeletonData",value:function(e){var a=this.scale,n=new qt,i="string"==typeof e?JSON.parse(e):e,r=i.skeleton;if(null!=r){if(n.hash=r.hash,n.version=r.spine,"3.8.75"==n.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height,n.fps=r.fps,n.imagesPath=r.images}if(i.bones)for(var s=0;s<i.bones.length;s++){var o=i.bones[s],h=null,l=this.getValue(o,"parent",null);if(null!=l&&null==(h=n.findBone(l)))throw new Error("Parent bone not found: "+l);var u=new X(n.bones.length,o.name,h);u.length=this.getValue(o,"length",0)*a,u.x=this.getValue(o,"x",0)*a,u.y=this.getValue(o,"y",0)*a,u.rotation=this.getValue(o,"rotation",0),u.scaleX=this.getValue(o,"scaleX",1),u.scaleY=this.getValue(o,"scaleY",1),u.shearX=this.getValue(o,"shearX",0),u.shearY=this.getValue(o,"shearY",0),u.transformMode=t.transformModeFromString(this.getValue(o,"transform","normal")),u.skinRequired=this.getValue(o,"skin",!1),n.bones.push(u)}if(i.slots)for(var c=0;c<i.slots.length;c++){var d=i.slots[c],f=d.name,v=d.bone,m=n.findBone(v);if(null==m)throw new Error("Slot bone not found: "+v);var g=new Ht(n.slots.length,f,m),p=this.getValue(d,"color",null);null!=p&&g.color.setFromString(p);var y=this.getValue(d,"dark",null);null!=y&&(g.darkColor=new P(1,1,1,1),g.darkColor.setFromString(y)),g.attachmentName=this.getValue(d,"attachment",null),g.blendMode=t.blendModeFromString(this.getValue(d,"blend","normal")),n.slots.push(g)}if(i.ik)for(var k=0;k<i.ik.length;k++){var w=i.ik[k],E=new jt(w.name);E.order=this.getValue(w,"order",0),E.skinRequired=this.getValue(w,"skin",!1);for(var x=0;x<w.bones.length;x++){var b=w.bones[x],M=n.findBone(b);if(null==M)throw new Error("IK bone not found: "+b);E.bones.push(M)}var S=w.target;if(E.target=n.findBone(S),null==E.target)throw new Error("IK target bone not found: "+S);E.mix=this.getValue(w,"mix",1),E.softness=this.getValue(w,"softness",0)*a,E.bendDirection=this.getValue(w,"bendPositive",!0)?1:-1,E.compress=this.getValue(w,"compress",!1),E.stretch=this.getValue(w,"stretch",!1),E.uniform=this.getValue(w,"uniform",!1),n.ikConstraints.push(E)}if(i.transform)for(var R=0;R<i.transform.length;R++){var T=i.transform[R],A=new Gt(T.name);A.order=this.getValue(T,"order",0),A.skinRequired=this.getValue(T,"skin",!1);for(var I=0;I<T.bones.length;I++){var C=T.bones[I],V=n.findBone(C);if(null==V)throw new Error("Transform constraint bone not found: "+C);A.bones.push(V)}var _=T.target;if(A.target=n.findBone(_),null==A.target)throw new Error("Transform constraint target bone not found: "+_);A.local=this.getValue(T,"local",!1),A.relative=this.getValue(T,"relative",!1),A.offsetRotation=this.getValue(T,"rotation",0),A.offsetX=this.getValue(T,"x",0)*a,A.offsetY=this.getValue(T,"y",0)*a,A.offsetScaleX=this.getValue(T,"scaleX",0),A.offsetScaleY=this.getValue(T,"scaleY",0),A.offsetShearY=this.getValue(T,"shearY",0),A.rotateMix=this.getValue(T,"rotateMix",1),A.translateMix=this.getValue(T,"translateMix",1),A.scaleMix=this.getValue(T,"scaleMix",1),A.shearMix=this.getValue(T,"shearMix",1),n.transformConstraints.push(A)}if(i.path)for(var N=0;N<i.path.length;N++){var L=i.path[N],O=new G(L.name);O.order=this.getValue(L,"order",0),O.skinRequired=this.getValue(L,"skin",!1);for(var F=0;F<L.bones.length;F++){var B=L.bones[F],U=n.findBone(B);if(null==U)throw new Error("Transform constraint bone not found: "+B);O.bones.push(U)}var W=L.target;if(O.target=n.findSlot(W),null==O.target)throw new Error("Path target slot not found: "+W);O.positionMode=t.positionModeFromString(this.getValue(L,"positionMode","percent")),O.spacingMode=t.spacingModeFromString(this.getValue(L,"spacingMode","length")),O.rotateMode=t.rotateModeFromString(this.getValue(L,"rotateMode","tangent")),O.offsetRotation=this.getValue(L,"rotation",0),O.position=this.getValue(L,"position",0),O.positionMode==Y.Fixed&&(O.position*=a),O.spacing=this.getValue(L,"spacing",0),O.spacingMode!=D.Length&&O.spacingMode!=D.Fixed||(O.spacing*=a),O.rotateMix=this.getValue(L,"rotateMix",1),O.translateMix=this.getValue(L,"translateMix",1),n.pathConstraints.push(O)}if(i.skins)for(var q=0;q<i.skins.length;q++){var H=i.skins[q],j=new zt(H.name);if(H.bones)for(var Z=0;Z<H.bones.length;Z++){var z=n.findBone(H.bones[Z]);if(null==z)throw new Error("Skin bone not found: "+H.bones[q]);j.bones.push(z)}if(H.ik)for(var Q=0;Q<H.ik.length;Q++){var K=n.findIkConstraint(H.ik[Q]);if(null==K)throw new Error("Skin IK constraint not found: "+H.ik[q]);j.constraints.push(K)}if(H.transform)for(var J=0;J<H.transform.length;J++){var $=n.findTransformConstraint(H.transform[J]);if(null==$)throw new Error("Skin transform constraint not found: "+H.transform[q]);j.constraints.push($)}if(H.path)for(var tt=0;tt<H.path.length;tt++){var et=n.findPathConstraint(H.path[tt]);if(null==et)throw new Error("Skin path constraint not found: "+H.path[q]);j.constraints.push(et)}for(var at in H.attachments){var nt=n.findSlot(at);if(null==nt)throw new Error("Slot not found: "+at);var it=H.attachments[at];for(var rt in it){var st=this.readAttachment(it[rt],j,nt.index,rt,n);null!=st&&j.setAttachment(nt.index,rt,st)}}n.skins.push(j),"default"==j.name&&(n.defaultSkin=j)}for(var ot=0,ht=this.linkedMeshes.length;ot<ht;ot++){var lt=this.linkedMeshes[ot],ut=null==lt.skin?n.defaultSkin:n.findSkin(lt.skin);if(null==ut)throw new Error("Skin not found: "+lt.skin);var ct=ut.getAttachment(lt.slotIndex,lt.parent);if(null==ct)throw new Error("Parent mesh not found: "+lt.parent);lt.mesh.deformAttachment=lt.inheritDeform?ct:lt.mesh,lt.mesh.setParentMesh(ct),lt.mesh.updateUVs()}if(this.linkedMeshes.length=0,i.events)for(var dt in i.events){var ft=i.events[dt],vt=new Qt(dt);vt.intValue=this.getValue(ft,"int",0),vt.floatValue=this.getValue(ft,"float",0),vt.stringValue=this.getValue(ft,"string",""),vt.audioPath=this.getValue(ft,"audio",null),null!=vt.audioPath&&(vt.volume=this.getValue(ft,"volume",1),vt.balance=this.getValue(ft,"balance",0)),n.events.push(vt)}if(i.animations)for(var mt in i.animations){var gt=i.animations[mt];this.readAnimation(gt,mt,n)}return n}},{key:"readAttachment",value:function(t,e,a,n,i){var r=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var s=this.getValue(t,"path",n),o=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==o)return null;o.path=s,o.x=this.getValue(t,"x",0)*r,o.y=this.getValue(t,"y",0)*r,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*r,o.height=t.height*r;var h=this.getValue(t,"color",null);return null!=h&&o.color.setFromString(h),o.updateOffset(),o;case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==l)return null;this.readVertices(t,l,t.vertexCount<<1);var u=this.getValue(t,"color",null);return null!=u&&l.color.setFromString(u),l;case"mesh":case"linkedmesh":var c=this.getValue(t,"path",n),d=this.attachmentLoader.newMeshAttachment(e,n,c);if(null==d)return null;d.path=c;var f=this.getValue(t,"color",null);null!=f&&d.color.setFromString(f),d.width=this.getValue(t,"width",0)*r,d.height=this.getValue(t,"height",0)*r;var v=this.getValue(t,"parent",null);if(null!=v)return this.linkedMeshes.push(new $t(d,this.getValue(t,"skin",null),a,v,this.getValue(t,"deform",!0))),d;var m=t.uvs;return this.readVertices(t,d,m.length),d.triangles=t.triangles,d.regionUVs=m,d.updateUVs(),d.edges=this.getValue(t,"edges",null),d.hullLength=2*this.getValue(t,"hull",0),d;case"path":var g=this.attachmentLoader.newPathAttachment(e,n);if(null==g)return null;g.closed=this.getValue(t,"closed",!1),g.constantSpeed=this.getValue(t,"constantSpeed",!0);var p=t.vertexCount;this.readVertices(t,g,p<<1);for(var y=N.newArray(p/3,0),k=0;k<t.lengths.length;k++)y[k]=t.lengths[k]*r;g.lengths=y;var w=this.getValue(t,"color",null);return null!=w&&g.color.setFromString(w),g;case"point":var E=this.attachmentLoader.newPointAttachment(e,n);if(null==E)return null;E.x=this.getValue(t,"x",0)*r,E.y=this.getValue(t,"y",0)*r,E.rotation=this.getValue(t,"rotation",0);var x=this.getValue(t,"color",null);return null!=x&&E.color.setFromString(x),E;case"clipping":var b=this.attachmentLoader.newClippingAttachment(e,n);if(null==b)return null;var M=this.getValue(t,"end",null);if(null!=M){var S=i.findSlot(M);if(null==S)throw new Error("Clipping end slot not found: "+M);b.endSlot=S}var R=t.vertexCount;this.readVertices(t,b,R<<1);var T=this.getValue(t,"color",null);return null!=T&&b.color.setFromString(T),b}return null}},{key:"readVertices",value:function(t,e,a){var n=this.scale;e.worldVerticesLength=a;var i=t.vertices;if(a!=i.length){for(var r=new Array,s=new Array,o=0,h=i.length;o<h;){var l=i[o++];s.push(l);for(var u=o+4*l;o<u;o+=4)s.push(i[o]),r.push(i[o+1]*n),r.push(i[o+2]*n),r.push(i[o+3])}e.bones=s,e.vertices=N.toFloatArray(r)}else{var c=N.toFloatArray(i);if(1!=n)for(var d=0,f=i.length;d<f;d++)c[d]*=n;e.vertices=c}}},{key:"readAnimation",value:function(t,e,a){var n=this.scale,i=new Array,r=0;if(t.slots)for(var s in t.slots){var o=t.slots[s],h=a.findSlotIndex(s);if(-1==h)throw new Error("Slot not found: "+s);for(var l in o){var u=o[l];if("attachment"==l){var c=new Et(u.length);c.slotIndex=h;for(var d=0,f=0;f<u.length;f++){var v=u[f];c.setFrame(d++,this.getValue(v,"time",0),v.name)}i.push(c),r=Math.max(r,c.frames[c.getFrameCount()-1])}else if("color"==l){var m=new kt(u.length);m.slotIndex=h;for(var g=0,p=0;p<u.length;p++){var y=u[p],k=new P;k.setFromString(y.color),m.setFrame(g,this.getValue(y,"time",0),k.r,k.g,k.b,k.a),this.readCurve(y,m,g),g++}i.push(m),r=Math.max(r,m.frames[(m.getFrameCount()-1)*kt.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");var w=new wt(u.length);w.slotIndex=h;for(var E=0,x=0;x<u.length;x++){var b=u[x],M=new P,S=new P;M.setFromString(b.light),S.setFromString(b.dark),w.setFrame(E,this.getValue(b,"time",0),M.r,M.g,M.b,M.a,S.r,S.g,S.b),this.readCurve(b,w,E),E++}i.push(w),r=Math.max(r,w.frames[(w.getFrameCount()-1)*wt.ENTRIES])}}}if(t.bones)for(var R in t.bones){var T=t.bones[R],A=a.findBoneIndex(R);if(-1==A)throw new Error("Bone not found: "+R);for(var I in T){var C=T[I];if("rotate"===I){var V=new mt(C.length);V.boneIndex=A;for(var _=0,L=0;L<C.length;L++){var O=C[L];V.setFrame(_,this.getValue(O,"time",0),this.getValue(O,"angle",0)),this.readCurve(O,V,_),_++}i.push(V),r=Math.max(r,V.frames[(V.getFrameCount()-1)*mt.ENTRIES])}else{if("translate"!==I&&"scale"!==I&&"shear"!==I)throw new Error("Invalid timeline type for a bone: "+I+" ("+R+")");var F=null,X=1,B=0;"scale"===I?(F=new pt(C.length),B=1):"shear"===I?F=new yt(C.length):(F=new gt(C.length),X=n),F.boneIndex=A;for(var U=0,W=0;W<C.length;W++){var q=C[W],H=this.getValue(q,"x",B),j=this.getValue(q,"y",B);F.setFrame(U,this.getValue(q,"time",0),H*X,j*X),this.readCurve(q,F,U),U++}i.push(F),r=Math.max(r,F.frames[(F.getFrameCount()-1)*gt.ENTRIES])}}}if(t.ik)for(var G in t.ik){var Z=t.ik[G],z=a.findIkConstraint(G),Q=new Rt(Z.length);Q.ikConstraintIndex=a.ikConstraints.indexOf(z);for(var K=0,J=0;J<Z.length;J++){var $=Z[J];Q.setFrame(K,this.getValue($,"time",0),this.getValue($,"mix",1),this.getValue($,"softness",0)*n,this.getValue($,"bendPositive",!0)?1:-1,this.getValue($,"compress",!1),this.getValue($,"stretch",!1)),this.readCurve($,Q,K),K++}i.push(Q),r=Math.max(r,Q.frames[(Q.getFrameCount()-1)*Rt.ENTRIES])}if(t.transform)for(var tt in t.transform){var et=t.transform[tt],at=a.findTransformConstraint(tt),nt=new Tt(et.length);nt.transformConstraintIndex=a.transformConstraints.indexOf(at);for(var it=0,rt=0;rt<et.length;rt++){var st=et[rt];nt.setFrame(it,this.getValue(st,"time",0),this.getValue(st,"rotateMix",1),this.getValue(st,"translateMix",1),this.getValue(st,"scaleMix",1),this.getValue(st,"shearMix",1)),this.readCurve(st,nt,it),it++}i.push(nt),r=Math.max(r,nt.frames[(nt.getFrameCount()-1)*Tt.ENTRIES])}if(t.path)for(var ot in t.path){var ht=t.path[ot],lt=a.findPathConstraintIndex(ot);if(-1==lt)throw new Error("Path constraint not found: "+ot);var ut=a.pathConstraints[lt];for(var ct in ht){var dt=ht[ct];if("position"===ct||"spacing"===ct){var vt=null,xt=1;"spacing"===ct?(vt=new It(dt.length),ut.spacingMode!=D.Length&&ut.spacingMode!=D.Fixed||(xt=n)):(vt=new At(dt.length),ut.positionMode==Y.Fixed&&(xt=n)),vt.pathConstraintIndex=lt;for(var Vt=0,Pt=0;Pt<dt.length;Pt++){var _t=dt[Pt];vt.setFrame(Vt,this.getValue(_t,"time",0),this.getValue(_t,ct,0)*xt),this.readCurve(_t,vt,Vt),Vt++}i.push(vt),r=Math.max(r,vt.frames[(vt.getFrameCount()-1)*At.ENTRIES])}else if("mix"===ct){var Nt=new Ct(dt.length);Nt.pathConstraintIndex=lt;for(var Lt=0,Ot=0;Ot<dt.length;Ot++){var Ft=dt[Ot];Nt.setFrame(Lt,this.getValue(Ft,"time",0),this.getValue(Ft,"rotateMix",1),this.getValue(Ft,"translateMix",1)),this.readCurve(Ft,Nt,Lt),Lt++}i.push(Nt),r=Math.max(r,Nt.frames[(Nt.getFrameCount()-1)*Ct.ENTRIES])}}}if(t.deform)for(var Xt in t.deform){var Yt=t.deform[Xt],Dt=a.findSkin(Xt);if(null==Dt)throw new Error("Skin not found: "+Xt);for(var Bt in Yt){var Ut=Yt[Bt],Wt=a.findSlotIndex(Bt);if(-1==Wt)throw new Error("Slot not found: "+Ut.name);for(var qt in Ut){var Ht=Ut[qt],jt=Dt.getAttachment(Wt,qt);if(null==jt)throw new Error("Deform attachment not found: "+Ht.name);var Gt=null!=jt.bones,Zt=jt.vertices,zt=Gt?Zt.length/3*2:Zt.length,Qt=new bt(Ht.length);Qt.slotIndex=Wt,Qt.attachment=jt;for(var Jt=0,$t=0;$t<Ht.length;$t++){var te=Ht[$t],ee=void 0,ae=this.getValue(te,"vertices",null);if(null==ae)ee=Gt?N.newFloatArray(zt):Zt;else{ee=N.newFloatArray(zt);var ne=this.getValue(te,"offset",0);if(N.arrayCopy(ae,0,ee,ne,ae.length),1!=n)for(var ie=ne,re=ie+ae.length;ie<re;ie++)ee[ie]*=n;if(!Gt)for(var se=0;se<zt;se++)ee[se]+=Zt[se]}Qt.setFrame(Jt,this.getValue(te,"time",0),ee),this.readCurve(te,Qt,Jt),Jt++}i.push(Qt),r=Math.max(r,Qt.frames[Qt.getFrameCount()-1])}}}var oe=t.drawOrder;if(null==oe&&(oe=t.draworder),null!=oe){for(var he=new St(oe.length),le=a.slots.length,ue=0,ce=0;ce<oe.length;ce++){var de=oe[ce],fe=null,ve=this.getValue(de,"offsets",null);if(null!=ve){fe=N.newArray(le,-1);for(var me=N.newArray(le-ve.length,0),ge=0,pe=0,ye=0;ye<ve.length;ye++){var ke=ve[ye],we=a.findSlotIndex(ke.slot);if(-1==we)throw new Error("Slot not found: "+ke.slot);for(;ge!=we;)me[pe++]=ge++;fe[ge+ke.offset]=ge++}for(;ge<le;)me[pe++]=ge++;for(var Ee=le-1;Ee>=0;Ee--)-1==fe[Ee]&&(fe[Ee]=me[--pe])}he.setFrame(ue++,this.getValue(de,"time",0),fe)}i.push(he),r=Math.max(r,he.frames[he.getFrameCount()-1])}if(t.events){for(var xe=new Mt(t.events.length),be=0,Me=0;Me<t.events.length;Me++){var Se=t.events[Me],Re=a.findEvent(Se.name);if(null==Re)throw new Error("Event not found: "+Se.name);var Te=new Kt(N.toSinglePrecision(this.getValue(Se,"time",0)),Re);Te.intValue=this.getValue(Se,"int",Re.intValue),Te.floatValue=this.getValue(Se,"float",Re.floatValue),Te.stringValue=this.getValue(Se,"string",Re.stringValue),null!=Te.data.audioPath&&(Te.volume=this.getValue(Se,"volume",1),Te.balance=this.getValue(Se,"balance",0)),xe.setFrame(be++,Te)}i.push(xe),r=Math.max(r,xe.frames[xe.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");a.animations.push(new ft(e,i,r))}},{key:"readCurve",value:function(t,e,a){if(t.hasOwnProperty("curve"))if("stepped"==t.curve)e.setStepped(a);else{var n=t.curve;e.setCurve(a,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}},{key:"getValue",value:function(t,e,a){return void 0!==t[e]?t[e]:a}}],[{key:"blendModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return Ft.Normal;if("additive"==t)return Ft.Additive;if("multiply"==t)return Ft.Multiply;if("screen"==t)return Ft.Screen;throw new Error("Unknown blend mode: ".concat(t))}},{key:"positionModeFromString",value:function(t){if("fixed"==(t=t.toLowerCase()))return Y.Fixed;if("percent"==t)return Y.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"spacingModeFromString",value:function(t){if("length"==(t=t.toLowerCase()))return D.Length;if("fixed"==t)return D.Fixed;if("percent"==t)return D.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"rotateModeFromString",value:function(t){if("tangent"==(t=t.toLowerCase()))return B.Tangent;if("chain"==t)return B.Chain;if("chainscale"==t)return B.ChainScale;throw new Error("Unknown rotate mode: ".concat(t))}},{key:"transformModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return L.Normal;if("onlytranslation"==t)return L.OnlyTranslation;if("norotationorreflection"==t)return L.NoRotationOrReflection;if("noscale"==t)return L.NoScale;if("noscaleorreflection"==t)return L.NoScaleOrReflection;throw new Error("Unknown transform mode: ".concat(t))}}]),t}(),$t=function t(e,a,n,i,r){k(this,t),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=e,this.skin=a,this.slotIndex=n,this.parent=i,this.inheritDeform=r};export{Yt as AssetManager,Wt as AtlasAttachmentLoader,Jt as SkeletonJson,Ot as SpineRenderer,ot as TextureAtlas};
