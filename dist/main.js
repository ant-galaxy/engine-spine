"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("oasis-engine");function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?o(t):e}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=r(t);if(e){var i=r(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return h(this,a)}}function u(t,e,a){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,a){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(a):i.value}})(t,e,a||t)}var c=function(a){i(o,t.Material);var s=l(o);function o(t,a,n){var i;e(this,o),(i=s.call(this,t,a))._blendStates=void 0,i._stencilStates=void 0,i._depthMask=void 0,i._gl=void 0;var r=t._hardwareRenderer.gl;return i._gl=r,i._blendStates=n.blend,i._stencilStates=n.stencil,i._depthMask=n.depthMask,i}return n(o,[{key:"_generateTechnique",value:function(){var e=this.generateUniform(),a=this.generateAttributes(),n=new t.RenderTechnique(this.name);n.isValid=!0,n.uniforms=e,n.attributes=a,n.vertexShader="\n  uniform mat4 matModelViewProjection;\n\n  attribute vec3 a_position;\n  attribute vec4 a_color;\n  attribute vec2 a_uv;\n  varying vec2 vUv;\n  varying vec4 vColor;\n  void main() {\n    vUv = a_uv;\n    vColor = a_color;\n    gl_Position = matModelViewProjection * vec4(a_position, 1.0);\n  }\n",n.fragmentShader="\n  uniform sampler2D map;\n  varying vec2 vUv;\n  varying vec4 vColor;\n  void main(void) {\n    gl_FragColor = texture2D(map, vUv) * vColor;\n  }\n",n.states={disable:[t.RenderState.CULL_FACE],enable:[t.RenderState.BLEND],functions:{blendFuncSeparate:[t.BlendFunc.SRC_ALPHA,t.BlendFunc.ONE_MINUS_SRC_ALPHA,t.BlendFunc.ONE,t.BlendFunc.ONE_MINUS_SRC_ALPHA]}},this.setDepthMask(n),this.setBlendStates(n),this.setStencilState(n),this._technique=n,this.transparent=!0}},{key:"generateAttributes",value:function(){return{a_position:{name:"a_position",semantic:"POSITION",type:t.DataType.FLOAT_VEC3},a_color:{name:"a_color",semantic:"COLOR",type:t.DataType.FLOAT_VEC4},a_uv:{name:"a_uv",semantic:"TEXCOORD_0",type:t.DataType.FLOAT_VEC2}}}},{key:"generateUniform",value:function(){return{map:{name:"map",type:t.DataType.SAMPLER_2D},matModelViewProjection:{name:"matModelViewProjection",semantic:t.UniformSemantic.MODELVIEWPROJECTION,type:t.DataType.FLOAT_MAT4}}}},{key:"setStencilState",value:function(t){var e=this._stencilStates;e&&(e.stencilTest?(t.states.enable.push(this._gl.STENCIL_TEST),t.states.functions.stencilFunc=[e.stencilFunc,e.stencilFuncRef,e.stencilFuncMask],t.states.functions.stencilOp=[e.stencilOpFail,e.stencilOpZFail,e.stencilOpZPass],t.states.functions.stencilMask=[e.stencilMask]):t.states.disable.push(this._gl.STENCIL_TEST))}},{key:"setBlendStates",value:function(t){var e=this._blendStates;e&&(e.blendEquation&&(t.states.functions.blendEquationSeparate=[e.blendEquation,e.blendEquationAlpha]),"blendDstAlpha"in e||(e.blendDstAlpha=this._gl.ONE_MINUS_SRC_ALPHA,e.blendSrcAlpha=this._gl.ONE),t.states.functions.blendFuncSeparate=[e.blendSrc,e.blendDst,e.blendSrcAlpha,e.blendDstAlpha])}},{key:"setDepthMask",value:function(t){void 0!==this._depthMask&&(t.states.functions.depthMask=[this._depthMask])}},{key:"map",get:function(){return this.getValue("map")},set:function(t){this.setValue("map",t)}},{key:"prepareDrawing",value:function(t,e,a){this._technique||this._generateTechnique(),u(r(o.prototype),"prepareDrawing",this).call(this,t,e,a)}}]),o}(),d=function(a){i(s,t.GeometryRenderer);var r=l(s);function s(t){var a;return e(this,s),(a=r.call(this,t)).vertices=void 0,a.indices=void 0,a.indexBuffer=void 0,a.vertexBuffer=void 0,a.verticesLength=0,a.indicesLength=0,a}return n(s,[{key:"initGeometry",value:function(e){var a=new t.BufferGeometry(this.engine,"spine_batch_geometry"),n=new Float32Array(e*s.VERTEX_SIZE),i=new Uint16Array(3*e);this.vertices=n,this.indices=i;var r=[new t.VertexElement("POSITION",0,t.VertexElementFormat.Vector3,0),new t.VertexElement("COLOR",12,t.VertexElementFormat.Vector4,0),new t.VertexElement("TEXCOORD_0",28,t.VertexElementFormat.Vector2,0)],o=36*e,h=new t.Buffer(this.engine,t.BufferBindFlag.VertexBuffer,o,t.BufferUsage.Dynamic),l=new t.Buffer(this.engine,t.BufferBindFlag.IndexBuffer,i,t.BufferUsage.Dynamic);this.indexBuffer=l,this.vertexBuffer=h,a.setVertexBufferBinding(h,36),a.setIndexBufferBinding(l,t.IndexFormat.UInt16),a.setVertexElements(r),a.addSubGeometry(0,i.length),this.geometry=a}},{key:"initMaterial",value:function(t){var e=t.stencil,a=t.blend,n=t.depthMask;this.material=new c(this.engine,"skeleton_material",{stencil:e,blend:a,depthMask:n})}},{key:"clear",value:function(){}},{key:"begin",value:function(){this.verticesLength=0,this.indicesLength=0}},{key:"canBatch",value:function(t,e){return!(this.indicesLength+e>=this.indices.byteLength/2)&&!(this.verticesLength+t>=this.vertices.byteLength/2)}},{key:"batch",value:function(t,e,a,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=this.verticesLength/s.VERTEX_SIZE,o=this.vertices,h=this.verticesLength,l=0;l<e;)o[h++]=t[l++],o[h++]=t[l++],o[h++]=i,o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++],o[h++]=t[l++];this.vertexBuffer.setData(this.vertices),this.verticesLength=h;var u=this.indices;for(h=this.indicesLength,l=0;l<n;h++,l++)u[h]=a[l]+r;this.indicesLength+=n,this.indexBuffer.setData(this.indices)}},{key:"end",value:function(){}}]),s}();d.VERTEX_SIZE=9;var f=function(){function t(){e(this,t),this.array=new Array}return n(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return null!=this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}(),v=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.r=a,this.g=n,this.b=i,this.a=r}return n(t,[{key:"set",value:function(t,e,a,n){return this.r=t,this.g=e,this.b=a,this.a=n,this.clamp(),this}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this}},{key:"add",value:function(t,e,a,n){return this.r+=t,this.g+=e,this.b+=a,this.a+=n,this.clamp(),this}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}]),t}();v.WHITE=new v(1,1,1,1),v.RED=new v(1,0,0,1),v.GREEN=new v(0,1,0,1),v.BLUE=new v(0,0,1,1),v.MAGENTA=new v(1,0,1,1);var m=function(){function t(){e(this,t)}return n(t,null,[{key:"clamp",value:function(t,e,a){return t<e?e:t>a?a:t}},{key:"cosDeg",value:function(e){return Math.cos(e*t.degRad)}},{key:"sinDeg",value:function(e){return Math.sin(e*t.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}},{key:"randomTriangular",value:function(e,a){return t.randomTriangularWith(e,a,.5*(e+a))}},{key:"randomTriangularWith",value:function(t,e,a){var n=Math.random(),i=e-t;return n<=(a-t)/i?t+Math.sqrt(n*i*(a-t)):e-Math.sqrt((1-n)*i*(e-a))}}]),t}();m.PI=3.1415927,m.PI2=2*m.PI,m.radiansToDegrees=180/m.PI,m.radDeg=m.radiansToDegrees,m.degreesToRadians=m.PI/180,m.degRad=m.degreesToRadians;var g=function(){function t(){e(this,t)}return n(t,null,[{key:"arrayCopy",value:function(t,e,a,n,i){for(var r=e,s=n;r<e+i;r++,s++)a[s]=t[r]}},{key:"setArraySize",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n==e)return t;if(t.length=e,n<e)for(var i=n;i<e;i++)t[i]=a;return t}},{key:"ensureArrayCapacity",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.length>=a?e:t.setArraySize(e,a,n)}},{key:"newArray",value:function(t,e){for(var a=new Array(t),n=0;n<t;n++)a[n]=e;return a}},{key:"newFloatArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"newShortArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var a=new Array(e),n=0;n<a.length;n++)a[n]=0;return a}},{key:"toFloatArray",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}},{key:"toSinglePrecision",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}},{key:"webkit602BugfixHelper",value:function(t,e){}},{key:"contains",value:function(t,e){for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return!1}}]),t}();g.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;var p,y=function(){function t(a){e(this,t),this.items=new Array,this.instantiator=void 0,this.instantiator=a}return n(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){t.reset&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),t}(),k=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=a,this.y=n}return n(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}]),t}(),x=function t(a,n,i){if(e(this,t),this.index=void 0,this.name=void 0,this.parent=void 0,this.length=void 0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=p.Normal,this.skinRequired=!1,this.color=new v,a<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");this.index=a,this.name=n,this.parent=i};!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(p||(p={}));var w,E,b,M=function(){function t(a,n,i){if(e(this,t),this.data=void 0,this.skeleton=void 0,this.parent=void 0,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==a)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=a,this.skeleton=n,this.parent=i,this.setToSetupPose()}return n(t,[{key:"isActive",value:function(){return this.active}},{key:"update",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransform",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransformWith",value:function(t,e,a,n,i,r,s){this.ax=t,this.ay=e,this.arotation=a,this.ascaleX=n,this.ascaleY=i,this.ashearX=r,this.ashearY=s,this.appliedValid=!0;var o=this.parent;if(null==o){var h=this.skeleton,l=a+90+s,u=h.scaleX,c=h.scaleY;return this.a=m.cosDeg(a+r)*n*u,this.b=m.cosDeg(l)*i*u,this.c=m.sinDeg(a+r)*n*c,this.d=m.sinDeg(l)*i*c,this.worldX=t*u+h.x,void(this.worldY=e*c+h.y)}var d=o.a,f=o.b,v=o.c,g=o.d;switch(this.worldX=d*t+f*e+o.worldX,this.worldY=v*t+g*e+o.worldY,this.data.transformMode){case p.Normal:var y=a+90+s,k=m.cosDeg(a+r)*n,x=m.cosDeg(y)*i,w=m.sinDeg(a+r)*n,E=m.sinDeg(y)*i;return this.a=d*k+f*w,this.b=d*x+f*E,this.c=v*k+g*w,void(this.d=v*x+g*E);case p.OnlyTranslation:var b=a+90+s;this.a=m.cosDeg(a+r)*n,this.b=m.cosDeg(b)*i,this.c=m.sinDeg(a+r)*n,this.d=m.sinDeg(b)*i;break;case p.NoRotationOrReflection:var M=d*d+v*v,S=0;M>1e-4?(M=Math.abs(d*g-f*v)/M,d/=this.skeleton.scaleX,f=(v/=this.skeleton.scaleY)*M,g=d*M,S=Math.atan2(v,d)*m.radDeg):(d=0,v=0,S=90-Math.atan2(g,f)*m.radDeg);var T=a+r-S,R=a+s-S+90,A=m.cosDeg(T)*n,I=m.cosDeg(R)*i,V=m.sinDeg(T)*n,C=m.sinDeg(R)*i;this.a=d*A-f*V,this.b=d*I-f*C,this.c=v*A+g*V,this.d=v*I+g*C;break;case p.NoScale:case p.NoScaleOrReflection:var P=m.cosDeg(a),_=m.sinDeg(a),N=(d*P+f*_)/this.skeleton.scaleX,L=(v*P+g*_)/this.skeleton.scaleY,F=Math.sqrt(N*N+L*L);F>1e-5&&(F=1/F),N*=F,L*=F,F=Math.sqrt(N*N+L*L),this.data.transformMode==p.NoScale&&d*g-f*v<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(F=-F);var O=Math.PI/2+Math.atan2(L,N),X=Math.cos(O)*F,Y=Math.sin(O)*F,D=m.cosDeg(r)*n,B=m.cosDeg(90+s)*i,U=m.sinDeg(r)*n,q=m.sinDeg(90+s)*i;this.a=N*D+X*U,this.b=N*B+X*q,this.c=L*D+Y*U,this.d=L*B+Y*q}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}},{key:"setToSetupPose",value:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}},{key:"getWorldRotationX",value:function(){return Math.atan2(this.c,this.a)*m.radDeg}},{key:"getWorldRotationY",value:function(){return Math.atan2(this.d,this.b)*m.radDeg}},{key:"getWorldScaleX",value:function(){return Math.sqrt(this.a*this.a+this.c*this.c)}},{key:"getWorldScaleY",value:function(){return Math.sqrt(this.b*this.b+this.d*this.d)}},{key:"updateAppliedTransform",value:function(){this.appliedValid=!0;var t=this.parent;if(null==t)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*m.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*m.radDeg);var e=t.a,a=t.b,n=t.c,i=t.d,r=1/(e*i-a*n),s=this.worldX-t.worldX,o=this.worldY-t.worldY;this.ax=s*i*r-o*a*r,this.ay=o*e*r-s*n*r;var h=r*i,l=r*e,u=r*a,c=r*n,d=h*this.a-u*this.c,f=h*this.b-u*this.d,v=l*this.c-c*this.a,g=l*this.d-c*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+v*v),this.ascaleX>1e-4){var p=d*g-f*v;this.ascaleY=p/this.ascaleX,this.ashearY=Math.atan2(d*f+v*g,p)*m.radDeg,this.arotation=Math.atan2(v,d)*m.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,f)*m.radDeg}},{key:"worldToLocal",value:function(t){var e=this.a,a=this.b,n=this.c,i=this.d,r=1/(e*i-a*n),s=t.x-this.worldX,o=t.y-this.worldY;return t.x=s*i*r-o*a*r,t.y=o*e*r-s*n*r,t}},{key:"localToWorld",value:function(t){var e=t.x,a=t.y;return t.x=e*this.a+a*this.b+this.worldX,t.y=e*this.c+a*this.d+this.worldY,t}},{key:"worldToLocalRotation",value:function(t){var e=m.sinDeg(t),a=m.cosDeg(t);return Math.atan2(this.a*e-this.c*a,this.d*a-this.b*e)*m.radDeg+this.rotation-this.shearX}},{key:"localToWorldRotation",value:function(t){t-=this.rotation-this.shearX;var e=m.sinDeg(t),a=m.cosDeg(t);return Math.atan2(a*this.c+e*this.d,a*this.a+e*this.b)*m.radDeg}},{key:"rotateWorld",value:function(t){var e=this.a,a=this.b,n=this.c,i=this.d,r=m.cosDeg(t),s=m.sinDeg(t);this.a=r*e-s*n,this.b=r*a-s*i,this.c=s*e+r*n,this.d=s*a+r*i,this.appliedValid=!1}}]),t}(),S=function(){function t(a,n){if(e(this,t),this.data=void 0,this.bone=void 0,this.color=void 0,this.darkColor=void 0,this.attachment=void 0,this.slot=void 0,this.attachment=void 0,this.attachmentTime=void 0,this.attachmentState=void 0,this.deform=new Array,null==a)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=a,this.bone=n,this.color=new v,this.darkColor=null==a.darkColor?null:new v,this.setToSetupPose()}return n(t,[{key:"getSkeleton",value:function(){return this.bone.skeleton}},{key:"getAttachment",value:function(){return this.attachment}},{key:"setAttachment",value:function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}},{key:"setAttachmentTime",value:function(t){this.attachmentTime=this.bone.skeleton.time-t}},{key:"getAttachmentTime",value:function(){return this.bone.skeleton.time-this.attachmentTime}},{key:"setToSetupPose",value:function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}]),t}(),T=function(){function t(a,n){if(e(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==a)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=a,this.mix=a.mix,this.softness=a.softness,this.bendDirection=a.bendDirection,this.compress=a.compress,this.stretch=a.stretch,this.bones=new Array;for(var i=0;i<a.bones.length;i++)this.bones.push(n.findBone(a.bones[i].name));this.target=n.findBone(a.target.name)}return n(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}},{key:"apply1",value:function(t,e,a,n,i,r,s){t.appliedValid||t.updateAppliedTransform();var o=t.parent,h=o.a,l=o.b,u=o.c,c=o.d,d=-t.ashearX-t.arotation,f=0,v=0;switch(t.data.transformMode){case p.OnlyTranslation:f=e-t.worldX,v=a-t.worldY;break;case p.NoRotationOrReflection:var g=Math.abs(h*c-l*u)/(h*h+u*u),y=h/t.skeleton.scaleX,k=u/t.skeleton.scaleY;l=-k*g*t.skeleton.scaleX,c=y*g*t.skeleton.scaleY,d+=Math.atan2(k,y)*m.radDeg;default:var x=e-o.worldX,w=a-o.worldY,E=h*c-l*u;f=(x*c-w*l)/E-t.ax,v=(w*h-x*u)/E-t.ay}d+=Math.atan2(v,f)*m.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var b=t.ascaleX,M=t.ascaleY;if(n||i){switch(t.data.transformMode){case p.NoScale:case p.NoScaleOrReflection:f=e-t.worldX,v=a-t.worldY}var S=t.data.length*b,T=Math.sqrt(f*f+v*v);if(n&&T<S||i&&T>S&&S>1e-4){var R=(T/S-1)*s+1;b*=R,r&&(M*=R)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*s,b,M,t.ashearX,t.ashearY)}},{key:"apply2",value:function(t,e,a,n,i,r,s,o){if(0!=o){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var h=t.ax,l=t.ay,u=t.ascaleX,c=u,d=t.ascaleY,f=e.ascaleX,v=0,g=0,p=0;u<0?(u=-u,v=180,p=-1):(v=0,p=1),d<0&&(d=-d,p=-p),f<0?(f=-f,g=180):g=0;var y=e.ax,k=0,x=0,w=0,E=t.a,b=t.b,M=t.c,S=t.d,T=Math.abs(u-d)<=1e-4;T?(x=E*y+b*(k=e.ay)+t.worldX,w=M*y+S*k+t.worldY):(k=0,x=E*y+t.worldX,w=M*y+t.worldY);var R=t.parent;E=R.a,b=R.b,M=R.c;var A,I,V=1/(E*(S=R.d)-b*M),C=x-R.worldX,P=w-R.worldY,_=(C*S-P*b)*V-h,N=(P*E-C*M)*V-l,L=Math.sqrt(_*_+N*N),F=e.data.length*f;if(L<1e-4)return this.apply1(t,a,n,!1,r,!1,o),void e.updateWorldTransformWith(y,k,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var O=((C=a-R.worldX)*S-(P=n-R.worldY)*b)*V-h,X=(P*E-C*M)*V-l,Y=O*O+X*X;if(0!=s){s*=u*(f+1)/2;var D=Math.sqrt(Y),B=D-L-F*u+s;if(B>0){var U=Math.min(1,B/(2*s))-1;Y=(O-=(U=(B-s*(1-U*U))/D)*O)*O+(X-=U*X)*X}}t:if(T){var q=(Y-L*L-(F*=u)*F)/(2*L*F);q<-1?q=-1:q>1&&(q=1,r&&(c*=(Math.sqrt(Y)/(L+F)-1)*o+1)),I=Math.acos(q)*i,E=L+F*q,b=F*Math.sin(I),A=Math.atan2(X*E-O*b,O*E+X*b)}else{var W=(E=u*F)*E,H=(b=d*F)*b,j=Math.atan2(X,O),G=-2*H*L,Z=H-W;if((S=G*G-4*Z*(M=H*L*L+W*Y-W*H))>=0){var z=Math.sqrt(S);G<0&&(z=-z);var Q=(z=-(G+z)/2)/Z,K=M/z,J=Math.abs(Q)<Math.abs(K)?Q:K;if(J*J<=Y){P=Math.sqrt(Y-J*J)*i,A=j-Math.atan2(P,J),I=Math.atan2(P/d,(J-L)/u);break t}}var $=m.PI,tt=L-E,et=tt*tt,at=0,nt=0,it=L+E,rt=it*it,st=0;(M=-E*L/(W-H))>=-1&&M<=1&&(M=Math.acos(M),(S=(C=E*Math.cos(M)+L)*C+(P=b*Math.sin(M))*P)<et&&($=M,et=S,tt=C,at=P),S>rt&&(nt=M,rt=S,it=C,st=P)),Y<=(et+rt)/2?(A=j-Math.atan2(at*i,tt),I=$*i):(A=j-Math.atan2(st*i,it),I=nt*i)}var ot=Math.atan2(k,y)*p,ht=t.arotation;(A=(A-ot)*m.radDeg+v-ht)>180?A-=360:A<-180&&(A+=360),t.updateWorldTransformWith(h,l,ht+A*o,c,t.ascaleY,0,0),ht=e.arotation,(I=((I+ot)*m.radDeg-e.ashearX)*p+g-ht)>180?I-=360:I<-180&&(I+=360),e.updateWorldTransformWith(y,k,ht+I*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()}}]),t}(),R=function(){function t(a,n){if(e(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new k,this.active=!1,null==a)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=a,this.rotateMix=a.rotateMix,this.translateMix=a.translateMix,this.scaleMix=a.scaleMix,this.shearMix=a.shearMix,this.bones=new Array;for(var i=0;i<a.bones.length;i++)this.bones.push(n.findBone(a.bones[i].name));this.target=n.findBone(a.target.name)}return n(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}},{key:"applyAbsoluteWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target,r=i.a,s=i.b,o=i.c,h=i.d,l=r*h-s*o>0?m.degRad:-m.degRad,u=this.data.offsetRotation*l,c=this.data.offsetShearY*l,d=this.bones,f=0,v=d.length;f<v;f++){var g=d[f],p=!1;if(0!=t){var y=g.a,k=g.b,x=g.c,w=g.d,E=Math.atan2(o,r)-Math.atan2(x,y)+u;E>m.PI?E-=m.PI2:E<-m.PI&&(E+=m.PI2),E*=t;var b=Math.cos(E),M=Math.sin(E);g.a=b*y-M*x,g.b=b*k-M*w,g.c=M*y+b*x,g.d=M*k+b*w,p=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(S.x-g.worldX)*e,g.worldY+=(S.y-g.worldY)*e,p=!0}if(a>0){var T=Math.sqrt(g.a*g.a+g.c*g.c),R=Math.sqrt(r*r+o*o);T>1e-5&&(T=(T+(R-T+this.data.offsetScaleX)*a)/T),g.a*=T,g.c*=T,T=Math.sqrt(g.b*g.b+g.d*g.d),R=Math.sqrt(s*s+h*h),T>1e-5&&(T=(T+(R-T+this.data.offsetScaleY)*a)/T),g.b*=T,g.d*=T,p=!0}if(n>0){var A=g.b,I=g.d,V=Math.atan2(I,A),C=Math.atan2(h,s)-Math.atan2(o,r)-(V-Math.atan2(g.c,g.a));C>m.PI?C-=m.PI2:C<-m.PI&&(C+=m.PI2),C=V+(C+c)*n;var P=Math.sqrt(A*A+I*I);g.b=Math.cos(C)*P,g.d=Math.sin(C)*P,p=!0}p&&(g.appliedValid=!1)}}},{key:"applyRelativeWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target,r=i.a,s=i.b,o=i.c,h=i.d,l=r*h-s*o>0?m.degRad:-m.degRad,u=this.data.offsetRotation*l,c=this.data.offsetShearY*l,d=this.bones,f=0,v=d.length;f<v;f++){var g=d[f],p=!1;if(0!=t){var y=g.a,k=g.b,x=g.c,w=g.d,E=Math.atan2(o,r)+u;E>m.PI?E-=m.PI2:E<-m.PI&&(E+=m.PI2),E*=t;var b=Math.cos(E),M=Math.sin(E);g.a=b*y-M*x,g.b=b*k-M*w,g.c=M*y+b*x,g.d=M*k+b*w,p=!0}if(0!=e){var S=this.temp;i.localToWorld(S.set(this.data.offsetX,this.data.offsetY)),g.worldX+=S.x*e,g.worldY+=S.y*e,p=!0}if(a>0){var T=(Math.sqrt(r*r+o*o)-1+this.data.offsetScaleX)*a+1;g.a*=T,g.c*=T,T=(Math.sqrt(s*s+h*h)-1+this.data.offsetScaleY)*a+1,g.b*=T,g.d*=T,p=!0}if(n>0){var R=Math.atan2(h,s)-Math.atan2(o,r);R>m.PI?R-=m.PI2:R<-m.PI&&(R+=m.PI2);var A=g.b,I=g.d;R=Math.atan2(I,A)+(R-m.PI/2+c)*n;var V=Math.sqrt(A*A+I*I);g.b=Math.cos(R)*V,g.d=Math.sin(R)*V,p=!0}p&&(g.appliedValid=!1)}}},{key:"applyAbsoluteLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var r=this.bones,s=0,o=r.length;s<o;s++){var h=r[s];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;if(0!=t){var u=i.arotation-l+this.data.offsetRotation;l+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=h.ax,d=h.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,d+=(i.ay-d+this.data.offsetY)*e);var f=h.ascaleX,v=h.ascaleY;0!=a&&(f>1e-5&&(f=(f+(i.ascaleX-f+this.data.offsetScaleX)*a)/f),v>1e-5&&(v=(v+(i.ascaleY-v+this.data.offsetScaleY)*a)/v));var m=h.ashearY;if(0!=n){var g=i.ashearY-m+this.data.offsetShearY;g-=360*(16384-(16384.499999999996-g/360|0)),h.shearY+=g*n}h.updateWorldTransformWith(c,d,l,f,v,h.ashearX,m)}}},{key:"applyRelativeLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();for(var r=this.bones,s=0,o=r.length;s<o;s++){var h=r[s];h.appliedValid||h.updateAppliedTransform();var l=h.arotation;0!=t&&(l+=(i.arotation+this.data.offsetRotation)*t);var u=h.ax,c=h.ay;0!=e&&(u+=(i.ax+this.data.offsetX)*e,c+=(i.ay+this.data.offsetY)*e);var d=h.ascaleX,f=h.ascaleY;0!=a&&(d>1e-5&&(d*=(i.ascaleX-1+this.data.offsetScaleX)*a+1),f>1e-5&&(f*=(i.ascaleY-1+this.data.offsetScaleY)*a+1));var v=h.ashearY;0!=n&&(v+=(i.ashearY+this.data.offsetShearY)*n),h.updateWorldTransformWith(u,c,l,d,f,h.ashearX,v)}}}]),t}(),A=function t(a,n,i){e(this,t),this.name=a,this.order=n,this.skinRequired=i},I=function(t){i(n,A);var a=l(n);function n(t){var i;return e(this,n),(i=a.call(this,t,0,!1)).bones=new Array,i.target=void 0,i.positionMode=void 0,i.spacingMode=void 0,i.rotateMode=void 0,i.offsetRotation=void 0,i.position=void 0,i.spacing=void 0,i.rotateMix=void 0,i.translateMix=void 0,i}return n}();!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(w||(w={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent"}(E||(E={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(b||(b={}));var V=function t(a){if(e(this,t),this.name=void 0,null==a)throw new Error("name cannot be null.");this.name=a},C=function(t){i(r,V);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).id=(65535&r.nextID++)<<11,n.bones=void 0,n.vertices=void 0,n.worldVerticesLength=0,n.deformAttachment=o(n),n}return n(r,[{key:"computeWorldVertices",value:function(t,e,a,n,i,r){a=i+(a>>1)*r;var s=t.bone.skeleton,o=t.deform,h=this.vertices,l=this.bones;if(null!=l){for(var u=0,c=0,d=0;d<e;d+=2){var f=l[u];u+=f+1,c+=f}var v=s.bones;if(0==o.length)for(var m=i,g=3*c;m<a;m+=r){var p=0,y=0,k=l[u++];for(k+=u;u<k;u++,g+=3){var x=v[l[u]],w=h[g],E=h[g+1],b=h[g+2];p+=(w*x.a+E*x.b+x.worldX)*b,y+=(w*x.c+E*x.d+x.worldY)*b}n[m]=p,n[m+1]=y}else for(var M=o,S=i,T=3*c,R=c<<1;S<a;S+=r){var A=0,I=0,V=l[u++];for(V+=u;u<V;u++,T+=3,R+=2){var C=v[l[u]],P=h[T]+M[R],_=h[T+1]+M[R+1],N=h[T+2];A+=(P*C.a+_*C.b+C.worldX)*N,I+=(P*C.c+_*C.d+C.worldY)*N}n[S]=A,n[S+1]=I}}else{o.length>0&&(h=o);for(var L=t.bone,F=L.worldX,O=L.worldY,X=L.a,Y=L.b,D=L.c,B=L.d,U=e,q=i;q<a;U+=2,q+=r){var W=h[U],H=h[U+1];n[q]=W*X+H*Y+F,n[q+1]=W*D+H*B+O}}}},{key:"copyTo",value:function(t){null!=this.bones?(t.bones=new Array(this.bones.length),g.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=g.newFloatArray(this.vertices.length),g.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}}]),r}();C.nextID=0;var P=function(t){i(r,C);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).lengths=void 0,n.closed=!1,n.constantSpeed=!1,n.color=new v(1,1,1,1),n}return n(r,[{key:"copy",value:function(){var t=new r(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),g.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}]),r}(),_=function(){function t(a,n){if(e(this,t),this.data=void 0,this.bones=void 0,this.target=void 0,this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==a)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=a,this.bones=new Array;for(var i=0,r=a.bones.length;i<r;i++)this.bones.push(n.findBone(a.bones[i].name));this.target=n.findSlot(a.target.name),this.position=a.position,this.spacing=a.spacing,this.rotateMix=a.rotateMix,this.translateMix=a.translateMix}return n(t,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var e=this.target.getAttachment();if(e instanceof P){var a=this.rotateMix,n=this.translateMix,i=a>0;if(n>0||i){var r=this.data,s=r.spacingMode==E.Percent,o=r.rotateMode,h=o==b.Tangent,l=o==b.ChainScale,u=this.bones.length,c=h?u:u+1,d=this.bones,f=g.setArraySize(this.spaces,c),v=null,p=this.spacing;if(l||!s){l&&(v=g.setArraySize(this.lengths,u));for(var y=r.spacingMode==E.Length,k=0,x=c-1;k<x;){var M=d[k],S=M.data.length;if(S<t.epsilon)l&&(v[k]=0),f[++k]=0;else if(s){if(l){var T=S*M.a,R=S*M.c,A=Math.sqrt(T*T+R*R);v[k]=A}f[++k]=p}else{var I=S*M.a,V=S*M.c,C=Math.sqrt(I*I+V*V);l&&(v[k]=C),f[++k]=(y?S+p:p)*C/S}}}else for(var _=1;_<c;_++)f[_]=p;var N=this.computeWorldPositions(e,c,h,r.positionMode==w.Percent,s),L=N[0],F=N[1],O=r.offsetRotation,X=!1;if(0==O)X=o==b.Chain;else{X=!1;var Y=this.target.bone;O*=Y.a*Y.d-Y.b*Y.c>0?m.degRad:-m.degRad}for(var D=0,B=3;D<u;D++,B+=3){var U=d[D];U.worldX+=(L-U.worldX)*n,U.worldY+=(F-U.worldY)*n;var q=N[B],W=N[B+1],H=q-L,j=W-F;if(l){var G=v[D];if(0!=G){var Z=(Math.sqrt(H*H+j*j)/G-1)*a+1;U.a*=Z,U.c*=Z}}if(L=q,F=W,i){var z=U.a,Q=U.b,K=U.c,J=U.d,$=0,tt=0,et=0;if($=h?N[B-1]:0==f[D+1]?N[B+2]:Math.atan2(j,H),$-=Math.atan2(K,z),X){tt=Math.cos($),et=Math.sin($);var at=U.data.length;L+=(at*(tt*z-et*K)-H)*a,F+=(at*(et*z+tt*K)-j)*a}else $+=O;$>m.PI?$-=m.PI2:$<-m.PI&&($+=m.PI2),$*=a,tt=Math.cos($),et=Math.sin($),U.a=tt*z-et*K,U.b=tt*Q-et*J,U.c=et*z+tt*K,U.d=et*Q+tt*J}U.appliedValid=!1}}}}},{key:"computeWorldPositions",value:function(e,a,n,i,r){var s=this.target,o=this.position,h=this.spaces,l=g.setArraySize(this.positions,3*a+2),u=null,c=e.closed,d=e.worldVerticesLength,f=d/6,v=t.NONE;if(!e.constantSpeed){var m=e.lengths,p=m[f-=c?1:2];if(i&&(o*=p),r)for(var y=1;y<a;y++)h[y]*=p;u=g.setArraySize(this.world,8);for(var k=0,x=0,w=0;k<a;k++,x+=3){var E=h[k],b=o+=E;if(c)(b%=p)<0&&(b+=p),w=0;else{if(b<0){v!=t.BEFORE&&(v=t.BEFORE,e.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(b,u,0,l,x);continue}if(b>p){v!=t.AFTER&&(v=t.AFTER,e.computeWorldVertices(s,d-6,4,u,0,2)),this.addAfterPosition(b-p,u,0,l,x);continue}}for(;;w++){var M=m[w];if(!(b>M)){if(0==w)b/=M;else{var S=m[w-1];b=(b-S)/(M-S)}break}}w!=v&&(v=w,c&&w==f?(e.computeWorldVertices(s,d-4,4,u,0,2),e.computeWorldVertices(s,0,4,u,4,2)):e.computeWorldVertices(s,6*w+2,8,u,0,2)),this.addCurvePosition(b,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],l,x,n||k>0&&0==E)}return l}c?(d+=2,u=g.setArraySize(this.world,d),e.computeWorldVertices(s,2,d-4,u,0,2),e.computeWorldVertices(s,0,2,u,d-4,2),u[d-2]=u[0],u[d-1]=u[1]):(f--,d-=4,u=g.setArraySize(this.world,d),e.computeWorldVertices(s,2,d,u,0,2));for(var T=g.setArraySize(this.curves,f),R=0,A=u[0],I=u[1],V=0,C=0,P=0,_=0,N=0,L=0,F=0,O=0,X=0,Y=0,D=0,B=0,U=0,q=0,W=0,H=2;W<f;W++,H+=6)V=u[H],C=u[H+1],P=u[H+2],_=u[H+3],D=2*(F=.1875*(A-2*V+P))+(X=.09375*(3*(V-P)-A+(N=u[H+4]))),B=2*(O=.1875*(I-2*C+_))+(Y=.09375*(3*(C-_)-I+(L=u[H+5]))),U=.75*(V-A)+F+.16666667*X,q=.75*(C-I)+O+.16666667*Y,R+=Math.sqrt(U*U+q*q),U+=D,q+=B,D+=X,B+=Y,R+=Math.sqrt(U*U+q*q),U+=D,q+=B,R+=Math.sqrt(U*U+q*q),U+=D+X,q+=B+Y,R+=Math.sqrt(U*U+q*q),T[W]=R,A=N,I=L;if(o*=i?R:R/e.lengths[f-1],r)for(var j=1;j<a;j++)h[j]*=R;for(var G=this.segments,Z=0,z=0,Q=0,K=0,J=0;z<a;z++,Q+=3){var $=h[z],tt=o+=$;if(c)(tt%=R)<0&&(tt+=R),K=0;else{if(tt<0){this.addBeforePosition(tt,u,0,l,Q);continue}if(tt>R){this.addAfterPosition(tt-R,u,d-4,l,Q);continue}}for(;;K++){var et=T[K];if(!(tt>et)){if(0==K)tt/=et;else{var at=T[K-1];tt=(tt-at)/(et-at)}break}}if(K!=v){v=K;var nt=6*K;for(A=u[nt],I=u[nt+1],V=u[nt+2],C=u[nt+3],P=u[nt+4],_=u[nt+5],D=2*(F=.03*(A-2*V+P))+(X=.006*(3*(V-P)-A+(N=u[nt+6]))),B=2*(O=.03*(I-2*C+_))+(Y=.006*(3*(C-_)-I+(L=u[nt+7]))),U=.3*(V-A)+F+.16666667*X,q=.3*(C-I)+O+.16666667*Y,Z=Math.sqrt(U*U+q*q),G[0]=Z,nt=1;nt<8;nt++)U+=D,q+=B,D+=X,B+=Y,Z+=Math.sqrt(U*U+q*q),G[nt]=Z;U+=D,q+=B,Z+=Math.sqrt(U*U+q*q),G[8]=Z,U+=D+X,q+=B+Y,Z+=Math.sqrt(U*U+q*q),G[9]=Z,J=0}for(tt*=Z;;J++){var it=G[J];if(!(tt>it)){if(0==J)tt/=it;else{var rt=G[J-1];tt=J+(tt-rt)/(it-rt)}break}}this.addCurvePosition(.1*tt,A,I,V,C,P,_,N,L,l,Q,n||z>0&&0==$)}return l}},{key:"addBeforePosition",value:function(t,e,a,n,i){var r=e[a],s=e[a+1],o=e[a+2]-r,h=e[a+3]-s,l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=s+t*Math.sin(l),n[i+2]=l}},{key:"addAfterPosition",value:function(t,e,a,n,i){var r=e[a+2],s=e[a+3],o=r-e[a],h=s-e[a+1],l=Math.atan2(h,o);n[i]=r+t*Math.cos(l),n[i+1]=s+t*Math.sin(l),n[i+2]=l}},{key:"addCurvePosition",value:function(t,e,a,n,i,r,s,o,h,l,u,c){if(0==t||isNaN(t))return l[u]=e,l[u+1]=a,void(l[u+2]=Math.atan2(i-a,n-e));var d=t*t,f=d*t,v=1-t,m=v*v,g=m*v,p=v*t,y=3*p,k=v*y,x=y*t,w=e*g+n*k+r*x+o*f,E=a*g+i*k+s*x+h*f;l[u]=w,l[u+1]=E,c&&(l[u+2]=t<.001?Math.atan2(i-a,n-e):Math.atan2(E-(a*m+i*p*2+s*d),w-(e*m+n*p*2+r*d)))}}]),t}();_.NONE=-1,_.BEFORE=-2,_.AFTER=-3,_.epsilon=1e-5;var N=function(t){i(r,V);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new v(1,1,1,1),n.path=void 0,n.rendererObject=void 0,n.region=void 0,n.offset=g.newFloatArray(8),n.uvs=g.newFloatArray(8),n.tempColor=new v(1,1,1,1),n}return n(r,[{key:"updateOffset",value:function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,a=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,i=a+this.region.width*t,s=n+this.region.height*e,o=this.rotation*Math.PI/180,h=Math.cos(o),l=Math.sin(o),u=a*h+this.x,c=a*l,d=n*h+this.y,f=n*l,v=i*h+this.x,m=i*l,g=s*h+this.y,p=s*l,y=this.offset;y[r.OX1]=u-f,y[r.OY1]=d+c,y[r.OX2]=u-p,y[r.OY2]=g+c,y[r.OX3]=v-p,y[r.OY3]=g+m,y[r.OX4]=v-f,y[r.OY4]=d+m}},{key:"setRegion",value:function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}},{key:"computeWorldVertices",value:function(t,e,a,n){var i=this.offset,s=t.worldX,o=t.worldY,h=t.a,l=t.b,u=t.c,c=t.d,d=0,f=0;d=i[r.OX1],f=i[r.OY1],e[a]=d*h+f*l+s,e[a+1]=d*u+f*c+o,a+=n,d=i[r.OX2],f=i[r.OY2],e[a]=d*h+f*l+s,e[a+1]=d*u+f*c+o,a+=n,d=i[r.OX3],f=i[r.OY3],e[a]=d*h+f*l+s,e[a+1]=d*u+f*c+o,a+=n,d=i[r.OX4],f=i[r.OY4],e[a]=d*h+f*l+s,e[a+1]=d*u+f*c+o}},{key:"copy",value:function(){var t=new r(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,g.arrayCopy(this.uvs,0,t.uvs,0,8),g.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}}]),r}();N.OX1=0,N.OY1=1,N.OX2=2,N.OY2=3,N.OX3=4,N.OY3=5,N.OX4=6,N.OY4=7,N.X1=0,N.Y1=1,N.C1R=2,N.C1G=3,N.C1B=4,N.C1A=5,N.U1=6,N.V1=7,N.X2=8,N.Y2=9,N.C2R=10,N.C2G=11,N.C2B=12,N.C2A=13,N.U2=14,N.V2=15,N.X3=16,N.Y3=17,N.C3R=18,N.C3G=19,N.C3B=20,N.C3A=21,N.U3=22,N.V3=23,N.X4=24,N.Y4=25,N.C4R=26,N.C4G=27,N.C4B=28,N.C4A=29,N.U4=30,N.V4=31;var L,F,O=function(){function t(a){e(this,t),this._image=void 0,this._image=a}return n(t,[{key:"getImage",value:function(){return this._image}}],[{key:"filterFromString",value:function(t){switch(t.toLowerCase()){case"nearest":return L.Nearest;case"linear":return L.Linear;case"mipmap":return L.MipMap;case"mipmapnearestnearest":return L.MipMapNearestNearest;case"mipmaplinearnearest":return L.MipMapLinearNearest;case"mipmapnearestlinear":return L.MipMapNearestLinear;case"mipmaplinearlinear":return L.MipMapLinearLinear;default:throw new Error("Unknown texture filter ".concat(t))}}},{key:"wrapFromString",value:function(t){switch(t.toLowerCase()){case"mirroredtepeat":return F.MirroredRepeat;case"clamptoedge":return F.ClampToEdge;case"repeat":return F.Repeat;default:throw new Error("Unknown texture wrap ".concat(t))}}}]),t}();!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(L||(L={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(F||(F={}));var X,Y,D,B=function t(){e(this,t),this.renderObject=void 0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0},U=function(t){i(r,O);var a=l(r);function r(){return e(this,r),a.apply(this,arguments)}return n(r,[{key:"setFilters",value:function(t,e){}},{key:"setWraps",value:function(t,e){}},{key:"dispose",value:function(){}}]),r}(),q=function(){function t(a,n){e(this,t),this.pages=new Array,this.regions=new Array,this.load(a,n)}return n(t,[{key:"load",value:function(t,e){if(null==e)throw new Error("textureLoader cannot be null.");for(var a=new W(t),n=new Array(4),i=null;;){var r=a.readLine();if(null==r)break;if(0==(r=r.trim()).length)i=null;else if(i){var s=new j;s.name=r,s.page=i;var o=a.readValue();"true"==o.toLocaleLowerCase()?s.degrees=90:"false"==o.toLocaleLowerCase()?s.degrees=0:s.degrees=parseFloat(o),s.rotate=90==s.degrees,a.readTuple(n);var h=parseInt(n[0]),l=parseInt(n[1]);a.readTuple(n);var u=parseInt(n[0]),c=parseInt(n[1]);s.u=h/i.width,s.v=l/i.height,s.rotate?(s.u2=(h+c)/i.width,s.v2=(l+u)/i.height):(s.u2=(h+u)/i.width,s.v2=(l+c)/i.height),s.x=h,s.y=l,s.width=Math.abs(u),s.height=Math.abs(c),4==a.readTuple(n)&&4==a.readTuple(n)&&a.readTuple(n),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),a.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(a.readValue()),s.texture=i.texture,this.regions.push(s)}else{(i=new H).name=r,2==a.readTuple(n)&&(i.width=parseInt(n[0]),i.height=parseInt(n[1]),a.readTuple(n)),a.readTuple(n),i.minFilter=O.filterFromString(n[0]),i.magFilter=O.filterFromString(n[1]);var d=a.readValue();i.uWrap=F.ClampToEdge,i.vWrap=F.ClampToEdge,"x"==d?i.uWrap=F.Repeat:"y"==d?i.vWrap=F.Repeat:"xy"==d&&(i.uWrap=i.vWrap=F.Repeat),i.texture=e(r,i.width,i.height),i.texture.setFilters(i.minFilter,i.magFilter),i.texture.setWraps(i.uWrap,i.vWrap),i.width=i.texture.getImage().width,i.height=i.texture.getImage().height,this.pages.push(i)}}}},{key:"findRegion",value:function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}},{key:"dispose",value:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}]),t}(),W=function(){function t(a){e(this,t),this.lines=void 0,this.index=0,this.lines=a.split(/\r\n|\r|\n/)}return n(t,[{key:"readLine",value:function(){return this.index>=this.lines.length?null:this.lines[this.index++]}},{key:"readValue",value:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}},{key:"readTuple",value:function(t){var e=this.readLine(),a=e.indexOf(":");if(-1==a)throw new Error("Invalid line: "+e);for(var n=0,i=a+1;n<3;n++){var r=e.indexOf(",",i);if(-1==r)break;t[n]=e.substr(i,r-i).trim(),i=r+1}return t[n]=e.substring(i).trim(),n+1}}]),t}(),H=function t(){e(this,t),this.name=void 0,this.minFilter=void 0,this.magFilter=void 0,this.uWrap=void 0,this.vWrap=void 0,this.texture=void 0,this.width=void 0,this.height=void 0},j=function(t){i(n,B);var a=l(n);function n(){var t;e(this,n);for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return(t=a.call.apply(a,[this].concat(r))).page=void 0,t.name=void 0,t.x=void 0,t.y=void 0,t.index=void 0,t.rotate=void 0,t.degrees=void 0,t.texture=void 0,t}return n}(),G=function(t){i(r,C);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).region=void 0,n.path=void 0,n.regionUVs=void 0,n.uvs=void 0,n.triangles=void 0,n.color=new v(1,1,1,1),n.width=void 0,n.height=void 0,n.hullLength=void 0,n.edges=void 0,n.parentMesh=void 0,n.tempColor=new v(0,0,0,0),n}return n(r,[{key:"updateUVs",value:function(){var t=this.regionUVs;null!=this.uvs&&this.uvs.length==t.length||(this.uvs=g.newFloatArray(t.length));var e=this.uvs,a=this.uvs.length,n=this.region.u,i=this.region.v,r=0,s=0;if(this.region instanceof j){var o=this.region,h=o.texture.getImage().width,l=o.texture.getImage().height;switch(o.degrees){case 90:n-=(o.originalHeight-o.offsetY-o.height)/h,i-=(o.originalWidth-o.offsetX-o.width)/l,r=o.originalHeight/h,s=o.originalWidth/l;for(var u=0;u<a;u+=2)e[u]=n+t[u+1]*r,e[u+1]=i+(1-t[u])*s;return;case 180:n-=(o.originalWidth-o.offsetX-o.width)/h,i-=o.offsetY/l,r=o.originalWidth/h,s=o.originalHeight/l;for(var c=0;c<a;c+=2)e[c]=n+(1-t[c])*r,e[c+1]=i+(1-t[c+1])*s;return;case 270:n-=o.offsetY/h,i-=o.offsetX/l,r=o.originalHeight/h,s=o.originalWidth/l;for(var d=0;d<a;d+=2)e[d]=n+(1-t[d+1])*r,e[d+1]=i+t[d]*s;return}n-=o.offsetX/h,i-=(o.originalHeight-o.offsetY-o.height)/l,r=o.originalWidth/h,s=o.originalHeight/l}else null==this.region?(n=i=0,r=s=1):(r=this.region.u2-n,s=this.region.v2-i);for(var f=0;f<a;f+=2)e[f]=n+t[f]*r,e[f+1]=i+t[f+1]*s}},{key:"getParentMesh",value:function(){return this.parentMesh}},{key:"setParentMesh",value:function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},{key:"copy",value:function(){if(null!=this.parentMesh)return this.newLinkedMesh();var t=new r(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),g.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),g.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),g.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,null!=this.edges&&(t.edges=new Array(this.edges.length),g.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}},{key:"newLinkedMesh",value:function(){var t=new r(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t}}]),r}(),Z=function(){function t(a){if(e(this,t),this.data=void 0,this.bones=void 0,this.slots=void 0,this.drawOrder=void 0,this.ikConstraints=void 0,this.transformConstraints=void 0,this.pathConstraints=void 0,this._updateCache=new Array,this.updateCacheReset=new Array,this.skin=void 0,this.color=void 0,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==a)throw new Error("data cannot be null.");this.data=a,this.bones=new Array;for(var n=0;n<a.bones.length;n++){var i=a.bones[n],r=void 0;if(null==i.parent)r=new M(i,this,null);else{var s=this.bones[i.parent.index];r=new M(i,this,s),s.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(var o=0;o<a.slots.length;o++){var h=a.slots[o],l=this.bones[h.boneData.index],u=new S(h,l);this.slots.push(u),this.drawOrder.push(u)}this.ikConstraints=new Array;for(var c=0;c<a.ikConstraints.length;c++){var d=a.ikConstraints[c];this.ikConstraints.push(new T(d,this))}this.transformConstraints=new Array;for(var f=0;f<a.transformConstraints.length;f++){var m=a.transformConstraints[f];this.transformConstraints.push(new R(m,this))}this.pathConstraints=new Array;for(var g=0;g<a.pathConstraints.length;g++){var p=a.pathConstraints[g];this.pathConstraints.push(new _(p,this))}this.color=new v(1,1,1,1),this.updateCache()}return n(t,[{key:"updateCache",value:function(){var t=this._updateCache;t.length=0,this.updateCacheReset.length=0;for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];i.sorted=i.data.skinRequired,i.active=!i.sorted}if(null!=this.skin)for(var r=this.skin.bones,s=0,o=this.skin.bones.length;s<o;s++){var h=this.bones[r[s].index];do{h.sorted=!1,h.active=!0,h=h.parent}while(null!=h)}var l=this.ikConstraints,u=this.transformConstraints,c=this.pathConstraints,d=l.length,f=u.length,v=c.length,m=d+f+v;t:for(var g=0;g<m;g++){for(var p=0;p<d;p++){var y=l[p];if(y.data.order==g){this.sortIkConstraint(y);continue t}}for(var k=0;k<f;k++){var x=u[k];if(x.data.order==g){this.sortTransformConstraint(x);continue t}}for(var w=0;w<v;w++){var E=c[w];if(E.data.order==g){this.sortPathConstraint(E);continue t}}}for(var b=0,M=e.length;b<M;b++)this.sortBone(e[b])}},{key:"sortIkConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var a=t.bones,n=a[0];if(this.sortBone(n),a.length>1){var i=a[a.length-1];this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}this._updateCache.push(t),this.sortReset(n.children),a[a.length-1].sorted=!0}}},{key:"sortPathConstraint",value:function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,a=e.data.index,n=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,a,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,a,n);for(var i=0,r=this.data.skins.length;i<r;i++)this.sortPathConstraintAttachment(this.data.skins[i],a,n);var s=e.getAttachment();s instanceof P&&this.sortPathConstraintAttachmentWith(s,n);for(var o=t.bones,h=o.length,l=0;l<h;l++)this.sortBone(o[l]);this._updateCache.push(t);for(var u=0;u<h;u++)this.sortReset(o[u].children);for(var c=0;c<h;c++)o[c].sorted=!0}}},{key:"sortTransformConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&g.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,a=e.length;if(t.data.local)for(var n=0;n<a;n++){var i=e[n];this.sortBone(i.parent),this._updateCache.indexOf(i)>-1||this.updateCacheReset.push(i)}else for(var r=0;r<a;r++)this.sortBone(e[r]);this._updateCache.push(t);for(var s=0;s<a;s++)this.sortReset(e[s].children);for(var o=0;o<a;o++)e[o].sorted=!0}}},{key:"sortPathConstraintAttachment",value:function(t,e,a){var n=t.attachments[e];if(n)for(var i in n)this.sortPathConstraintAttachmentWith(n[i],a)}},{key:"sortPathConstraintAttachmentWith",value:function(t,e){if(t instanceof P){var a=t.bones;if(null==a)this.sortBone(e);else for(var n=this.bones,i=0;i<a.length;)for(var r=a[i++],s=i+r;i<s;i++){var o=a[i];this.sortBone(n[o])}}}},{key:"sortBone",value:function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}}},{key:"sortReset",value:function(t){for(var e=0,a=t.length;e<a;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}},{key:"updateWorldTransform",value:function(){for(var t=this.updateCacheReset,e=0,a=t.length;e<a;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var i=this._updateCache,r=0,s=i.length;r<s;r++)i[r].update()}},{key:"setToSetupPose",value:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}},{key:"setBonesToSetupPose",value:function(){for(var t=this.bones,e=0,a=t.length;e<a;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,i=0,r=n.length;i<r;i++){var s=n[i];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}for(var o=this.transformConstraints,h=0,l=o.length;h<l;h++){var u=o[h],c=u.data;u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,u.shearMix=c.shearMix}for(var d=this.pathConstraints,f=0,v=d.length;f<v;f++){var m=d[f],g=m.data;m.position=g.position,m.spacing=g.spacing,m.rotateMix=g.rotateMix,m.translateMix=g.translateMix}}},{key:"setSlotsToSetupPose",value:function(){var t=this.slots;g.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,a=t.length;e<a;e++)t[e].setToSetupPose()}},{key:"getRootBone",value:function(){return 0==this.bones.length?null:this.bones[0]}},{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"setSkinByName",value:function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)}},{key:"setSkin",value:function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a],r=i.data.attachmentName;if(null!=r){var s=t.getAttachment(a,r);null!=s&&i.setAttachment(s)}}this.skin=t,this.updateCache()}}},{key:"getAttachmentByName",value:function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}},{key:"getAttachment",value:function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var a=this.skin.getAttachment(t,e);if(null!=a)return a}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}},{key:"setAttachment",value:function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var a=this.slots,n=0,i=a.length;n<i;n++){var r=a[n];if(r.data.name==t){var s=null;if(null!=e&&null==(s=this.getAttachment(n,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(s)}}throw new Error("Slot not found: "+t)}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.data.name==t)return i}return null}},{key:"getBounds",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Array(2);if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");for(var n=this.drawOrder,i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=0,l=n.length;h<l;h++){var u=n[h];if(u.bone.active){var c=0,d=null,f=u.getAttachment();if(f instanceof N)c=8,d=g.setArraySize(a,c,0),f.computeWorldVertices(u.bone,d,0,2);else if(f instanceof G){var v=f;c=v.worldVerticesLength,d=g.setArraySize(a,c,0),v.computeWorldVertices(u,0,c,d,0,2)}if(null!=d)for(var m=0,p=d.length;m<p;m+=2){var y=d[m],k=d[m+1];i=Math.min(i,y),r=Math.min(r,k),s=Math.max(s,y),o=Math.max(o,k)}}}t.set(i,r),e.set(s-i,o-r)}},{key:"update",value:function(t){this.time+=t}}]),t}(),z=function(){function t(a,n,i){if(e(this,t),this.name=void 0,this.timelines=void 0,this.timelineIds=void 0,this.duration=void 0,null==a)throw new Error("name cannot be null.");if(null==n)throw new Error("timelines cannot be null.");this.name=a,this.timelines=n,this.timelineIds=[];for(var r=0;r<n.length;r++)this.timelineIds[n[r].getPropertyId()]=!0;this.duration=i}return n(t,[{key:"hasTimeline",value:function(t){return 1==this.timelineIds[t]}},{key:"apply",value:function(t,e,a,n,i,r,s,o){if(null==t)throw new Error("skeleton cannot be null.");n&&0!=this.duration&&(a%=this.duration,e>0&&(e%=this.duration));for(var h=this.timelines,l=0,u=h.length;l<u;l++)h[l].apply(t,e,a,i,r,s,o)}}],[{key:"binarySearch",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,i=t.length/a-2;if(0==i)return a;for(var r=i>>>1;;){if(t[(r+1)*a]<=e?n=r+1:i=r,n==i)return(n+1)*a;r=n+i>>>1}}},{key:"linearSearch",value:function(t,e,a){for(var n=0,i=t.length-a;n<=i;n+=a)if(t[n]>e)return n;return-1}}]),t}();!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(X||(X={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(Y||(Y={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(D||(D={}));var Q=function(){function t(a){if(e(this,t),this.curves=void 0,a<=0)throw new Error("frameCount must be > 0: "+a);this.curves=g.newFloatArray((a-1)*t.BEZIER_SIZE)}return n(t,[{key:"getFrameCount",value:function(){return this.curves.length/t.BEZIER_SIZE+1}},{key:"setLinear",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.LINEAR}},{key:"setStepped",value:function(e){this.curves[e*t.BEZIER_SIZE]=t.STEPPED}},{key:"getCurveType",value:function(e){var a=e*t.BEZIER_SIZE;if(a==this.curves.length)return t.LINEAR;var n=this.curves[a];return n==t.LINEAR?t.LINEAR:n==t.STEPPED?t.STEPPED:t.BEZIER}},{key:"setCurve",value:function(e,a,n,i,r){var s=.03*(2*-a+i),o=.03*(2*-n+r),h=.006*(3*(a-i)+1),l=.006*(3*(n-r)+1),u=2*s+h,c=2*o+l,d=.3*a+s+.16666667*h,f=.3*n+o+.16666667*l,v=e*t.BEZIER_SIZE,m=this.curves;m[v++]=t.BEZIER;for(var g=d,p=f,y=v+t.BEZIER_SIZE-1;v<y;v+=2)m[v]=g,m[v+1]=p,d+=u,f+=c,u+=h,c+=l,g+=d,p+=f}},{key:"getCurvePercent",value:function(e,a){a=m.clamp(a,0,1);var n=this.curves,i=e*t.BEZIER_SIZE,r=n[i];if(r==t.LINEAR)return a;if(r==t.STEPPED)return 0;for(var s=0,o=++i,h=i+t.BEZIER_SIZE-1;i<h;i+=2)if((s=n[i])>=a){var l=void 0,u=void 0;return i==o?(l=0,u=0):(l=n[i-2],u=n[i-1]),u+(n[i+1]-u)*(a-l)/(s-l)}var c=n[i-1];return c+(1-c)*(a-s)/(1-s)}}]),t}();Q.LINEAR=0,Q.STEPPED=1,Q.BEZIER=2,Q.BEZIER_SIZE=19;var K=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t<<1),n}return n(r,[{key:"getPropertyId",value:function(){return(D.rotate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,a){t<<=1,this.frames[t]=e,this.frames[t+r.ROTATION]=a}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return void(l.rotation=l.data.rotation);case X.first:var u=l.data.rotation-l.rotation;l.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*i}else if(a>=h[h.length-r.ENTRIES]){var c=h[h.length+r.PREV_ROTATION];switch(s){case X.setup:l.rotation=l.data.rotation+c*i;break;case X.first:case X.replace:c+=l.data.rotation-l.rotation,c-=360*(16384-(16384.499999999996-c/360|0));case X.add:l.rotation+=c*i}}else{var d=z.binarySearch(h,a,r.ENTRIES),f=h[d+r.PREV_ROTATION],v=h[d],m=this.getCurvePercent((d>>1)-1,1-(a-v)/(h[d+r.PREV_TIME]-v)),g=h[d+r.ROTATION]-f;switch(g=f+(g-360*(16384-(16384.499999999996-g/360|0)))*m,s){case X.setup:l.rotation=l.data.rotation+(g-360*(16384-(16384.499999999996-g/360|0)))*i;break;case X.first:case X.replace:g+=l.data.rotation-l.rotation;case X.add:l.rotation+=(g-360*(16384-(16384.499999999996-g/360|0)))*i}}}}]),r}();K.ENTRIES=2,K.PREV_TIME=-2,K.PREV_ROTATION=-1,K.ROTATION=1;var J=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).boneIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.translate<<24)+this.boneIndex}},{key:"setFrame",value:function(t,e,a,n){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.X]=a,this.frames[t+r.Y]=n}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return l.x=l.data.x,void(l.y=l.data.y);case X.first:l.x+=(l.data.x-l.x)*i,l.y+=(l.data.y-l.y)*i}else{var u=0,c=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_X],c=h[h.length+r.PREV_Y];else{var d=z.binarySearch(h,a,r.ENTRIES);u=h[d+r.PREV_X],c=h[d+r.PREV_Y];var f=h[d],v=this.getCurvePercent(d/r.ENTRIES-1,1-(a-f)/(h[d+r.PREV_TIME]-f));u+=(h[d+r.X]-u)*v,c+=(h[d+r.Y]-c)*v}switch(s){case X.setup:l.x=l.data.x+u*i,l.y=l.data.y+c*i;break;case X.first:case X.replace:l.x+=(l.data.x+u-l.x)*i,l.y+=(l.data.y+c-l.y)*i;break;case X.add:l.x+=u*i,l.y+=c*i}}}}]),r}();J.ENTRIES=3,J.PREV_TIME=-3,J.PREV_X=-2,J.PREV_Y=-1,J.X=1,J.Y=2;var $=function(t){i(r,J);var a=l(r);function r(t){return e(this,r),a.call(this,t)}return n(r,[{key:"getPropertyId",value:function(){return(D.scale<<24)+this.boneIndex}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return l.scaleX=l.data.scaleX,void(l.scaleY=l.data.scaleY);case X.first:l.scaleX+=(l.data.scaleX-l.scaleX)*i,l.scaleY+=(l.data.scaleY-l.scaleY)*i}else{var u=0,c=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_X]*l.data.scaleX,c=h[h.length+r.PREV_Y]*l.data.scaleY;else{var d=z.binarySearch(h,a,r.ENTRIES);u=h[d+r.PREV_X],c=h[d+r.PREV_Y];var f=h[d],v=this.getCurvePercent(d/r.ENTRIES-1,1-(a-f)/(h[d+r.PREV_TIME]-f));u=(u+(h[d+r.X]-u)*v)*l.data.scaleX,c=(c+(h[d+r.Y]-c)*v)*l.data.scaleY}if(1==i)s==X.add?(l.scaleX+=u-l.data.scaleX,l.scaleY+=c-l.data.scaleY):(l.scaleX=u,l.scaleY=c);else{var g=0,p=0;if(o==Y.mixOut)switch(s){case X.setup:g=l.data.scaleX,p=l.data.scaleY,l.scaleX=g+(Math.abs(u)*m.signum(g)-g)*i,l.scaleY=p+(Math.abs(c)*m.signum(p)-p)*i;break;case X.first:case X.replace:g=l.scaleX,p=l.scaleY,l.scaleX=g+(Math.abs(u)*m.signum(g)-g)*i,l.scaleY=p+(Math.abs(c)*m.signum(p)-p)*i;break;case X.add:g=l.scaleX,p=l.scaleY,l.scaleX=g+(Math.abs(u)*m.signum(g)-l.data.scaleX)*i,l.scaleY=p+(Math.abs(c)*m.signum(p)-l.data.scaleY)*i}else switch(s){case X.setup:g=Math.abs(l.data.scaleX)*m.signum(u),p=Math.abs(l.data.scaleY)*m.signum(c),l.scaleX=g+(u-g)*i,l.scaleY=p+(c-p)*i;break;case X.first:case X.replace:g=Math.abs(l.scaleX)*m.signum(u),p=Math.abs(l.scaleY)*m.signum(c),l.scaleX=g+(u-g)*i,l.scaleY=p+(c-p)*i;break;case X.add:g=m.signum(u),p=m.signum(c),l.scaleX=Math.abs(l.scaleX)*g+(u-Math.abs(l.data.scaleX)*g)*i,l.scaleY=Math.abs(l.scaleY)*p+(c-Math.abs(l.data.scaleY)*p)*i}}}}}]),r}(),tt=function(t){i(r,J);var a=l(r);function r(t){return e(this,r),a.call(this,t)}return n(r,[{key:"getPropertyId",value:function(){return(D.shear<<24)+this.boneIndex}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.bones[this.boneIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return l.shearX=l.data.shearX,void(l.shearY=l.data.shearY);case X.first:l.shearX+=(l.data.shearX-l.shearX)*i,l.shearY+=(l.data.shearY-l.shearY)*i}else{var u=0,c=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_X],c=h[h.length+r.PREV_Y];else{var d=z.binarySearch(h,a,r.ENTRIES);u=h[d+r.PREV_X],c=h[d+r.PREV_Y];var f=h[d],v=this.getCurvePercent(d/r.ENTRIES-1,1-(a-f)/(h[d+r.PREV_TIME]-f));u+=(h[d+r.X]-u)*v,c+=(h[d+r.Y]-c)*v}switch(s){case X.setup:l.shearX=l.data.shearX+u*i,l.shearY=l.data.shearY+c*i;break;case X.first:case X.replace:l.shearX+=(l.data.shearX+u-l.shearX)*i,l.shearY+=(l.data.shearY+c-l.shearY)*i;break;case X.add:l.shearX+=u*i,l.shearY+=c*i}}}}]),r}(),et=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.color<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,a,n,i,s){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.R]=a,this.frames[t+r.G]=n,this.frames[t+r.B]=i,this.frames[t+r.A]=s}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=t.slots[this.slotIndex];if(h.bone.active){var l=this.frames;if(a<l[0])switch(s){case X.setup:return void h.color.setFromColor(h.data.color);case X.first:var u=h.color,c=h.data.color;u.add((c.r-u.r)*i,(c.g-u.g)*i,(c.b-u.b)*i,(c.a-u.a)*i)}else{var d=0,f=0,v=0,m=0;if(a>=l[l.length-r.ENTRIES]){var g=l.length;d=l[g+r.PREV_R],f=l[g+r.PREV_G],v=l[g+r.PREV_B],m=l[g+r.PREV_A]}else{var p=z.binarySearch(l,a,r.ENTRIES);d=l[p+r.PREV_R],f=l[p+r.PREV_G],v=l[p+r.PREV_B],m=l[p+r.PREV_A];var y=l[p],k=this.getCurvePercent(p/r.ENTRIES-1,1-(a-y)/(l[p+r.PREV_TIME]-y));d+=(l[p+r.R]-d)*k,f+=(l[p+r.G]-f)*k,v+=(l[p+r.B]-v)*k,m+=(l[p+r.A]-m)*k}if(1==i)h.color.set(d,f,v,m);else{var x=h.color;s==X.setup&&x.setFromColor(h.data.color),x.add((d-x.r)*i,(f-x.g)*i,(v-x.b)*i,(m-x.a)*i)}}}}}]),r}();et.ENTRIES=5,et.PREV_TIME=-5,et.PREV_R=-4,et.PREV_G=-3,et.PREV_B=-2,et.PREV_A=-1,et.R=1,et.G=2,et.B=3,et.A=4;var at=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).slotIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.twoColor<<24)+this.slotIndex}},{key:"setFrame",value:function(t,e,a,n,i,s,o,h,l){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.R]=a,this.frames[t+r.G]=n,this.frames[t+r.B]=i,this.frames[t+r.A]=s,this.frames[t+r.R2]=o,this.frames[t+r.G2]=h,this.frames[t+r.B2]=l}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=t.slots[this.slotIndex];if(h.bone.active){var l=this.frames;if(a<l[0])switch(s){case X.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case X.first:var u=h.color,c=h.darkColor,d=h.data.color,f=h.data.darkColor;u.add((d.r-u.r)*i,(d.g-u.g)*i,(d.b-u.b)*i,(d.a-u.a)*i),c.add((f.r-c.r)*i,(f.g-c.g)*i,(f.b-c.b)*i,0)}else{var v=0,m=0,g=0,p=0,y=0,k=0,x=0;if(a>=l[l.length-r.ENTRIES]){var w=l.length;v=l[w+r.PREV_R],m=l[w+r.PREV_G],g=l[w+r.PREV_B],p=l[w+r.PREV_A],y=l[w+r.PREV_R2],k=l[w+r.PREV_G2],x=l[w+r.PREV_B2]}else{var E=z.binarySearch(l,a,r.ENTRIES);v=l[E+r.PREV_R],m=l[E+r.PREV_G],g=l[E+r.PREV_B],p=l[E+r.PREV_A],y=l[E+r.PREV_R2],k=l[E+r.PREV_G2],x=l[E+r.PREV_B2];var b=l[E],M=this.getCurvePercent(E/r.ENTRIES-1,1-(a-b)/(l[E+r.PREV_TIME]-b));v+=(l[E+r.R]-v)*M,m+=(l[E+r.G]-m)*M,g+=(l[E+r.B]-g)*M,p+=(l[E+r.A]-p)*M,y+=(l[E+r.R2]-y)*M,k+=(l[E+r.G2]-k)*M,x+=(l[E+r.B2]-x)*M}if(1==i)h.color.set(v,m,g,p),h.darkColor.set(y,k,x,1);else{var S=h.color,T=h.darkColor;s==X.setup&&(S.setFromColor(h.data.color),T.setFromColor(h.data.darkColor)),S.add((v-S.r)*i,(m-S.g)*i,(g-S.b)*i,(p-S.a)*i),T.add((y-T.r)*i,(k-T.g)*i,(x-T.b)*i,0)}}}}}]),r}();at.ENTRIES=8,at.PREV_TIME=-8,at.PREV_R=-7,at.PREV_G=-6,at.PREV_B=-5,at.PREV_A=-4,at.PREV_R2=-3,at.PREV_G2=-2,at.PREV_B2=-1,at.R=1,at.G=2,at.B=3,at.A=4,at.R2=5,at.G2=6,at.B2=7;var nt=function(){function t(a){e(this,t),this.slotIndex=void 0,this.frames=void 0,this.attachmentNames=void 0,this.frames=g.newFloatArray(a),this.attachmentNames=new Array(a)}return n(t,[{key:"getPropertyId",value:function(){return(D.attachment<<24)+this.slotIndex}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.attachmentNames[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.slots[this.slotIndex];if(o.bone.active)if(s!=Y.mixOut){var h=this.frames;if(a<h[0])r!=X.setup&&r!=X.first||this.setAttachment(t,o,o.data.attachmentName);else{var l=0;l=a>=h[h.length-1]?h.length-1:z.binarySearch(h,a,1)-1;var u=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(null==u?null:t.getAttachment(this.slotIndex,u))}}else r==X.setup&&this.setAttachment(t,o,o.data.attachmentName)}},{key:"setAttachment",value:function(t,e,a){e.attachment=null==a?null:t.getAttachment(this.slotIndex,a)}}]),t}(),it=null,rt=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).slotIndex=void 0,n.attachment=void 0,n.frames=void 0,n.frameVertices=void 0,n.frames=g.newFloatArray(t),n.frameVertices=new Array(t),null==it&&(it=g.newFloatArray(64)),n}return n(r,[{key:"getPropertyId",value:function(){return(D.deform<<27)+ +this.attachment.id+this.slotIndex}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.frameVertices[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.slots[this.slotIndex];if(o.bone.active){var h=o.getAttachment();if(h instanceof C&&h.deformAttachment==this.attachment){var l=o.deform;0==l.length&&(r=X.setup);var u=this.frameVertices,c=u[0].length,d=this.frames;if(a<d[0]){var f=h;switch(r){case X.setup:return void(l.length=0);case X.first:if(1==i){l.length=0;break}var v=g.setArraySize(l,c);if(null==f.bones)for(var m=f.vertices,p=0;p<c;p++)v[p]+=(m[p]-v[p])*i;else{i=1-i;for(p=0;p<c;p++)v[p]*=i}}}else{var y=g.setArraySize(l,c);if(a>=d[d.length-1]){var k=u[d.length-1];if(1==i)if(r==X.add){var x=h;if(null==x.bones)for(var w=x.vertices,E=0;E<c;E++)y[E]+=k[E]-w[E];else for(var b=0;b<c;b++)y[b]+=k[b]}else g.arrayCopy(k,0,y,0,c);else switch(r){case X.setup:var M=h;if(null==M.bones)for(var S=M.vertices,T=0;T<c;T++){var R=S[T];y[T]=R+(k[T]-R)*i}else for(var A=0;A<c;A++)y[A]=k[A]*i;break;case X.first:case X.replace:for(var I=0;I<c;I++)y[I]+=(k[I]-y[I])*i;break;case X.add:var V=h;if(null==V.bones)for(var P=V.vertices,_=0;_<c;_++)y[_]+=(k[_]-P[_])*i;else for(var N=0;N<c;N++)y[N]+=k[N]*i}}else{var L=z.binarySearch(d,a),F=u[L-1],O=u[L],Y=d[L],D=this.getCurvePercent(L-1,1-(a-Y)/(d[L-1]-Y));if(1==i)if(r==X.add){var B=h;if(null==B.bones)for(var U=B.vertices,q=0;q<c;q++){var W=F[q];y[q]+=W+(O[q]-W)*D-U[q]}else for(var H=0;H<c;H++){var j=F[H];y[H]+=j+(O[H]-j)*D}}else for(var G=0;G<c;G++){var Z=F[G];y[G]=Z+(O[G]-Z)*D}else switch(r){case X.setup:var Q=h;if(null==Q.bones)for(var K=Q.vertices,J=0;J<c;J++){var $=F[J],tt=K[J];y[J]=tt+($+(O[J]-$)*D-tt)*i}else for(var et=0;et<c;et++){var at=F[et];y[et]=(at+(O[et]-at)*D)*i}break;case X.first:case X.replace:for(var nt=0;nt<c;nt++){var it=F[nt];y[nt]+=(it+(O[nt]-it)*D-y[nt])*i}break;case X.add:var rt=h;if(null==rt.bones)for(var st=rt.vertices,ot=0;ot<c;ot++){var ht=F[ot];y[ot]+=(ht+(O[ot]-ht)*D-st[ot])*i}else for(var lt=0;lt<c;lt++){var ut=F[lt];y[lt]+=(ut+(O[lt]-ut)*D)*i}}}}}}}}]),r}(),st=function(){function t(a){e(this,t),this.frames=void 0,this.events=void 0,this.frames=g.newFloatArray(a),this.events=new Array(a)}return n(t,[{key:"getPropertyId",value:function(){return D.event<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e){this.frames[t]=e.time,this.events[t]=e}},{key:"apply",value:function(t,e,a,n,i,r,s){if(null!=n){var o=this.frames,h=this.frames.length;if(e>a)this.apply(t,e,Number.MAX_VALUE,n,i,r,s),e=-1;else if(e>=o[h-1])return;if(!(a<o[0])){var l=0;if(e<o[0])l=0;else for(var u=o[l=z.binarySearch(o,e)];l>0&&o[l-1]==u;)l--;for(;l<h&&a>=o[l];l++)n.push(this.events[l])}}}}]),t}(),ot=function(){function t(a){e(this,t),this.frames=void 0,this.drawOrders=void 0,this.frames=g.newFloatArray(a),this.drawOrders=new Array(a)}return n(t,[{key:"getPropertyId",value:function(){return D.drawOrder<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.drawOrders[t]=a}},{key:"apply",value:function(t,e,a,n,i,r,s){var o=t.drawOrder,h=t.slots;if(s!=Y.mixOut){var l=this.frames;if(a<l[0])r!=X.setup&&r!=X.first||g.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var u=0;u=a>=l[l.length-1]?l.length-1:z.binarySearch(l,a)-1;var c=this.drawOrders[u];if(null==c)g.arrayCopy(h,0,o,0,h.length);else for(var d=0,f=c.length;d<f;d++)o[d]=h[c[d]]}}else r==X.setup&&g.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}]),t}(),ht=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).ikConstraintIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.ikConstraint<<24)+this.ikConstraintIndex}},{key:"setFrame",value:function(t,e,a,n,i,s,o){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.MIX]=a,this.frames[t+r.SOFTNESS]=n,this.frames[t+r.BEND_DIRECTION]=i,this.frames[t+r.COMPRESS]=s?1:0,this.frames[t+r.STRETCH]=o?1:0}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case X.first:l.mix+=(l.data.mix-l.mix)*i,l.softness+=(l.data.softness-l.softness)*i,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}else if(a>=h[h.length-r.ENTRIES])s==X.setup?(l.mix=l.data.mix+(h[h.length+r.PREV_MIX]-l.data.mix)*i,l.softness=l.data.softness+(h[h.length+r.PREV_SOFTNESS]-l.data.softness)*i,o==Y.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=h[h.length+r.PREV_BEND_DIRECTION],l.compress=0!=h[h.length+r.PREV_COMPRESS],l.stretch=0!=h[h.length+r.PREV_STRETCH])):(l.mix+=(h[h.length+r.PREV_MIX]-l.mix)*i,l.softness+=(h[h.length+r.PREV_SOFTNESS]-l.softness)*i,o==Y.mixIn&&(l.bendDirection=h[h.length+r.PREV_BEND_DIRECTION],l.compress=0!=h[h.length+r.PREV_COMPRESS],l.stretch=0!=h[h.length+r.PREV_STRETCH]));else{var u=z.binarySearch(h,a,r.ENTRIES),c=h[u+r.PREV_MIX],d=h[u+r.PREV_SOFTNESS],f=h[u],v=this.getCurvePercent(u/r.ENTRIES-1,1-(a-f)/(h[u+r.PREV_TIME]-f));s==X.setup?(l.mix=l.data.mix+(c+(h[u+r.MIX]-c)*v-l.data.mix)*i,l.softness=l.data.softness+(d+(h[u+r.SOFTNESS]-d)*v-l.data.softness)*i,o==Y.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=h[u+r.PREV_BEND_DIRECTION],l.compress=0!=h[u+r.PREV_COMPRESS],l.stretch=0!=h[u+r.PREV_STRETCH])):(l.mix+=(c+(h[u+r.MIX]-c)*v-l.mix)*i,l.softness+=(d+(h[u+r.SOFTNESS]-d)*v-l.softness)*i,o==Y.mixIn&&(l.bendDirection=h[u+r.PREV_BEND_DIRECTION],l.compress=0!=h[u+r.PREV_COMPRESS],l.stretch=0!=h[u+r.PREV_STRETCH]))}}}]),r}();ht.ENTRIES=6,ht.PREV_TIME=-6,ht.PREV_MIX=-5,ht.PREV_SOFTNESS=-4,ht.PREV_BEND_DIRECTION=-3,ht.PREV_COMPRESS=-2,ht.PREV_STRETCH=-1,ht.MIX=1,ht.SOFTNESS=2,ht.BEND_DIRECTION=3,ht.COMPRESS=4,ht.STRETCH=5;var lt=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).transformConstraintIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.transformConstraint<<24)+this.transformConstraintIndex}},{key:"setFrame",value:function(t,e,a,n,i,s){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.ROTATE]=a,this.frames[t+r.TRANSLATE]=n,this.frames[t+r.SCALE]=i,this.frames[t+r.SHEAR]=s}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(l.active)if(a<h[0]){var u=l.data;switch(s){case X.setup:return l.rotateMix=u.rotateMix,l.translateMix=u.translateMix,l.scaleMix=u.scaleMix,void(l.shearMix=u.shearMix);case X.first:l.rotateMix+=(u.rotateMix-l.rotateMix)*i,l.translateMix+=(u.translateMix-l.translateMix)*i,l.scaleMix+=(u.scaleMix-l.scaleMix)*i,l.shearMix+=(u.shearMix-l.shearMix)*i}}else{var c=0,d=0,f=0,v=0;if(a>=h[h.length-r.ENTRIES]){var m=h.length;c=h[m+r.PREV_ROTATE],d=h[m+r.PREV_TRANSLATE],f=h[m+r.PREV_SCALE],v=h[m+r.PREV_SHEAR]}else{var g=z.binarySearch(h,a,r.ENTRIES);c=h[g+r.PREV_ROTATE],d=h[g+r.PREV_TRANSLATE],f=h[g+r.PREV_SCALE],v=h[g+r.PREV_SHEAR];var p=h[g],y=this.getCurvePercent(g/r.ENTRIES-1,1-(a-p)/(h[g+r.PREV_TIME]-p));c+=(h[g+r.ROTATE]-c)*y,d+=(h[g+r.TRANSLATE]-d)*y,f+=(h[g+r.SCALE]-f)*y,v+=(h[g+r.SHEAR]-v)*y}if(s==X.setup){var k=l.data;l.rotateMix=k.rotateMix+(c-k.rotateMix)*i,l.translateMix=k.translateMix+(d-k.translateMix)*i,l.scaleMix=k.scaleMix+(f-k.scaleMix)*i,l.shearMix=k.shearMix+(v-k.shearMix)*i}else l.rotateMix+=(c-l.rotateMix)*i,l.translateMix+=(d-l.translateMix)*i,l.scaleMix+=(f-l.scaleMix)*i,l.shearMix+=(v-l.shearMix)*i}}}]),r}();lt.ENTRIES=5,lt.PREV_TIME=-5,lt.PREV_ROTATE=-4,lt.PREV_TRANSLATE=-3,lt.PREV_SCALE=-2,lt.PREV_SHEAR=-1,lt.ROTATE=1,lt.TRANSLATE=2,lt.SCALE=3,lt.SHEAR=4;var ut=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.pathConstraintPosition<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,a){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.VALUE]=a}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return void(l.position=l.data.position);case X.first:l.position+=(l.data.position-l.position)*i}else{var u=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_VALUE];else{var c=z.binarySearch(h,a,r.ENTRIES);u=h[c+r.PREV_VALUE];var d=h[c],f=this.getCurvePercent(c/r.ENTRIES-1,1-(a-d)/(h[c+r.PREV_TIME]-d));u+=(h[c+r.VALUE]-u)*f}s==X.setup?l.position=l.data.position+(u-l.data.position)*i:l.position+=(u-l.position)*i}}}]),r}();ut.ENTRIES=2,ut.PREV_TIME=-2,ut.PREV_VALUE=-1,ut.VALUE=1;var ct=function(t){i(r,ut);var a=l(r);function r(t){return e(this,r),a.call(this,t)}return n(r,[{key:"getPropertyId",value:function(){return(D.pathConstraintSpacing<<24)+this.pathConstraintIndex}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return void(l.spacing=l.data.spacing);case X.first:l.spacing+=(l.data.spacing-l.spacing)*i}else{var u=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_VALUE];else{var c=z.binarySearch(h,a,r.ENTRIES);u=h[c+r.PREV_VALUE];var d=h[c],f=this.getCurvePercent(c/r.ENTRIES-1,1-(a-d)/(h[c+r.PREV_TIME]-d));u+=(h[c+r.VALUE]-u)*f}s==X.setup?l.spacing=l.data.spacing+(u-l.data.spacing)*i:l.spacing+=(u-l.spacing)*i}}}]),r}(),dt=function(t){i(r,Q);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=g.newFloatArray(t*r.ENTRIES),n}return n(r,[{key:"getPropertyId",value:function(){return(D.pathConstraintMix<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(t,e,a,n){t*=r.ENTRIES,this.frames[t]=e,this.frames[t+r.ROTATE]=a,this.frames[t+r.TRANSLATE]=n}},{key:"apply",value:function(t,e,a,n,i,s,o){var h=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(l.active)if(a<h[0])switch(s){case X.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case X.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*i,l.translateMix+=(l.data.translateMix-l.translateMix)*i}else{var u=0,c=0;if(a>=h[h.length-r.ENTRIES])u=h[h.length+r.PREV_ROTATE],c=h[h.length+r.PREV_TRANSLATE];else{var d=z.binarySearch(h,a,r.ENTRIES);u=h[d+r.PREV_ROTATE],c=h[d+r.PREV_TRANSLATE];var f=h[d],v=this.getCurvePercent(d/r.ENTRIES-1,1-(a-f)/(h[d+r.PREV_TIME]-f));u+=(h[d+r.ROTATE]-u)*v,c+=(h[d+r.TRANSLATE]-c)*v}s==X.setup?(l.rotateMix=l.data.rotateMix+(u-l.data.rotateMix)*i,l.translateMix=l.data.translateMix+(c-l.data.translateMix)*i):(l.rotateMix+=(u-l.rotateMix)*i,l.translateMix+=(c-l.translateMix)*i)}}}]),r}();dt.ENTRIES=3,dt.PREV_TIME=-3,dt.PREV_ROTATE=-2,dt.PREV_TRANSLATE=-1,dt.ROTATE=1,dt.TRANSLATE=2;var ft=function(){function t(a){e(this,t),this.data=void 0,this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new gt(this),this.propertyIDs=new f,this.animationsChanged=!1,this.trackEntryPool=new y((function(){return new mt})),this.data=a}return n(t,[{key:"update",value:function(t){t*=this.timeScale;for(var e=this.tracks,a=0,n=e.length;a<n;a++){var i=e[a];if(null!=i){i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast;var r=t*i.timeScale;if(i.delay>0){if(i.delay-=r,i.delay>0)continue;r=-i.delay,i.delay=0}var s=i.next;if(null!=s){var o=i.trackLast-s.delay;if(o>=0){for(s.delay=0,s.trackTime+=0==i.timeScale?0:(o/i.timeScale+t)*s.timeScale,i.trackTime+=r,this.setCurrent(a,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(i.trackLast>=i.trackEnd&&null==i.mixingFrom){e[a]=null,this.queue.end(i),this.disposeNext(i);continue}if(null!=i.mixingFrom&&this.updateMixingFrom(i,t)){var h=i.mixingFrom;for(i.mixingFrom=null,null!=h&&(h.mixingTo=null);null!=h;)this.queue.end(h),h=h.mixingFrom}i.trackTime+=r}}this.queue.drain()}},{key:"updateMixingFrom",value:function(t,e){var a=t.mixingFrom;if(null==a)return!0;var n=this.updateMixingFrom(a,e);return a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=a.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=a.mixingFrom,null!=a.mixingFrom&&(a.mixingFrom.mixingTo=t),t.interruptAlpha=a.interruptAlpha,this.queue.end(a)),n):(a.trackTime+=e*a.timeScale,t.mixTime+=e,!1)}},{key:"apply",value:function(e){if(null==e)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var a=this.events,n=this.tracks,i=!1,r=0,s=n.length;r<s;r++){var o=n[r];if(!(null==o||o.delay>0)){i=!0;var h=0==r?X.first:o.mixBlend,l=o.alpha;null!=o.mixingFrom?l*=this.applyMixingFrom(o,e,h):o.trackTime>=o.trackEnd&&null==o.next&&(l=0);var u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,f=o.animation.timelines;if(0==r&&1==l||h==X.add)for(var v=0;v<d;v++){g.webkit602BugfixHelper(l,h);var m=f[v];m instanceof nt?this.applyAttachmentTimeline(m,e,c,h,!0):m.apply(e,u,c,a,l,h,Y.mixIn)}else{var p=o.timelineMode,y=0==o.timelinesRotation.length;y&&g.setArraySize(o.timelinesRotation,d<<1,null);for(var k=o.timelinesRotation,x=0;x<d;x++){var w=f[x],E=p[x]==t.SUBSEQUENT?h:X.setup;w instanceof K?this.applyRotateTimeline(w,e,c,l,E,k,x<<1,y):w instanceof nt?this.applyAttachmentTimeline(w,e,c,h,!0):(g.webkit602BugfixHelper(l,h),w.apply(e,u,c,a,l,E,Y.mixIn))}}this.queueEvents(o,c),a.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime}}for(var b=this.unkeyedState+t.SETUP,M=e.slots,S=0,T=e.slots.length;S<T;S++){var R=M[S];if(R.attachmentState==b){var A=R.data.attachmentName;R.attachment=null==A?null:e.getAttachment(R.data.index,A)}}return this.unkeyedState+=2,this.queue.drain(),i}},{key:"applyMixingFrom",value:function(e,a,n){var i=e.mixingFrom;null!=i.mixingFrom&&this.applyMixingFrom(i,a,n);var r=0;0==e.mixDuration?(r=1,n==X.first&&(n=X.setup)):((r=e.mixTime/e.mixDuration)>1&&(r=1),n!=X.first&&(n=i.mixBlend));var s=r<i.eventThreshold?this.events:null,o=r<i.attachmentThreshold,h=r<i.drawOrderThreshold,l=i.animationLast,u=i.getAnimationTime(),c=i.animation.timelines.length,d=i.animation.timelines,f=i.alpha*e.interruptAlpha,v=f*(1-r);if(n==X.add)for(var m=0;m<c;m++)d[m].apply(a,l,u,s,v,n,Y.mixOut);else{var p=i.timelineMode,y=i.timelineHoldMix,k=0==i.timelinesRotation.length;k&&g.setArraySize(i.timelinesRotation,c<<1,null);var x=i.timelinesRotation;i.totalAlpha=0;for(var w=0;w<c;w++){var E=d[w],b=Y.mixOut,M=void 0,S=0;switch(p[w]){case t.SUBSEQUENT:if(!h&&E instanceof ot)continue;M=n,S=v;break;case t.FIRST:M=X.setup,S=v;break;case t.HOLD_SUBSEQUENT:M=n,S=f;break;case t.HOLD_FIRST:M=X.setup,S=f;break;default:M=X.setup;var T=y[w];S=f*Math.max(0,1-T.mixTime/T.mixDuration)}i.totalAlpha+=S,E instanceof K?this.applyRotateTimeline(E,a,u,S,M,x,w<<1,k):E instanceof nt?this.applyAttachmentTimeline(E,a,u,M,o):(g.webkit602BugfixHelper(S,n),h&&E instanceof ot&&M==X.setup&&(b=Y.mixIn),E.apply(a,l,u,s,S,M,b))}}return e.mixDuration>0&&this.queueEvents(i,u),this.events.length=0,i.nextAnimationLast=u,i.nextTrackLast=i.trackTime,r}},{key:"applyAttachmentTimeline",value:function(e,a,n,i,r){var s=a.slots[e.slotIndex];if(s.bone.active){var o,h=e.frames;if(n<h[0])i!=X.setup&&i!=X.first||this.setAttachment(a,s,s.data.attachmentName,r);else o=n>=h[h.length-1]?h.length-1:z.binarySearch(h,n)-1,this.setAttachment(a,s,e.attachmentNames[o],r);s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+t.SETUP)}}},{key:"setAttachment",value:function(e,a,n,i){a.attachment=null==n?null:e.getAttachment(a.data.index,n),i&&(a.attachmentState=this.unkeyedState+t.CURRENT)}},{key:"applyRotateTimeline",value:function(t,e,a,n,i,r,s,o){if(o&&(r[s]=0),1!=n){var h=t,l=h.frames,u=e.bones[h.boneIndex];if(u.active){var c=0,d=0;if(a<l[0])switch(i){case X.setup:u.rotation=u.data.rotation;default:return;case X.first:c=u.rotation,d=u.data.rotation}else if(c=i==X.setup?u.data.rotation:u.rotation,a>=l[l.length-K.ENTRIES])d=u.data.rotation+l[l.length+K.PREV_ROTATION];else{var f=z.binarySearch(l,a,K.ENTRIES),v=l[f+K.PREV_ROTATION],g=l[f],p=h.getCurvePercent((f>>1)-1,1-(a-g)/(l[f+K.PREV_TIME]-g));d=l[f+K.ROTATION]-v,d=v+(d-=360*(16384-(16384.499999999996-d/360|0)))*p+u.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var y=0,k=d-c;if(0==(k-=360*(16384-(16384.499999999996-k/360|0))))y=r[s];else{var x=0,w=0;o?(x=0,w=k):(x=r[s],w=r[s+1]);var E=k>0,b=x>=0;m.signum(w)!=m.signum(k)&&Math.abs(w)<=90&&(Math.abs(x)>180&&(x+=360*m.signum(x)),b=E),y=k+x-x%360,b!=E&&(y+=360*m.signum(x)),r[s]=y}r[s+1]=k,c+=y*n,u.rotation=c-360*(16384-(16384.499999999996-c/360|0))}}else t.apply(e,0,a,null,1,i,Y.mixIn)}},{key:"queueEvents",value:function(t,e){for(var a=t.animationStart,n=t.animationEnd,i=n-a,r=t.trackLast%i,s=this.events,o=0,h=s.length;o<h;o++){var l=s[o];if(l.time<r)break;l.time>n||this.queue.event(t,l)}for((t.loop?0==i||r>t.trackTime%i:e>=n&&t.animationLast<n)&&this.queue.complete(t);o<h;o++){s[o].time<a||this.queue.event(t,s[o])}}},{key:"clearTracks",value:function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,a=this.tracks.length;e<a;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}},{key:"clearTrack",value:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var a=e;;){var n=a.mixingFrom;if(null==n)break;this.queue.end(n),a.mixingFrom=null,a.mixingTo=null,a=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}}},{key:"setCurrent",value:function(t,e,a){var n=this.expandToIndex(t);this.tracks[t]=e,null!=n&&(a&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,null!=n.mixingFrom&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}},{key:"setAnimation",value:function(t,e,a){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,a)}},{key:"setAnimationWith",value:function(t,e,a){if(null==e)throw new Error("animation cannot be null.");var n=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,n=!1):this.disposeNext(i));var r=this.trackEntry(t,e,a,i);return this.setCurrent(t,r,n),this.queue.drain(),r}},{key:"addAnimation",value:function(t,e,a,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,i,a,n)}},{key:"addAnimationWith",value:function(t,e,a,n){if(null==e)throw new Error("animation cannot be null.");var i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;var r=this.trackEntry(t,e,a,i);if(null==i)this.setCurrent(t,r,!0),this.queue.drain();else if(i.next=r,n<=0){var s=i.animationEnd-i.animationStart;0!=s?(i.loop?n+=s*(1+(i.trackTime/s|0)):n+=Math.max(s,i.trackTime),n-=this.data.getMix(i.animation,e)):n=i.trackTime}return r.delay=n,r}},{key:"setEmptyAnimation",value:function(e,a){var n=this.setAnimationWith(e,t.emptyAnimation,!1);return n.mixDuration=a,n.trackEnd=a,n}},{key:"addEmptyAnimation",value:function(e,a,n){n<=0&&(n-=a);var i=this.addAnimationWith(e,t.emptyAnimation,!1,n);return i.mixDuration=a,i.trackEnd=a,i}},{key:"setEmptyAnimations",value:function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var a=0,n=this.tracks.length;a<n;a++){var i=this.tracks[a];null!=i&&this.setEmptyAnimation(i.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}},{key:"expandToIndex",value:function(t){return t<this.tracks.length?this.tracks[t]:(g.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}},{key:"trackEntry",value:function(t,e,a,n){var i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=a,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==n?0:this.data.getMix(n.animation,e),i.mixBlend=X.replace,i}},{key:"disposeNext",value:function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}},{key:"_animationsChanged",value:function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var a=this.tracks[t];if(null!=a){for(;null!=a.mixingFrom;)a=a.mixingFrom;do{null!=a.mixingFrom&&a.mixBlend==X.add||this.computeHold(a),a=a.mixingTo}while(null!=a)}}}},{key:"computeHold",value:function(e){var a=e.mixingTo,n=e.animation.timelines,i=e.animation.timelines.length,r=g.setArraySize(e.timelineMode,i);e.timelineHoldMix.length=0;var s=g.setArraySize(e.timelineHoldMix,i),o=this.propertyIDs;if(null!=a&&a.holdPrevious)for(var h=0;h<i;h++)r[h]=o.add(n[h].getPropertyId())?t.HOLD_FIRST:t.HOLD_SUBSEQUENT;else t:for(var l=0;l<i;l++){var u=n[l],c=u.getPropertyId();if(o.add(c))if(null==a||u instanceof nt||u instanceof ot||u instanceof st||!a.animation.hasTimeline(c))r[l]=t.FIRST;else{for(var d=a.mixingTo;null!=d;d=d.mixingTo)if(!d.animation.hasTimeline(c)){if(e.mixDuration>0){r[l]=t.HOLD_MIX,s[l]=d;continue t}break}r[l]=t.HOLD_FIRST}else r[l]=t.SUBSEQUENT}}},{key:"getCurrent",value:function(t){return t>=this.tracks.length?null:this.tracks[t]}},{key:"addListener",value:function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"clearListeners",value:function(){this.listeners.length=0}},{key:"clearListenerNotifications",value:function(){this.queue.clear()}}]),t}();ft.emptyAnimation=new z("<empty>",[],0),ft.SUBSEQUENT=0,ft.FIRST=1,ft.HOLD_SUBSEQUENT=2,ft.HOLD_FIRST=3,ft.HOLD_MIX=4,ft.SETUP=1,ft.CURRENT=2;var vt,mt=function(){function t(){e(this,t),this.animation=void 0,this.next=void 0,this.mixingFrom=void 0,this.mixingTo=void 0,this.listener=void 0,this.trackIndex=void 0,this.loop=void 0,this.holdPrevious=void 0,this.eventThreshold=void 0,this.attachmentThreshold=void 0,this.drawOrderThreshold=void 0,this.animationStart=void 0,this.animationEnd=void 0,this.animationLast=void 0,this.nextAnimationLast=void 0,this.delay=void 0,this.trackTime=void 0,this.trackLast=void 0,this.nextTrackLast=void 0,this.trackEnd=void 0,this.timeScale=void 0,this.alpha=void 0,this.mixTime=void 0,this.mixDuration=void 0,this.interruptAlpha=void 0,this.totalAlpha=void 0,this.mixBlend=X.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return n(t,[{key:"reset",value:function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}},{key:"getAnimationTime",value:function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}},{key:"setAnimationLast",value:function(t){this.animationLast=t,this.nextAnimationLast=t}},{key:"isComplete",value:function(){return this.trackTime>=this.animationEnd-this.animationStart}},{key:"resetRotationDirections",value:function(){this.timelinesRotation.length=0}}]),t}(),gt=function(){function t(a){e(this,t),this.objects=[],this.drainDisabled=!1,this.animState=void 0,this.animState=a}return n(t,[{key:"start",value:function(t){this.objects.push(vt.start),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"interrupt",value:function(t){this.objects.push(vt.interrupt),this.objects.push(t)}},{key:"end",value:function(t){this.objects.push(vt.end),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"dispose",value:function(t){this.objects.push(vt.dispose),this.objects.push(t)}},{key:"complete",value:function(t){this.objects.push(vt.complete),this.objects.push(t)}},{key:"event",value:function(t){function e(e,a){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){this.objects.push(vt.event),this.objects.push(t),this.objects.push(e)}))},{key:"drain",value:function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,a=0;a<t.length;a+=2){var n=t[a],i=t[a+1];switch(n){case vt.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(var r=0;r<e.length;r++)e[r].start&&e[r].start(i);break;case vt.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(var s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(i);break;case vt.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(var o=0;o<e.length;o++)e[o].end&&e[o].end(i);case vt.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(var h=0;h<e.length;h++)e[h].dispose&&e[h].dispose(i);this.animState.trackEntryPool.free(i);break;case vt.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(var l=0;l<e.length;l++)e[l].complete&&e[l].complete(i);break;case vt.event:var u=t[2+a++];null!=i.listener&&i.listener.event&&i.listener.event(i,u);for(var c=0;c<e.length;c++)e[c].event&&e[c].event(i,u)}}this.clear(),this.drainDisabled=!1}}},{key:"clear",value:function(){this.objects.length=0}}]),t}();!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(vt||(vt={}));var pt=function(){function t(a){if(e(this,t),this.skeletonData=void 0,this.animationToMixTime={},this.defaultMix=0,null==a)throw new Error("skeletonData cannot be null.");this.skeletonData=a}return n(t,[{key:"setMix",value:function(t,e,a){var n=this.skeletonData.findAnimation(t);if(null==n)throw new Error("Animation not found: "+t);var i=this.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);this.setMixWith(n,i,a)}},{key:"setMixWith",value:function(t,e,a){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=a}},{key:"getMix",value:function(t,e){var a=t.name+"."+e.name,n=this.animationToMixTime[a];return void 0===n?this.defaultMix:n}}]),t}(),yt=function(a){i(s,t.Script);var r=l(s);function s(){var t;e(this,s);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=r.call.apply(r,[this].concat(n))).vertices=new Float32Array(1024),t.tempColor=[0,0,0,0],t._skeleton=void 0,t._asset=void 0,t._state=void 0,t._batches=new Array,t._nextBatchIndex=0,t._vertexCount=0,t._stencilStates=void 0,t._blendStates=void 0,t._depthMask=void 0,t._priority=0,t.zOffset=.01,t.autoUpdate=!0,t}return n(s,[{key:"asset",get:function(){return this._asset}},{key:"state",get:function(){return this._state}},{key:"skeleton",get:function(){return this._skeleton}},{key:"batches",get:function(){return this._batches}},{key:"setSkeletonData",value:function(t){this._asset=t,this._skeleton=new Z(t);var e=new pt(t);this._state=new ft(e),this.getVertexCount()}},{key:"setCustomStencil",value:function(t){this._stencilStates=t}},{key:"setCustomBlend",value:function(t){this._blendStates=t}},{key:"setDepthMask",value:function(t){this._depthMask=t}},{key:"setInitialRenderPriority",value:function(t){this._priority=t}},{key:"disposeCurrentSkeleton",value:function(){this._asset=null,this.clearBatches(),this._batches=[];for(var t=this.entity.children,e=0;e<t.length;e+=1)"batch"===t[e].name&&t[e].destroy()}},{key:"getVertexCount",value:function(){for(var t=this._skeleton.drawOrder,e=0,a=0,n=t.length;a<n;a++){var i=t[a];if(i.bone.active){var r=i.getAttachment();if(r)if(r instanceof N)e+=s.QUAD_TRIANGLES.length;else{if(!(r instanceof G))continue;e+=r.triangles.length}}}this._vertexCount=e}},{key:"onUpdate",value:function(t){this._asset&&this.autoUpdate&&this.updateState(.001*t)}},{key:"updateState",value:function(t){var e=this._state,a=this._skeleton;e.update(t),e.apply(a),a.updateWorldTransform(),this.updateGeometry()}},{key:"clearBatches",value:function(){for(var t=0;t<this._batches.length;t++)this._batches[t].clear(),this._batches[t].enabled=!1;this._nextBatchIndex=0}},{key:"nextBatch",value:function(){if(this._batches.length==this._nextBatchIndex){var t=this.entity.createChild("batch").addComponent(d);t.renderPriority=this._priority,t.initGeometry(this._vertexCount),t.initMaterial({stencil:this._stencilStates,blend:this._blendStates,depthMask:this._depthMask}),this._batches.push(t)}var e=this._batches[this._nextBatchIndex++];return e.enabled=!0,e}},{key:"updateGeometry",value:function(){this.clearBatches();var t,e,a=this.vertices,n=this._skeleton.drawOrder,i=this.nextBatch();i.begin();for(var r=0,o=this.zOffset,h=s.VERTEX_SIZE,l=0,u=n.length;l<u;l++){var c=n[l];if(c.bone.active){var d=c.getAttachment(),f=null,v=null,m=0;if(d){if(d instanceof N){var p=d;f=p.color,a=this.vertices,m=4*h,p.computeWorldVertices(c.bone,a,0,h),t=s.QUAD_TRIANGLES,e=p.uvs,v=p.region.renderObject.texture}else{if(!(d instanceof G))continue;var y=d;f=y.color,a=this.vertices,(m=(y.worldVerticesLength>>1)*h)>a.length&&(a=this.vertices=g.newFloatArray(m)),y.computeWorldVertices(c,0,y.worldVerticesLength,a,0,h),t=y.triangles,e=y.uvs,v=y.region.renderObject.texture}if(null!=v){var k=c.bone.skeleton.color,x=c.color,w=k.a*x.a*f.a,E=this.tempColor;E=[k.r*x.r*f.r,k.g*x.g*f.g,k.b*x.b*f.b,w];for(var b,M,S,T,R=a,A=2,I=0,V=m;A<V;A+=h,I+=2)R[A]=E[0],R[A+1]=E[1],R[A+2]=E[2],R[A+3]=E[3],R[A+4]=e[I],R[A+5]=e[I+1];if(b=a,M=m,S=t,T=t.length,0==M||0==T)continue;i.canBatch(M,T)||(i.end(),(i=this.nextBatch()).begin());var C=i.material;null==C.map&&(C.map=v.texture),C.map!=v.texture&&(i.end(),(i=this.nextBatch()).begin(),(C=i.material).map=v.texture),i.batch(b,M,S,T,r),r+=o}}}}i.end()}}]),s}();yt.QUAD_TRIANGLES=[0,1,2,2,3,0],yt.VERTEX_SIZE=8;var kt,xt=function(a){i(s,O);var r=l(s);function s(a,n,i,o){var h;return e(this,s),(h=r.call(this,n)).texture=void 0,n.constructor===ArrayBuffer?(h.texture=function(e,a,n,i){var r=t.parseSingleKTX(e),s=r.width,o=r.height,h=r.mipmaps,l=r.engineFormat,u=h.length>1;void 0!==n&&void 0!==i&&(console.log("resize to atlas size: width: ".concat(n,", height: ").concat(i)),s=n,o=i);for(var c=new t.Texture2D(a,s,o,l,u),d=0;d<h.length;d++){var f=h[d],v=f.width,m=f.height,g=f.data;c.setPixelBuffer(g,d,0,0,v,m)}return c}(n,a,i,o),h._image=h.texture):(h.texture=function(e,a){var n=new t.Texture2D(a,e.width,e.height);return n.setImageSource(e),n}(n,a),h._image=h.texture),h}return n(s,[{key:"setFilters",value:function(e,a){e===t.TextureFilter.NEAREST?this.texture.filterMode=t.TextureFilterMode.Point:a===t.TextureFilter.LINEAR_MIPMAP_LINEAR?this.texture.filterMode=t.TextureFilterMode.Trilinear:this.texture.filterMode=t.TextureFilterMode.Bilinear}},{key:"setWraps",value:function(t,e){this.texture.wrapModeU=t,this.texture.wrapModeV=e}},{key:"dispose",value:function(){}}]),s}(),wt=function(t){i(r,t);var a=l(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e(this,r),(n=a.call(this,(function(e,a,n){return new xt(t,e,a,n)}),i))._checkRaf=0,n}return n(r,[{key:"onLoad",value:function(){var t=this;return new Promise((function(e){t.checkLoaded(e)}))}},{key:"checkLoaded",value:function(t){0==this.toLoad?(cancelAnimationFrame(this._checkRaf),t(this)):this._checkRaf=requestAnimationFrame(this.checkLoaded.bind(this,t))}}]),r}(function(){function t(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e(this,t),this.pathPrefix=void 0,this.textureLoader=void 0,this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.rawDataUris={},this.textureLoader=a,this.pathPrefix=n}return n(t,[{key:"downloadText",value:function(t,e,a){var n=new XMLHttpRequest;n.overrideMimeType("text/html"),this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.onload=function(){200==n.status?e(n.responseText):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"downloadBinary",value:function(t,e,a){var n=new XMLHttpRequest;this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status?e(new Uint8Array(n.response)):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"setRawDataURI",value:function(t,e){this.rawDataUris[this.pathPrefix+t]=e}},{key:"loadBinary",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,i){e.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"loadText",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(n){e.assets[t]=n,a&&a(t,n),e.toLoad--,e.loaded++}),(function(a,i){e.errors[t]="Couldn't load text ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load text ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"loadTexture",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t=this.pathPrefix+t;this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(n){var s=e.textureLoader(r);e.assets[i]=s,e.toLoad--,e.loaded++,a&&a(t,r)},r.onerror=function(a){e.errors[t]="Couldn't load image ".concat(t),e.toLoad--,e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),r.src=t}},{key:"loadImage",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t=this.pathPrefix+t;this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(n){e.assets[i]=r,e.toLoad--,e.loaded++,a&&a(t,r)},r.onerror=function(a){e.errors[t]="Couldn't load image ".concat(t),e.toLoad--,e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),r.src=t}},{key:"loadCompressedTexture",value:function(t,e,a){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=t=this.pathPrefix+t;this.toLoad++,this.downloadBinary(t,(function(r){var o;o=void 0!==e&&void 0!==a?n.textureLoader(r.buffer,e,a):n.textureLoader(r.buffer),n.assets[s]=o,i&&i(t,r),n.toLoad--,n.loaded++}),(function(e,a){n.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(a),r&&r(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(a)),n.toLoad--,n.loaded++}))}},{key:"createCompressedTexture",value:function(t,e,a,n){var i=t=this.pathPrefix+t,r=this.textureLoader(e.buffer,a,n);this.assets[i]=r}},{key:"createTexture",value:function(t,e){var a=t=this.pathPrefix+t,n=this.textureLoader(e);this.assets[a]=n}},{key:"loadTextureAtlas",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.lastIndexOf("/")>=0?t.substring(0,t.lastIndexOf("/")):"";t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,(function(r){var s={count:0},o=new Array;try{new q(r,(function(t){o.push(""==i?t:i+"/"+t);var e=document.createElement("img");return e.width=16,e.height=16,new U(e)}))}catch(a){var h=a;return e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(h.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(h.message)),e.toLoad--,void e.loaded++}for(var l=function(){var h=c[u],l=!1;e.loadTexture(h,(function(h,u){if(s.count++,s.count==o.length)if(l)e.errors[t]="Couldn't load texture atlas page ".concat(h,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(h," of atlas ").concat(t)),e.toLoad--,e.loaded++;else try{var c=new q(r,(function(t){return e.get(""==i?t:i+"/"+t)}));e.assets[t]=c,a&&a(t,c),e.toLoad--,e.loaded++}catch(a){var d=a;e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(d.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(d.message)),e.toLoad--,e.loaded++}}),(function(a,i){l=!0,s.count++,s.count==o.length&&(e.errors[t]="Couldn't load texture atlas page ".concat(a,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(a," of atlas ").concat(t)),e.toLoad--,e.loaded++)}))},u=0,c=o;u<c.length;u++)l()}),(function(a,i){e.errors[t]="Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(i),n&&n(t,"Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(i)),e.toLoad--,e.loaded++}))}},{key:"get",value:function(t){return t=this.pathPrefix+t,this.assets[t]}},{key:"remove",value:function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null}},{key:"removeAll",value:function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}},{key:"isLoadingComplete",value:function(){return 0==this.toLoad}},{key:"getToLoad",value:function(){return this.toLoad}},{key:"getLoaded",value:function(){return this.loaded}},{key:"dispose",value:function(){this.removeAll()}},{key:"hasErrors",value:function(){return Object.keys(this.errors).length>0}},{key:"getErrors",value:function(){return this.errors}}]),t}()),Et=function(t){i(r,C);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).color=new v(1,1,1,1),n}return n(r,[{key:"copy",value:function(){var t=new r(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}]),r}(),bt=function(t){i(r,C);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).x=void 0,n.y=void 0,n.rotation=void 0,n.color=new v(.38,.94,0,1),n.name=t,n}return n(r,[{key:"computeWorldPosition",value:function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}},{key:"computeWorldRotation",value:function(t){var e=m.cosDeg(this.rotation),a=m.sinDeg(this.rotation),n=e*t.a+a*t.b,i=e*t.c+a*t.d;return Math.atan2(i,n)*m.radDeg}},{key:"copy",value:function(){var t=new r(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}]),r}(),Mt=function(t){i(r,C);var a=l(r);function r(t){var n;return e(this,r),(n=a.call(this,t)).endSlot=void 0,n.color=new v(.2275,.2275,.8078,1),n}return n(r,[{key:"copy",value:function(){var t=new r(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}]),r}(),St=function(){function t(a){e(this,t),this.atlas=void 0,this.atlas=a}return n(t,[{key:"newRegionAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (region attachment: "+e+")");n.renderObject=n;var i=new N(e);return i.setRegion(n),i}},{key:"newMeshAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(null==n)throw new Error("Region not found in atlas: "+a+" (mesh attachment: "+e+")");n.renderObject=n;var i=new G(e);return i.region=n,i}},{key:"newBoundingBoxAttachment",value:function(t,e){return new Et(e)}},{key:"newPathAttachment",value:function(t,e){return new P(e)}},{key:"newPointAttachment",value:function(t,e){return new bt(e)}},{key:"newClippingAttachment",value:function(t,e){return new Mt(e)}}]),t}(),Tt=function(){function t(){e(this,t),this.name=void 0,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=void 0,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.version=void 0,this.hash=void 0,this.fps=0,this.imagesPath=void 0,this.audioPath=void 0}return n(t,[{key:"findBone",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findBoneIndex",value:function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSlot",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findSlotIndex",value:function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSkin",value:function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findEvent",value:function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findAnimation",value:function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findIkConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findTransformConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findPathConstraint",value:function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var i=e[a];if(i.name==t)return i}return null}},{key:"findPathConstraintIndex",value:function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}}]),t}(),Rt=function t(a,n,i){if(e(this,t),this.index=void 0,this.name=void 0,this.boneData=void 0,this.color=new v(1,1,1,1),this.darkColor=void 0,this.attachmentName=void 0,this.blendMode=void 0,a<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=a,this.name=n,this.boneData=i},At=function(t){i(n,A);var a=l(n);function n(t){var i;return e(this,n),(i=a.call(this,t,0,!1)).bones=new Array,i.target=void 0,i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return n}(),It=function(t){i(n,A);var a=l(n);function n(t){var i;return e(this,n),(i=a.call(this,t,0,!1)).bones=new Array,i.target=void 0,i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return n}(),Vt=function t(a,n,i){e(this,t),this.slotIndex=a,this.name=n,this.attachment=i},Ct=function(){function t(a){if(e(this,t),this.name=void 0,this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==a)throw new Error("name cannot be null.");this.name=a}return n(t,[{key:"setAttachment",value:function(t,e,a){if(null==a)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=a}},{key:"addSkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==a){n=!0;break}n||this.bones.push(a)}for(var r=0;r<t.constraints.length;r++){for(var s=t.constraints[r],o=!1,h=0;h<this.constraints.length;h++)if(this.constraints[h]==s){o=!0;break}o||this.constraints.push(s)}for(var l=t.getAttachments(),u=0;u<l.length;u++){var c=l[u];this.setAttachment(c.slotIndex,c.name,c.attachment)}}},{key:"copySkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,i=0;i<this.bones.length;i++)if(this.bones[i]==a){n=!0;break}n||this.bones.push(a)}for(var r=0;r<t.constraints.length;r++){for(var s=t.constraints[r],o=!1,h=0;h<this.constraints.length;h++)if(this.constraints[h]==s){o=!0;break}o||this.constraints.push(s)}for(var l=t.getAttachments(),u=0;u<l.length;u++){var c=l[u];null!=c.attachment&&(c.attachment instanceof G?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}}},{key:"getAttachment",value:function(t,e){var a=this.attachments[t];return a?a[e]:null}},{key:"removeAttachment",value:function(t,e){var a=this.attachments[t];a&&(a[e]=null)}},{key:"getAttachments",value:function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var a=this.attachments[e];if(a)for(var n in a){var i=a[n];i&&t.push(new Vt(e,n,i))}}return t}},{key:"getAttachmentsForSlot",value:function(t,e){var a=this.attachments[t];if(a)for(var n in a){var i=a[n];i&&e.push(new Vt(t,n,i))}}},{key:"clear",value:function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}},{key:"attachAll",value:function(t,e){for(var a=0,n=0;n<t.slots.length;n++){var i=t.slots[n],r=i.getAttachment();if(r&&a<e.attachments.length){var s=e.attachments[a];for(var o in s){if(r==s[o]){var h=this.getAttachment(a,o);null!=h&&i.setAttachment(h);break}}}a++}}}]),t}(),Pt=function t(a){e(this,t),this.name=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.audioPath=void 0,this.volume=void 0,this.balance=void 0,this.name=a};!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(kt||(kt={}));var _t=function t(a,n){if(e(this,t),this.data=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.time=void 0,this.volume=void 0,this.balance=void 0,null==n)throw new Error("data cannot be null.");this.time=a,this.data=n},Nt=function(){function t(a){e(this,t),this.attachmentLoader=void 0,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=a}return n(t,[{key:"readSkeletonData",value:function(e){var a=this.scale,n=new Tt,i="string"==typeof e?JSON.parse(e):e,r=i.skeleton;if(null!=r){if(n.hash=r.hash,n.version=r.spine,"3.8.75"==n.version)throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");n.x=r.x,n.y=r.y,n.width=r.width,n.height=r.height,n.fps=r.fps,n.imagesPath=r.images}if(i.bones)for(var s=0;s<i.bones.length;s++){var o=i.bones[s],h=null,l=this.getValue(o,"parent",null);if(null!=l&&null==(h=n.findBone(l)))throw new Error("Parent bone not found: "+l);var u=new x(n.bones.length,o.name,h);u.length=this.getValue(o,"length",0)*a,u.x=this.getValue(o,"x",0)*a,u.y=this.getValue(o,"y",0)*a,u.rotation=this.getValue(o,"rotation",0),u.scaleX=this.getValue(o,"scaleX",1),u.scaleY=this.getValue(o,"scaleY",1),u.shearX=this.getValue(o,"shearX",0),u.shearY=this.getValue(o,"shearY",0),u.transformMode=t.transformModeFromString(this.getValue(o,"transform","normal")),u.skinRequired=this.getValue(o,"skin",!1),n.bones.push(u)}if(i.slots)for(var c=0;c<i.slots.length;c++){var d=i.slots[c],f=d.name,m=d.bone,g=n.findBone(m);if(null==g)throw new Error("Slot bone not found: "+m);var p=new Rt(n.slots.length,f,g),y=this.getValue(d,"color",null);null!=y&&p.color.setFromString(y);var k=this.getValue(d,"dark",null);null!=k&&(p.darkColor=new v(1,1,1,1),p.darkColor.setFromString(k)),p.attachmentName=this.getValue(d,"attachment",null),p.blendMode=t.blendModeFromString(this.getValue(d,"blend","normal")),n.slots.push(p)}if(i.ik)for(var b=0;b<i.ik.length;b++){var M=i.ik[b],S=new At(M.name);S.order=this.getValue(M,"order",0),S.skinRequired=this.getValue(M,"skin",!1);for(var T=0;T<M.bones.length;T++){var R=M.bones[T],A=n.findBone(R);if(null==A)throw new Error("IK bone not found: "+R);S.bones.push(A)}var V=M.target;if(S.target=n.findBone(V),null==S.target)throw new Error("IK target bone not found: "+V);S.mix=this.getValue(M,"mix",1),S.softness=this.getValue(M,"softness",0)*a,S.bendDirection=this.getValue(M,"bendPositive",!0)?1:-1,S.compress=this.getValue(M,"compress",!1),S.stretch=this.getValue(M,"stretch",!1),S.uniform=this.getValue(M,"uniform",!1),n.ikConstraints.push(S)}if(i.transform)for(var C=0;C<i.transform.length;C++){var P=i.transform[C],_=new It(P.name);_.order=this.getValue(P,"order",0),_.skinRequired=this.getValue(P,"skin",!1);for(var N=0;N<P.bones.length;N++){var L=P.bones[N],F=n.findBone(L);if(null==F)throw new Error("Transform constraint bone not found: "+L);_.bones.push(F)}var O=P.target;if(_.target=n.findBone(O),null==_.target)throw new Error("Transform constraint target bone not found: "+O);_.local=this.getValue(P,"local",!1),_.relative=this.getValue(P,"relative",!1),_.offsetRotation=this.getValue(P,"rotation",0),_.offsetX=this.getValue(P,"x",0)*a,_.offsetY=this.getValue(P,"y",0)*a,_.offsetScaleX=this.getValue(P,"scaleX",0),_.offsetScaleY=this.getValue(P,"scaleY",0),_.offsetShearY=this.getValue(P,"shearY",0),_.rotateMix=this.getValue(P,"rotateMix",1),_.translateMix=this.getValue(P,"translateMix",1),_.scaleMix=this.getValue(P,"scaleMix",1),_.shearMix=this.getValue(P,"shearMix",1),n.transformConstraints.push(_)}if(i.path)for(var X=0;X<i.path.length;X++){var Y=i.path[X],D=new I(Y.name);D.order=this.getValue(Y,"order",0),D.skinRequired=this.getValue(Y,"skin",!1);for(var B=0;B<Y.bones.length;B++){var U=Y.bones[B],q=n.findBone(U);if(null==q)throw new Error("Transform constraint bone not found: "+U);D.bones.push(q)}var W=Y.target;if(D.target=n.findSlot(W),null==D.target)throw new Error("Path target slot not found: "+W);D.positionMode=t.positionModeFromString(this.getValue(Y,"positionMode","percent")),D.spacingMode=t.spacingModeFromString(this.getValue(Y,"spacingMode","length")),D.rotateMode=t.rotateModeFromString(this.getValue(Y,"rotateMode","tangent")),D.offsetRotation=this.getValue(Y,"rotation",0),D.position=this.getValue(Y,"position",0),D.positionMode==w.Fixed&&(D.position*=a),D.spacing=this.getValue(Y,"spacing",0),D.spacingMode!=E.Length&&D.spacingMode!=E.Fixed||(D.spacing*=a),D.rotateMix=this.getValue(Y,"rotateMix",1),D.translateMix=this.getValue(Y,"translateMix",1),n.pathConstraints.push(D)}if(i.skins)for(var H=0;H<i.skins.length;H++){var j=i.skins[H],G=new Ct(j.name);if(j.bones)for(var Z=0;Z<j.bones.length;Z++){var z=n.findBone(j.bones[Z]);if(null==z)throw new Error("Skin bone not found: "+j.bones[H]);G.bones.push(z)}if(j.ik)for(var Q=0;Q<j.ik.length;Q++){var K=n.findIkConstraint(j.ik[Q]);if(null==K)throw new Error("Skin IK constraint not found: "+j.ik[H]);G.constraints.push(K)}if(j.transform)for(var J=0;J<j.transform.length;J++){var $=n.findTransformConstraint(j.transform[J]);if(null==$)throw new Error("Skin transform constraint not found: "+j.transform[H]);G.constraints.push($)}if(j.path)for(var tt=0;tt<j.path.length;tt++){var et=n.findPathConstraint(j.path[tt]);if(null==et)throw new Error("Skin path constraint not found: "+j.path[H]);G.constraints.push(et)}for(var at in j.attachments){var nt=n.findSlot(at);if(null==nt)throw new Error("Slot not found: "+at);var it=j.attachments[at];for(var rt in it){var st=this.readAttachment(it[rt],G,nt.index,rt,n);null!=st&&G.setAttachment(nt.index,rt,st)}}n.skins.push(G),"default"==G.name&&(n.defaultSkin=G)}for(var ot=0,ht=this.linkedMeshes.length;ot<ht;ot++){var lt=this.linkedMeshes[ot],ut=null==lt.skin?n.defaultSkin:n.findSkin(lt.skin);if(null==ut)throw new Error("Skin not found: "+lt.skin);var ct=ut.getAttachment(lt.slotIndex,lt.parent);if(null==ct)throw new Error("Parent mesh not found: "+lt.parent);lt.mesh.deformAttachment=lt.inheritDeform?ct:lt.mesh,lt.mesh.setParentMesh(ct),lt.mesh.updateUVs()}if(this.linkedMeshes.length=0,i.events)for(var dt in i.events){var ft=i.events[dt],vt=new Pt(dt);vt.intValue=this.getValue(ft,"int",0),vt.floatValue=this.getValue(ft,"float",0),vt.stringValue=this.getValue(ft,"string",""),vt.audioPath=this.getValue(ft,"audio",null),null!=vt.audioPath&&(vt.volume=this.getValue(ft,"volume",1),vt.balance=this.getValue(ft,"balance",0)),n.events.push(vt)}if(i.animations)for(var mt in i.animations){var gt=i.animations[mt];this.readAnimation(gt,mt,n)}return n}},{key:"readAttachment",value:function(t,e,a,n,i){var r=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var s=this.getValue(t,"path",n),o=this.attachmentLoader.newRegionAttachment(e,n,s);if(null==o)return null;o.path=s,o.x=this.getValue(t,"x",0)*r,o.y=this.getValue(t,"y",0)*r,o.scaleX=this.getValue(t,"scaleX",1),o.scaleY=this.getValue(t,"scaleY",1),o.rotation=this.getValue(t,"rotation",0),o.width=t.width*r,o.height=t.height*r;var h=this.getValue(t,"color",null);return null!=h&&o.color.setFromString(h),o.updateOffset(),o;case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(null==l)return null;this.readVertices(t,l,t.vertexCount<<1);var u=this.getValue(t,"color",null);return null!=u&&l.color.setFromString(u),l;case"mesh":case"linkedmesh":var c=this.getValue(t,"path",n),d=this.attachmentLoader.newMeshAttachment(e,n,c);if(null==d)return null;d.path=c;var f=this.getValue(t,"color",null);null!=f&&d.color.setFromString(f),d.width=this.getValue(t,"width",0)*r,d.height=this.getValue(t,"height",0)*r;var v=this.getValue(t,"parent",null);if(null!=v)return this.linkedMeshes.push(new Lt(d,this.getValue(t,"skin",null),a,v,this.getValue(t,"deform",!0))),d;var m=t.uvs;return this.readVertices(t,d,m.length),d.triangles=t.triangles,d.regionUVs=m,d.updateUVs(),d.edges=this.getValue(t,"edges",null),d.hullLength=2*this.getValue(t,"hull",0),d;case"path":var p=this.attachmentLoader.newPathAttachment(e,n);if(null==p)return null;p.closed=this.getValue(t,"closed",!1),p.constantSpeed=this.getValue(t,"constantSpeed",!0);var y=t.vertexCount;this.readVertices(t,p,y<<1);for(var k=g.newArray(y/3,0),x=0;x<t.lengths.length;x++)k[x]=t.lengths[x]*r;p.lengths=k;var w=this.getValue(t,"color",null);return null!=w&&p.color.setFromString(w),p;case"point":var E=this.attachmentLoader.newPointAttachment(e,n);if(null==E)return null;E.x=this.getValue(t,"x",0)*r,E.y=this.getValue(t,"y",0)*r,E.rotation=this.getValue(t,"rotation",0);var b=this.getValue(t,"color",null);return null!=b&&E.color.setFromString(b),E;case"clipping":var M=this.attachmentLoader.newClippingAttachment(e,n);if(null==M)return null;var S=this.getValue(t,"end",null);if(null!=S){var T=i.findSlot(S);if(null==T)throw new Error("Clipping end slot not found: "+S);M.endSlot=T}var R=t.vertexCount;this.readVertices(t,M,R<<1);var A=this.getValue(t,"color",null);return null!=A&&M.color.setFromString(A),M}return null}},{key:"readVertices",value:function(t,e,a){var n=this.scale;e.worldVerticesLength=a;var i=t.vertices;if(a!=i.length){for(var r=new Array,s=new Array,o=0,h=i.length;o<h;){var l=i[o++];s.push(l);for(var u=o+4*l;o<u;o+=4)s.push(i[o]),r.push(i[o+1]*n),r.push(i[o+2]*n),r.push(i[o+3])}e.bones=s,e.vertices=g.toFloatArray(r)}else{var c=g.toFloatArray(i);if(1!=n)for(var d=0,f=i.length;d<f;d++)c[d]*=n;e.vertices=c}}},{key:"readAnimation",value:function(t,e,a){var n=this.scale,i=new Array,r=0;if(t.slots)for(var s in t.slots){var o=t.slots[s],h=a.findSlotIndex(s);if(-1==h)throw new Error("Slot not found: "+s);for(var l in o){var u=o[l];if("attachment"==l){var c=new nt(u.length);c.slotIndex=h;for(var d=0,f=0;f<u.length;f++){var m=u[f];c.setFrame(d++,this.getValue(m,"time",0),m.name)}i.push(c),r=Math.max(r,c.frames[c.getFrameCount()-1])}else if("color"==l){var p=new et(u.length);p.slotIndex=h;for(var y=0,k=0;k<u.length;k++){var x=u[k],b=new v;b.setFromString(x.color),p.setFrame(y,this.getValue(x,"time",0),b.r,b.g,b.b,b.a),this.readCurve(x,p,y),y++}i.push(p),r=Math.max(r,p.frames[(p.getFrameCount()-1)*et.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");var M=new at(u.length);M.slotIndex=h;for(var S=0,T=0;T<u.length;T++){var R=u[T],A=new v,I=new v;A.setFromString(R.light),I.setFromString(R.dark),M.setFrame(S,this.getValue(R,"time",0),A.r,A.g,A.b,A.a,I.r,I.g,I.b),this.readCurve(R,M,S),S++}i.push(M),r=Math.max(r,M.frames[(M.getFrameCount()-1)*at.ENTRIES])}}}if(t.bones)for(var V in t.bones){var C=t.bones[V],P=a.findBoneIndex(V);if(-1==P)throw new Error("Bone not found: "+V);for(var _ in C){var N=C[_];if("rotate"===_){var L=new K(N.length);L.boneIndex=P;for(var F=0,O=0;O<N.length;O++){var X=N[O];L.setFrame(F,this.getValue(X,"time",0),this.getValue(X,"angle",0)),this.readCurve(X,L,F),F++}i.push(L),r=Math.max(r,L.frames[(L.getFrameCount()-1)*K.ENTRIES])}else{if("translate"!==_&&"scale"!==_&&"shear"!==_)throw new Error("Invalid timeline type for a bone: "+_+" ("+V+")");var Y=null,D=1,B=0;"scale"===_?(Y=new $(N.length),B=1):"shear"===_?Y=new tt(N.length):(Y=new J(N.length),D=n),Y.boneIndex=P;for(var U=0,q=0;q<N.length;q++){var W=N[q],H=this.getValue(W,"x",B),j=this.getValue(W,"y",B);Y.setFrame(U,this.getValue(W,"time",0),H*D,j*D),this.readCurve(W,Y,U),U++}i.push(Y),r=Math.max(r,Y.frames[(Y.getFrameCount()-1)*J.ENTRIES])}}}if(t.ik)for(var G in t.ik){var Z=t.ik[G],Q=a.findIkConstraint(G),it=new ht(Z.length);it.ikConstraintIndex=a.ikConstraints.indexOf(Q);for(var ft=0,vt=0;vt<Z.length;vt++){var mt=Z[vt];it.setFrame(ft,this.getValue(mt,"time",0),this.getValue(mt,"mix",1),this.getValue(mt,"softness",0)*n,this.getValue(mt,"bendPositive",!0)?1:-1,this.getValue(mt,"compress",!1),this.getValue(mt,"stretch",!1)),this.readCurve(mt,it,ft),ft++}i.push(it),r=Math.max(r,it.frames[(it.getFrameCount()-1)*ht.ENTRIES])}if(t.transform)for(var gt in t.transform){var pt=t.transform[gt],yt=a.findTransformConstraint(gt),kt=new lt(pt.length);kt.transformConstraintIndex=a.transformConstraints.indexOf(yt);for(var xt=0,wt=0;wt<pt.length;wt++){var Et=pt[wt];kt.setFrame(xt,this.getValue(Et,"time",0),this.getValue(Et,"rotateMix",1),this.getValue(Et,"translateMix",1),this.getValue(Et,"scaleMix",1),this.getValue(Et,"shearMix",1)),this.readCurve(Et,kt,xt),xt++}i.push(kt),r=Math.max(r,kt.frames[(kt.getFrameCount()-1)*lt.ENTRIES])}if(t.path)for(var bt in t.path){var Mt=t.path[bt],St=a.findPathConstraintIndex(bt);if(-1==St)throw new Error("Path constraint not found: "+bt);var Tt=a.pathConstraints[St];for(var Rt in Mt){var At=Mt[Rt];if("position"===Rt||"spacing"===Rt){var It=null,Vt=1;"spacing"===Rt?(It=new ct(At.length),Tt.spacingMode!=E.Length&&Tt.spacingMode!=E.Fixed||(Vt=n)):(It=new ut(At.length),Tt.positionMode==w.Fixed&&(Vt=n)),It.pathConstraintIndex=St;for(var Ct=0,Pt=0;Pt<At.length;Pt++){var Nt=At[Pt];It.setFrame(Ct,this.getValue(Nt,"time",0),this.getValue(Nt,Rt,0)*Vt),this.readCurve(Nt,It,Ct),Ct++}i.push(It),r=Math.max(r,It.frames[(It.getFrameCount()-1)*ut.ENTRIES])}else if("mix"===Rt){var Lt=new dt(At.length);Lt.pathConstraintIndex=St;for(var Ft=0,Ot=0;Ot<At.length;Ot++){var Xt=At[Ot];Lt.setFrame(Ft,this.getValue(Xt,"time",0),this.getValue(Xt,"rotateMix",1),this.getValue(Xt,"translateMix",1)),this.readCurve(Xt,Lt,Ft),Ft++}i.push(Lt),r=Math.max(r,Lt.frames[(Lt.getFrameCount()-1)*dt.ENTRIES])}}}if(t.deform)for(var Yt in t.deform){var Dt=t.deform[Yt],Bt=a.findSkin(Yt);if(null==Bt)throw new Error("Skin not found: "+Yt);for(var Ut in Dt){var qt=Dt[Ut],Wt=a.findSlotIndex(Ut);if(-1==Wt)throw new Error("Slot not found: "+qt.name);for(var Ht in qt){var jt=qt[Ht],Gt=Bt.getAttachment(Wt,Ht);if(null==Gt)throw new Error("Deform attachment not found: "+jt.name);var Zt=null!=Gt.bones,zt=Gt.vertices,Qt=Zt?zt.length/3*2:zt.length,Kt=new rt(jt.length);Kt.slotIndex=Wt,Kt.attachment=Gt;for(var Jt=0,$t=0;$t<jt.length;$t++){var te=jt[$t],ee=void 0,ae=this.getValue(te,"vertices",null);if(null==ae)ee=Zt?g.newFloatArray(Qt):zt;else{ee=g.newFloatArray(Qt);var ne=this.getValue(te,"offset",0);if(g.arrayCopy(ae,0,ee,ne,ae.length),1!=n)for(var ie=ne,re=ie+ae.length;ie<re;ie++)ee[ie]*=n;if(!Zt)for(var se=0;se<Qt;se++)ee[se]+=zt[se]}Kt.setFrame(Jt,this.getValue(te,"time",0),ee),this.readCurve(te,Kt,Jt),Jt++}i.push(Kt),r=Math.max(r,Kt.frames[Kt.getFrameCount()-1])}}}var oe=t.drawOrder;if(null==oe&&(oe=t.draworder),null!=oe){for(var he=new ot(oe.length),le=a.slots.length,ue=0,ce=0;ce<oe.length;ce++){var de=oe[ce],fe=null,ve=this.getValue(de,"offsets",null);if(null!=ve){fe=g.newArray(le,-1);for(var me=g.newArray(le-ve.length,0),ge=0,pe=0,ye=0;ye<ve.length;ye++){var ke=ve[ye],xe=a.findSlotIndex(ke.slot);if(-1==xe)throw new Error("Slot not found: "+ke.slot);for(;ge!=xe;)me[pe++]=ge++;fe[ge+ke.offset]=ge++}for(;ge<le;)me[pe++]=ge++;for(var we=le-1;we>=0;we--)-1==fe[we]&&(fe[we]=me[--pe])}he.setFrame(ue++,this.getValue(de,"time",0),fe)}i.push(he),r=Math.max(r,he.frames[he.getFrameCount()-1])}if(t.events){for(var Ee=new st(t.events.length),be=0,Me=0;Me<t.events.length;Me++){var Se=t.events[Me],Te=a.findEvent(Se.name);if(null==Te)throw new Error("Event not found: "+Se.name);var Re=new _t(g.toSinglePrecision(this.getValue(Se,"time",0)),Te);Re.intValue=this.getValue(Se,"int",Te.intValue),Re.floatValue=this.getValue(Se,"float",Te.floatValue),Re.stringValue=this.getValue(Se,"string",Te.stringValue),null!=Re.data.audioPath&&(Re.volume=this.getValue(Se,"volume",1),Re.balance=this.getValue(Se,"balance",0)),Ee.setFrame(be++,Re)}i.push(Ee),r=Math.max(r,Ee.frames[Ee.getFrameCount()-1])}if(isNaN(r))throw new Error("Error while parsing animation, duration is NaN");a.animations.push(new z(e,i,r))}},{key:"readCurve",value:function(t,e,a){if(t.hasOwnProperty("curve"))if("stepped"==t.curve)e.setStepped(a);else{var n=t.curve;e.setCurve(a,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}},{key:"getValue",value:function(t,e,a){return void 0!==t[e]?t[e]:a}}],[{key:"blendModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return kt.Normal;if("additive"==t)return kt.Additive;if("multiply"==t)return kt.Multiply;if("screen"==t)return kt.Screen;throw new Error("Unknown blend mode: ".concat(t))}},{key:"positionModeFromString",value:function(t){if("fixed"==(t=t.toLowerCase()))return w.Fixed;if("percent"==t)return w.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"spacingModeFromString",value:function(t){if("length"==(t=t.toLowerCase()))return E.Length;if("fixed"==t)return E.Fixed;if("percent"==t)return E.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"rotateModeFromString",value:function(t){if("tangent"==(t=t.toLowerCase()))return b.Tangent;if("chain"==t)return b.Chain;if("chainscale"==t)return b.ChainScale;throw new Error("Unknown rotate mode: ".concat(t))}},{key:"transformModeFromString",value:function(t){if("normal"==(t=t.toLowerCase()))return p.Normal;if("onlytranslation"==t)return p.OnlyTranslation;if("norotationorreflection"==t)return p.NoRotationOrReflection;if("noscale"==t)return p.NoScale;if("noscaleorreflection"==t)return p.NoScaleOrReflection;throw new Error("Unknown transform mode: ".concat(t))}}]),t}(),Lt=function t(a,n,i,r,s){e(this,t),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=a,this.skin=n,this.slotIndex=i,this.parent=r,this.inheritDeform=s};exports.AssetManager=wt,exports.AtlasAttachmentLoader=St,exports.SkeletonJson=Nt,exports.SpineRenderer=yt,exports.TextureAtlas=q;
